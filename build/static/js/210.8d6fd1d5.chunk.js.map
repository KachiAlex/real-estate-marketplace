{"version":3,"file":"static/js/210.8d6fd1d5.chunk.js","mappings":"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","sources":["components/EscrowPaymentFlow.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useProperty } from '../contexts/PropertyContext';\r\nimport { useEscrow } from '../contexts/EscrowContext';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { useInvestment } from '../contexts/InvestmentContext';\r\nimport { FaShoppingCart, FaLock, FaCreditCard, FaCheck, FaArrowLeft, FaCheckCircle, FaUserCheck, FaHandshake, FaSpinner } from 'react-icons/fa';\r\nimport toast from 'react-hot-toast';\r\nimport { getApiUrl } from '../utils/apiConfig';\r\n\r\nconst ESCROW_PAYMENT_STORAGE_KEY = 'escrowPayments';\r\n\r\nconst readEscrowPaymentEntries = () => {\r\n  if (typeof window === 'undefined') return [];\r\n  try {\r\n    const raw = window.localStorage.getItem(ESCROW_PAYMENT_STORAGE_KEY);\r\n    return raw ? JSON.parse(raw) : [];\r\n  } catch (error) {\r\n    console.warn('EscrowPaymentFlow: unable to read escrow payments from storage', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nconst saveEscrowPaymentEntry = (entry) => {\r\n  if (typeof window === 'undefined') return;\r\n  try {\r\n    const existing = readEscrowPaymentEntries();\r\n    const updated = existing.filter(item => item.paymentId !== entry.paymentId && item.txRef !== entry.txRef);\r\n    updated.push(entry);\r\n    window.localStorage.setItem(ESCROW_PAYMENT_STORAGE_KEY, JSON.stringify(updated));\r\n  } catch (error) {\r\n    console.warn('EscrowPaymentFlow: unable to save escrow payment entry', error);\r\n  }\r\n};\r\n\r\nconst getStoredToken = () => {\r\n  if (typeof window === 'undefined') return null;\r\n  try {\r\n    return window.localStorage.getItem('token');\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\nconst buildAuthHeaders = (user) => {\r\n  const token = user?.token || getStoredToken();\r\n  const fallbackEmail = user?.email;\r\n\r\n  if (!token && !fallbackEmail) {\r\n    return null;\r\n  }\r\n\r\n  const headers = {\r\n    'Content-Type': 'application/json'\r\n  };\r\n\r\n  if (token) {\r\n    headers.Authorization = `Bearer ${token}`;\r\n  } else if (fallbackEmail) {\r\n    headers['X-Mock-User-Email'] = fallbackEmail;\r\n  }\r\n\r\n  return headers;\r\n};\r\n\r\nconst updateEscrowPaymentEntry = (paymentId, updates) => {\r\n  if (typeof window === 'undefined') return null;\r\n  try {\r\n    const entries = readEscrowPaymentEntries();\r\n    const updatedEntries = entries.map((item) => (\r\n      item.paymentId === paymentId ? { ...item, ...updates } : item\r\n    ));\r\n    window.localStorage.setItem(ESCROW_PAYMENT_STORAGE_KEY, JSON.stringify(updatedEntries));\r\n    return updatedEntries.find((item) => item.paymentId === paymentId) || null;\r\n  } catch (error) {\r\n    console.warn('EscrowPaymentFlow: unable to update escrow payment entry', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst removeEscrowPaymentEntry = (paymentId) => {\r\n  if (typeof window === 'undefined') return;\r\n  try {\r\n    const entries = readEscrowPaymentEntries();\r\n    const filtered = entries.filter((item) => item.paymentId !== paymentId);\r\n    window.localStorage.setItem(ESCROW_PAYMENT_STORAGE_KEY, JSON.stringify(filtered));\r\n  } catch (error) {\r\n    console.warn('EscrowPaymentFlow: unable to remove escrow payment entry', error);\r\n  }\r\n};\r\n\r\nconst markEscrowTransactionFunded = (escrowId, reference, method = 'flutterwave') => {\r\n  if (!escrowId || typeof window === 'undefined') return;\r\n  try {\r\n    const existingTransactions = JSON.parse(localStorage.getItem('escrowTransactions') || '[]');\r\n    const updatedTransactions = existingTransactions.map((transaction) => \r\n      transaction.id === escrowId\r\n        ? {\r\n            ...transaction,\r\n            status: 'payment_received',\r\n            payment: {\r\n              ...(transaction.payment || {}),\r\n              method,\r\n              reference: reference || transaction.payment?.reference,\r\n              paidAt: new Date().toISOString()\r\n            },\r\n            fundedAt: new Date().toISOString()\r\n          }\r\n        : transaction\r\n    );\r\n    localStorage.setItem('escrowTransactions', JSON.stringify(updatedTransactions));\r\n  } catch (error) {\r\n    console.warn('EscrowPaymentFlow: unable to mark escrow transaction funded', error);\r\n  }\r\n};\r\n\r\nconst formatCurrency = (value = 0) => {\r\n  const amount = Number.isFinite(value) ? value : 0;\r\n  return new Intl.NumberFormat('en-NG', {\r\n    style: 'currency',\r\n    currency: 'NGN',\r\n    maximumFractionDigits: 0\r\n  }).format(amount);\r\n};\r\n\r\nconst buildPaymentDescription = (itemTitle, transactionType) => {\r\n  if (transactionType === 'investment') {\r\n    return `Escrow funding for investment opportunity: ${itemTitle}`;\r\n  }\r\n  return `Escrow payment for property purchase: ${itemTitle}`;\r\n};\r\n\r\nconst EscrowPaymentFlow = ({\r\n  property: providedProperty = null,\r\n  investment: providedInvestment = null,\r\n  transactionType: providedTransactionType = 'purchase',\r\n  onClose\r\n}) => {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const { user, clearAuthRedirect } = useAuth();\r\n  const { fetchProperty } = useProperty();\r\n  const { createEscrowTransaction } = useEscrow();\r\n  const { investments, getInvestmentById } = useInvestment();\r\n  \r\n  const propertyIdFromParams = searchParams.get('propertyId');\r\n  const investmentIdFromParams = searchParams.get('investmentId');\r\n  const [property, setProperty] = useState(providedProperty);\r\n  const [investment, setInvestment] = useState(providedInvestment);\r\n  const [loading, setLoading] = useState(!(providedProperty || providedInvestment));\r\n  const [step, setStep] = useState(1); // 1: Review, 2: Payment Details, 3: Confirmation\r\n  const [paymentData, setPaymentData] = useState({\r\n    paymentMethod: 'flutterwave',\r\n    cardNumber: '',\r\n    expiryDate: '',\r\n    cvv: '',\r\n    cardholderName: ''\r\n  });\r\n  const [pendingPayment, setPendingPayment] = useState(null);\r\n  const [paymentStatus, setPaymentStatus] = useState('idle');\r\n  const [paymentError, setPaymentError] = useState('');\r\n  const [providerLimit, setProviderLimit] = useState(null);\r\n  const [checkoutUrl, setCheckoutUrl] = useState('');\r\n  const [isPaymentVerifying, setIsPaymentVerifying] = useState(false);\r\n  const [activeEscrowId, setActiveEscrowId] = useState(null);\r\n  const [isInitializingPayment, setIsInitializingPayment] = useState(false);\r\n  const [showCheckoutModal, setShowCheckoutModal] = useState(false);\r\n\r\n  const propertyId = providedProperty?.id || providedProperty?.propertyId || propertyIdFromParams;\r\n  const investmentId = providedInvestment?.id || investmentIdFromParams;\r\n  const typeFromParams = searchParams.get('type') || 'purchase';\r\n  const transactionType = (providedProperty || providedInvestment)\r\n    ? providedTransactionType\r\n    : typeFromParams;\r\n  const isModal = Boolean(onClose);\r\n\r\n  const hydratePendingPayment = useCallback(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const entries = readEscrowPaymentEntries();\r\n    if (!entries || entries.length === 0) return;\r\n\r\n    const match = entries.find((entry) => {\r\n      if (activeEscrowId && entry.escrowId === activeEscrowId) return true;\r\n      if (property?.id && entry.propertyId === property.id) return true;\r\n      if (investment?.id && entry.investmentId === investment.id) return true;\r\n      return false;\r\n    });\r\n\r\n    if (match) {\r\n      setPendingPayment(match);\r\n      setPaymentStatus(match.status || 'processing');\r\n      setCheckoutUrl(match.checkoutUrl || '');\r\n      if (match.escrowId) {\r\n        setActiveEscrowId(match.escrowId);\r\n      }\r\n      setStep((prev) => (prev < 2 ? 2 : prev));\r\n    }\r\n  }, [property?.id, investment?.id, activeEscrowId]);\r\n\r\n  useEffect(() => {\r\n    console.log('ğŸ”¥ EscrowPaymentFlow: Component mounting...');\r\n    console.log('ğŸ”¥ EscrowPaymentFlow: providedProperty:', providedProperty);\r\n    console.log('ğŸ”¥ EscrowPaymentFlow: providedInvestment:', providedInvestment);\r\n    \r\n    if (providedProperty || providedInvestment) {\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Data already provided, setting loading to false');\r\n      setLoading(false);\r\n    } else {\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: No data provided, will fetch from params');\r\n    }\r\n  }, [providedProperty, providedInvestment]);\r\n\r\n  useEffect(() => {\r\n    if (providedProperty || providedInvestment) {\r\n      // Already have the context we need\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const loadItem = async () => {\r\n      if (!propertyId && !investmentId) {\r\n        toast.error('No property or investment specified');\r\n        navigate('/properties');\r\n        return;\r\n      }\r\n\r\n      if (!user) {\r\n        const currentUrl = propertyId \r\n          ? `/escrow/create?propertyId=${propertyId}&type=${transactionType}`\r\n          : `/escrow/create?investmentId=${investmentId}&type=${transactionType}`;\r\n        localStorage.setItem('authRedirectUrl', currentUrl);\r\n        toast.error('Please login to continue');\r\n        navigate('/');\r\n        return;\r\n      }\r\n\r\n      clearAuthRedirect();\r\n\r\n      try {\r\n        if (propertyId) {\r\n          const propertyData = await fetchProperty(propertyId);\r\n          if (propertyData) {\r\n            setProperty(propertyData);\r\n          } else {\r\n            toast.error('Property not found');\r\n            navigate('/properties');\r\n          }\r\n        } else if (investmentId) {\r\n          let investmentData = getInvestmentById(investmentId);\r\n          \r\n          if (!investmentData) {\r\n            try {\r\n              const storedProject = localStorage.getItem('pendingInvestmentProject');\r\n              if (storedProject) {\r\n                const project = JSON.parse(storedProject);\r\n                if (project.id.toString() === investmentId.toString()) {\r\n                  investmentData = {\r\n                    id: project.id,\r\n                    investmentTitle: project.name,\r\n                    title: project.name,\r\n                    description: project.description,\r\n                    location: project.location,\r\n                    minInvestment: project.minInvestment,\r\n                    expectedROI: project.expectedROI,\r\n                    lockPeriod: project.lockPeriod,\r\n                    image: project.image,\r\n                    status: project.status || 'active',\r\n                    type: project.type\r\n                  };\r\n                }\r\n              }\r\n            } catch (error) {\r\n              console.error('Error parsing stored project:', error);\r\n            }\r\n          }\r\n          \r\n          if (investmentData) {\r\n            setInvestment(investmentData);\r\n          } else {\r\n            toast.error('Investment not found');\r\n            navigate('/investment');\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading item:', error);\r\n        toast.error('Failed to load item details');\r\n        navigate('/properties');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadItem();\r\n\r\n    return () => {\r\n      if (!providedInvestment && investmentIdFromParams) {\r\n        localStorage.removeItem('pendingInvestmentProject');\r\n      }\r\n    };\r\n  }, [propertyId, investmentId, user, fetchProperty, getInvestmentById, navigate, transactionType, clearAuthRedirect, providedProperty, providedInvestment, investmentIdFromParams]);\r\n\r\n  useEffect(() => {\r\n    hydratePendingPayment();\r\n  }, [hydratePendingPayment]);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return undefined;\r\n    const handleEscrowPaymentMessage = (event) => {\r\n      const { type, payload } = event.data || {};\r\n      if (type !== 'ESCROW_PAYMENT_STATUS' || !payload) return;\r\n      if (payload.escrowId && activeEscrowId && payload.escrowId !== activeEscrowId) return;\r\n\r\n      if (payload.status === 'success') {\r\n        setPaymentStatus('completed');\r\n        setPaymentError('');\r\n        removeEscrowPaymentEntry(payload.paymentId);\r\n        markEscrowTransactionFunded(payload.escrowId || activeEscrowId, payload.reference || payload.txRef, 'flutterwave');\r\n        setActiveEscrowId(payload.escrowId || activeEscrowId);\r\n        setPendingPayment(null);\r\n        setCheckoutUrl('');\r\n        toast.success('Payment verified! Funds are now held securely in escrow.');\r\n      } else if (payload.status === 'error') {\r\n        setPaymentStatus('failed');\r\n        const errorMessage = payload.message || 'Payment verification failed. Please try again.';\r\n        setPaymentError(errorMessage);\r\n        toast.error(errorMessage);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('message', handleEscrowPaymentMessage);\r\n    return () => window.removeEventListener('message', handleEscrowPaymentMessage);\r\n  }, [activeEscrowId, toast]);\r\n\r\n  useEffect(() => {\r\n    if (paymentStatus === 'completed') {\r\n      setStep(3);\r\n    }\r\n  }, [paymentStatus]);\r\n\r\n  useEffect(() => {\r\n    if (providedProperty) {\r\n      setProperty(providedProperty);\r\n    }\r\n  }, [providedProperty]);\r\n\r\n  useEffect(() => {\r\n    if (providedInvestment) {\r\n      setInvestment(providedInvestment);\r\n    }\r\n  }, [providedInvestment]);\r\n\r\n  // Get the current item (property or investment)\r\n  const item = property || investment;\r\n  const itemPrice = property ? property.price : (investment?.minInvestment || investment?.minimumInvestment || 0);\r\n  const escrowFee = Math.round((itemPrice || 0) * 0.005);\r\n  const totalDue = (itemPrice || 0) + escrowFee;\r\n  const itemTitle = property ? property.title : (investment?.investmentTitle || investment?.title || 'Investment Purchase');\r\n  \r\n  const calculateTotal = () => {\r\n    if (!item) return 0;\r\n    return totalDue;\r\n  };\r\n\r\n  const handlePaymentDataChange = (field, value) => {\r\n    setPaymentData(prev => ({\r\n      ...prev,\r\n      [field]: value\r\n    }));\r\n  };\r\n\r\n  const handleProceedToPayment = () => {\r\n    setStep(2);\r\n  };\r\n\r\n  const handleBackButton = () => {\r\n    if (step === 1) {\r\n      if (isModal && onClose) {\r\n        onClose();\r\n      } else {\r\n        navigate(-1);\r\n      }\r\n      return;\r\n    }\r\n    setStep((prev) => Math.max(1, prev - 1));\r\n  };\r\n\r\n  const openCheckoutWindow = (url) => {\r\n    if (!url || typeof window === 'undefined') {\r\n      toast.error('Checkout link unavailable. Please re-initialize payment.');\r\n      return;\r\n    }\r\n    \r\n    // Display checkout in a centered modal with iframe instead of popup\r\n    setShowCheckoutModal(true);\r\n  };\r\n\r\n  const handleOpenCheckout = () => {\r\n    openCheckoutWindow(checkoutUrl);\r\n  };\r\n\r\n  const handleVerifyPendingPayment = async () => {\r\n    if (!pendingPayment?.id) {\r\n      toast.error('No payment to verify. Please initialize checkout first.');\r\n      return;\r\n    }\r\n\r\n    const headers = buildAuthHeaders(user);\r\n    if (!headers) {\r\n      toast.error('Please login again to verify payment.');\r\n      return;\r\n    }\r\n\r\n    setIsPaymentVerifying(true);\r\n    setPaymentError('');\r\n\r\n    try {\r\n      const response = await fetch(getApiUrl(`/payments/${pendingPayment.id}/verify`), {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify({\r\n          providerReference: pendingPayment.txRef || pendingPayment.metadata?.flutterwave?.txRef || pendingPayment.reference,\r\n          txRef: pendingPayment.txRef || pendingPayment.reference,\r\n          status: paymentStatus\r\n        })\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (!response.ok || !data.success) {\r\n        throw new Error(data.message || 'Payment verification failed');\r\n      }\r\n\r\n      const providerStatus = (data.data?.status || '').toLowerCase();\r\n      if (providerStatus === 'completed' || providerStatus === 'success' || providerStatus === 'successful') {\r\n        setPaymentStatus('completed');\r\n        markEscrowTransactionFunded(activeEscrowId, pendingPayment.reference || pendingPayment.txRef, 'flutterwave');\r\n        removeEscrowPaymentEntry(pendingPayment.id);\r\n        setPendingPayment(null);\r\n        setCheckoutUrl('');\r\n        toast.success('Payment verified successfully!');\r\n      } else if (providerStatus === 'processing' || providerStatus === 'pending') {\r\n        setPaymentStatus('processing');\r\n        toast('Flutterwave is still processing this payment. Please try again shortly.');\r\n      } else {\r\n        setPaymentStatus('failed');\r\n        throw new Error('Payment could not be verified. Please try another attempt.');\r\n      }\r\n    } catch (error) {\r\n      console.error('EscrowPaymentFlow: manual verification error', error);\r\n      setPaymentError(error.message || 'Unable to verify payment right now.');\r\n      toast.error(error.message || 'Failed to verify payment');\r\n    } finally {\r\n      setIsPaymentVerifying(false);\r\n    }\r\n  };\r\n\r\n  const handleProcessTestPayment = async () => {\r\n    console.log('ğŸ”¥ EscrowPaymentFlow: handleProcessTestPayment called');\r\n    \r\n    try {\r\n      setLoading(true);\r\n      setPaymentError('');\r\n\r\n      const currentItem = property || investment;\r\n      const itemPriceValue = currentItem ? (property ? property.price : (investment?.minInvestment || investment?.minimumInvestment || 0)) : 0;\r\n      const itemTitleValue = property ? property.title : (investment?.investmentTitle || investment?.title || 'Investment');\r\n      const itemId = property ? property.id : investment?.id;\r\n\r\n      if (!itemId || !itemPriceValue || itemPriceValue <= 0) {\r\n        toast.error('Invalid item or price');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const sellerId = property?.owner?.id || property?.ownerId || investment?.vendorId || investment?.sponsorId || null;\r\n      \r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Creating escrow transaction for test payment...');\r\n      const escrowResult = await createEscrowTransaction(\r\n        itemId,\r\n        itemPriceValue,\r\n        user.uid || user.id,\r\n        sellerId,\r\n        {\r\n          type: transactionType === 'investment' ? 'investment' : 'property',\r\n          investmentData: investment ? {\r\n            ...investment,\r\n            title: investment.title || investment.investmentTitle,\r\n            investmentTitle: investment.investmentTitle || investment.title,\r\n            expectedROI: investment.expectedROI || investment.expectedReturn || 0,\r\n            expectedReturn: investment.expectedReturn || investment.expectedROI || 0,\r\n            lockPeriod: investment.lockPeriod || investment.termMonths || investment.duration || 0,\r\n            termMonths: investment.termMonths || investment.duration || investment.lockPeriod || 0,\r\n            duration: investment.duration || investment.termMonths || investment.lockPeriod || 0,\r\n            vendorId: investment.vendorId || investment.sponsorId,\r\n            sponsorId: investment.sponsorId || investment.vendorId,\r\n            sponsor: investment.sponsor || investment.vendor,\r\n            vendor: investment.vendor || investment.sponsor,\r\n            propertyLocation: investment.propertyLocation || (investment.location?.address ? `${investment.location.address}, ${investment.location.city}` : 'N/A')\r\n          } : null\r\n        }\r\n      );\r\n\r\n      if (!escrowResult.success) {\r\n        toast.error(escrowResult.error || 'Failed to create escrow transaction');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const escrowId = escrowResult.id || escrowResult.data?.id;\r\n      if (!escrowId) {\r\n        toast.error('Failed to get escrow transaction ID');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Simulate successful test payment\r\n      console.log('âœ… EscrowPaymentFlow: Simulating test payment completion...');\r\n      \r\n      const testReference = `TEST_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n      \r\n      markEscrowTransactionFunded(escrowId, testReference, 'test');\r\n      \r\n      const entryToSave = {\r\n        escrowId,\r\n        paymentId: `test_${escrowId}`,\r\n        reference: testReference,\r\n        txRef: testReference,\r\n        propertyId: property?.id,\r\n        investmentId: investment?.id,\r\n        status: 'completed',\r\n        checkoutUrl: '',\r\n        storedAt: Date.now(),\r\n        isTestPayment: true\r\n      };\r\n\r\n      saveEscrowPaymentEntry(entryToSave);\r\n      setPendingPayment(entryToSave);\r\n      setPaymentStatus('completed');\r\n      setStep(3);\r\n\r\n      toast.success('Test payment completed successfully!');\r\n\r\n      if (investmentId) {\r\n        localStorage.setItem('pendingInvestmentProject', JSON.stringify(investment));\r\n      }\r\n\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('âŒ EscrowPaymentFlow: Test payment error:', error);\r\n      toast.error(`Test payment failed: ${error.message || 'An error occurred'}`);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleProcessPayment = async () => {\r\n    console.log('ğŸ”¥ EscrowPaymentFlow: handleProcessPayment called');\r\n    console.log('ğŸ”¥ User:', user);\r\n    console.log('ğŸ”¥ Payment data:', paymentData);\r\n    console.log('ğŸ”¥ Property:', property);\r\n    console.log('ğŸ”¥ Investment:', investment);\r\n    \r\n    try {\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Starting validation...');\r\n      \r\n      // Validate payment data if card payment\r\n      if (paymentData.paymentMethod === 'card') {\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Validating card payment...');\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Card details:', paymentData);\r\n        if (!paymentData.cardNumber || !paymentData.expiryDate || !paymentData.cvv || !paymentData.cardholderName) {\r\n          console.log('âŒ EscrowPaymentFlow: Card validation failed');\r\n          toast.error('Please fill in all payment details');\r\n          return;\r\n        }\r\n      } else if (paymentData.paymentMethod === 'test') {\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Using test payment method');\r\n        handleProcessTestPayment();\r\n        return;\r\n      } else {\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Using Flutterwave payment, skipping card validation');\r\n      }\r\n\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Setting loading state...');\r\n      setLoading(true);\r\n      setPaymentError('');\r\n\r\n      // Step 1: Create escrow transaction using EscrowContext\r\n      const currentItem = property || investment;\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Current item:', currentItem);\r\n      \r\n      const itemPriceValue = currentItem ? (property ? property.price : (investment?.minInvestment || investment?.minimumInvestment || 0)) : 0;\r\n      const itemTitleValue = property ? property.title : (investment?.investmentTitle || investment?.title || 'Investment');\r\n      const itemId = property ? property.id : investment?.id;\r\n      \r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Item details:', { itemId, itemPriceValue, itemTitleValue });\r\n\r\n      if (!itemId || !itemPriceValue || itemPriceValue <= 0) {\r\n        console.log('âŒ EscrowPaymentFlow: Invalid item or price');\r\n        toast.error('Invalid item or price');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const sellerId = property?.owner?.id || property?.ownerId || investment?.vendorId || investment?.sponsorId || null;\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Seller ID:', sellerId);\r\n      \r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Creating escrow transaction...');\r\n      // Create escrow transaction using the context function\r\n      const escrowResult = await createEscrowTransaction(\r\n        itemId,\r\n        itemPriceValue,\r\n        user.uid || user.id,\r\n        sellerId,\r\n        {\r\n          type: transactionType === 'investment' ? 'investment' : 'property',\r\n          investmentData: investment ? {\r\n            ...investment,\r\n            title: investment.title || investment.investmentTitle,\r\n            investmentTitle: investment.investmentTitle || investment.title,\r\n            expectedROI: investment.expectedROI || investment.expectedReturn || 0,\r\n            expectedReturn: investment.expectedReturn || investment.expectedROI || 0,\r\n            lockPeriod: investment.lockPeriod || investment.termMonths || investment.duration || 0,\r\n            termMonths: investment.termMonths || investment.duration || investment.lockPeriod || 0,\r\n            duration: investment.duration || investment.termMonths || investment.lockPeriod || 0,\r\n            vendorId: investment.vendorId || investment.sponsorId,\r\n            sponsorId: investment.sponsorId || investment.vendorId,\r\n            sponsor: investment.sponsor || investment.vendor,\r\n            vendor: investment.vendor || investment.sponsor,\r\n            propertyLocation: investment.propertyLocation || (investment.location?.address ? `${investment.location.address}, ${investment.location.city}` : 'N/A')\r\n          } : null\r\n        }\r\n      );\r\n\r\n      console.log('ğŸ”¥ EscrowPaymentFlow: Escrow result:', escrowResult);\r\n\r\n      if (!escrowResult.success) {\r\n        toast.error(escrowResult.error || 'Failed to create escrow transaction');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const escrowId = escrowResult.id || escrowResult.data?.id;\r\n      if (!escrowId) {\r\n        toast.error('Failed to get escrow transaction ID');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const headers = buildAuthHeaders(user);\r\n      if (!headers) {\r\n        toast.error('Unable to determine authentication headers. Please login again.');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      setActiveEscrowId(escrowId);\r\n\r\n      try {\r\n        setIsInitializingPayment(true);\r\n        console.log('ğŸš€ EscrowPaymentFlow: Starting payment initialization...');\r\n\r\n        const payload = {\r\n          amount: itemPriceValue,\r\n          paymentMethod: 'flutterwave',\r\n          paymentType: 'escrow',\r\n          relatedEntity: {\r\n            type: transactionType === 'investment' ? 'investment' : 'property',\r\n            id: escrowId,\r\n            metadata: {\r\n              escrowId,\r\n              propertyId: property?.id || null,\r\n              investmentId: investment?.id || null\r\n            }\r\n          },\r\n          description: buildPaymentDescription(itemTitleValue, transactionType),\r\n          currency: 'NGN'\r\n        };\r\n        \r\n        console.log('ğŸ”¥ EscrowPaymentFlow: API Payload:', payload);\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: API URL:', getApiUrl('/payments/initialize'));\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Headers:', headers);\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Cache busting with timestamp:', Date.now());\r\n\r\n        const response = await fetch(getApiUrl('/payments/initialize'), {\r\n          method: 'POST',\r\n          headers,\r\n          body: JSON.stringify(payload),\r\n          cache: 'no-store'\r\n        });\r\n\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Response status:', response.status);\r\n        const data = await response.json();\r\n        console.log('ğŸ”¥ EscrowPaymentFlow: Response data:', data);\r\n\r\n        if (!response.ok || !data.success) {\r\n          // Try to extract a provider-reported maximum charge or friendly message\r\n          const pd = data.data?.providerData || data.providerData || data.error?.providerData || data.error?.meta || {};\r\n          const rawMsg = data.message || pd?.message || data.error?.message || '';\r\n          // look for numeric max in several possible keys\r\n          const maxCandidates = [pd?.maximum_amount, pd?.maximumAmount, pd?.max_amount, pd?.maxAmount, pd?.max_charge, pd?.maxCharge];\r\n          const foundMax = maxCandidates.find(v => Number.isFinite(Number(v))) || null;\r\n          if (foundMax) {\r\n            setProviderLimit(Number(foundMax));\r\n            setPaymentError(`Charge amount must not exceed ${formatCurrency(Number(foundMax))}. Try Bank Transfer or split the payment.`);\r\n            setIsInitializingPayment(false);\r\n            return;\r\n          }\r\n\r\n          // fallback: inspect message text for 'exceed' patterns\r\n          if (/exceed|maximum|max/i.test(rawMsg)) {\r\n            setPaymentError(rawMsg || 'Charge amount exceeds provider limit. Try another payment method.');\r\n            setIsInitializingPayment(false);\r\n            return;\r\n          }\r\n\r\n          throw new Error(data.message || 'Failed to initialize payment');\r\n        }\r\n\r\n        const providerData = data.data?.providerData || {};\r\n        const paymentRecord = data.data?.payment || data.data;\r\n        const authorizationUrl = providerData.authorizationUrl || providerData.link;\r\n        const providerReference = providerData.txRef || providerData.tx_ref || paymentRecord?.reference;\r\n\r\n        if (!authorizationUrl) {\r\n          throw new Error('Payment authorization link missing from response');\r\n        }\r\n\r\n        const entryToSave = {\r\n          escrowId,\r\n          paymentId: paymentRecord?.id,\r\n          reference: paymentRecord?.reference,\r\n          txRef: providerReference,\r\n          propertyId: property?.id,\r\n          investmentId: investment?.id,\r\n          status: 'processing',\r\n          checkoutUrl: authorizationUrl,\r\n          storedAt: Date.now()\r\n        };\r\n\r\n        saveEscrowPaymentEntry(entryToSave);\r\n        setPendingPayment(entryToSave);\r\n        setCheckoutUrl(authorizationUrl);\r\n        setPaymentStatus('processing');\r\n        setStep(2);\r\n\r\n        openCheckoutWindow(authorizationUrl);\r\n        toast.success('Flutterwave checkout launched. Complete payment to proceed.');\r\n\r\n        if (investmentId) {\r\n          localStorage.setItem('pendingInvestmentProject', JSON.stringify(investment));\r\n        }\r\n        } catch (initError) {\r\n          console.error('EscrowPaymentFlow: payment initialization error', initError);\r\n          setPaymentError(initError.message || 'Unable to initialize payment.');\r\n          toast.error(initError.message || 'Failed to initialize payment');\r\n        } finally {\r\n        setIsInitializingPayment(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('âŒ EscrowPaymentFlow: Payment error:', error);\r\n      console.error('âŒ EscrowPaymentFlow: Error details:', error.message);\r\n      console.error('âŒ EscrowPaymentFlow: Error stack:', error.stack);\r\n      toast.error(`Payment failed: ${error.message || 'An error occurred'}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleBackToDashboard = () => {\r\n    navigate('/dashboard');\r\n  };\r\n\r\n  if (loading) {\r\n    const spinner = (\r\n      <div className=\"flex items-center justify-center w-full py-16\">\r\n        <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n\r\n    return isModal ? (\r\n      <div className=\"bg-white rounded-2xl shadow-2xl p-6\">{spinner}</div>\r\n    ) : (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!property && !investment) {\r\n    const emptyState = (\r\n      <div className=\"text-center\">\r\n        <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n          {propertyId ? 'Property Not Found' : 'Investment Not Found'}\r\n        </h2>\r\n        <button\r\n          onClick={() => {\r\n            if (isModal && onClose) {\r\n              onClose();\r\n              return;\r\n            }\r\n            propertyId ? navigate('/properties') : navigate('/investment');\r\n          }}\r\n          className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n        >\r\n          {propertyId ? 'Back to Properties' : 'Back to Investments'}\r\n        </button>\r\n      </div>\r\n    );\r\n\r\n    return isModal ? (\r\n      <div className=\"bg-white rounded-2xl shadow-2xl p-6\">{emptyState}</div>\r\n    ) : (\r\n      <div className=\"min-h-screen flex items-center justify-center\">{emptyState}</div>\r\n    );\r\n  }\r\n\r\n  const content = (\r\n    <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n      {/* Header */}\r\n      <div className=\"mb-8\">\r\n        <button\r\n          onClick={handleBackButton}\r\n          className=\"flex items-center text-gray-600 hover:text-gray-800 mb-4\"\r\n        >\r\n          <FaArrowLeft className=\"mr-2\" />\r\n          {step === 1 ? (property ? 'Back to Property' : 'Back to Investment') : 'Previous Step'}\r\n        </button>\r\n\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\r\n          {step === 1 ? (property ? 'Review Purchase' : 'Review Investment') : step === 2 ? 'Payment Details' : 'Payment Confirmation'}\r\n        </h1>\r\n\r\n        {/* Progress Steps */}\r\n        <div className=\"flex items-center space-x-4 mt-4\">\r\n          {[1, 2, 3].map((stepNum) => (\r\n            <div key={stepNum} className=\"flex items-center\">\r\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\r\n                step >= stepNum ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'\r\n              }`}>\r\n                {step > stepNum ? <FaCheck /> : stepNum}\r\n              </div>\r\n              {stepNum < 3 && (\r\n                <div className={`w-16 h-1 mx-2 ${step > stepNum ? 'bg-blue-600' : 'bg-gray-200'}`} />\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Step 1: Review Purchase/Investment */}\r\n      {step === 1 && (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n          {/* Property/Investment Details */}\r\n          <div className=\"bg-white rounded-lg shadow p-6\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\r\n              {property ? 'Property Details' : 'Investment Details'}\r\n            </h2>\r\n\r\n            <div className=\"flex items-start space-x-4 mb-6\">\r\n              <img\r\n                src={item?.image || item?.images?.[0]?.url || 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=200&h=150&fit=crop'}\r\n                alt={item?.title || item?.investmentTitle || item?.name}\r\n                className=\"w-32 h-24 object-cover rounded-lg\"\r\n              />\r\n              <div>\r\n                <h3 className=\"font-semibold text-gray-900\">\r\n                  {item?.title || item?.investmentTitle || item?.name}\r\n                </h3>\r\n                <p className=\"text-gray-600\">{item?.location || 'Location pending'}</p>\r\n                <p className=\"text-sm text-gray-500 mt-1 line-clamp-3\">{item?.description || 'Property description will be shared by the vendor.'}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-gray-600\">Property Price</span>\r\n                <span className=\"font-semibold text-gray-900\">{formatCurrency(itemPrice)}</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-gray-600\">Escrow Protection Fee (0.5%)</span>\r\n                <span className=\"font-semibold text-gray-900\">{formatCurrency(escrowFee)}</span>\r\n              </div>\r\n              <div className=\"border-t border-gray-200 pt-3 flex items-center justify-between\">\r\n                <span className=\"text-lg font-semibold text-gray-900\">Total Due Today</span>\r\n                <span className=\"text-2xl font-bold text-blue-600\">{formatCurrency(totalDue)}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Benefits */}\r\n          <div className=\"bg-white rounded-lg shadow p-6\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Escrow Protection Benefits</h2>\r\n            <div className=\"space-y-4\">\r\n              {[{\r\n                title: 'Secure Payment Holding',\r\n                description: 'Your funds stay in escrow until every milestone you approve is met.'\r\n              }, {\r\n                title: 'Document Verification',\r\n                description: 'The team verifies title, inspection reports, and contract documents.'\r\n              }, {\r\n                title: 'Dispute Resolution',\r\n                description: 'Dedicated mediation support with guaranteed refund safeguards.'\r\n              }].map((benefit) => (\r\n                <div key={benefit.title} className=\"flex items-start space-x-3\">\r\n                  <FaLock className=\"text-blue-600 mt-1\" />\r\n                  <div>\r\n                    <h3 className=\"font-semibold text-gray-900\">{benefit.title}</h3>\r\n                    <p className=\"text-gray-600 text-sm\">{benefit.description}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            <button\r\n              onClick={handleProceedToPayment}\r\n              className=\"w-full mt-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2\"\r\n            >\r\n              <FaShoppingCart />\r\n              <span>Continue to Payment</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Step 2: Payment Details */}\r\n      {step === 2 && (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n          <div className=\"bg-white rounded-lg shadow p-6 space-y-6\">\r\n            {/* Payment Method Selection */}\r\n            <div className=\"space-y-3\">\r\n              <label className=\"block text-sm font-semibold text-gray-900\">Payment Method</label>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setPaymentData(prev => ({ ...prev, paymentMethod: 'flutterwave' }))}\r\n                  className={`p-4 border-2 rounded-lg transition ${\r\n                    paymentData.paymentMethod === 'flutterwave'\r\n                      ? 'border-blue-600 bg-blue-50'\r\n                      : 'border-gray-200 hover:border-gray-300'\r\n                  }`}\r\n                >\r\n                  <div className=\"text-center\">\r\n                    <FaCreditCard className=\"mx-auto text-xl mb-2 text-blue-600\" />\r\n                    <p className=\"font-medium text-gray-900 text-sm\">Flutterwave</p>\r\n                  </div>\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setPaymentData(prev => ({ ...prev, paymentMethod: 'test' }))}\r\n                  className={`p-4 border-2 rounded-lg transition ${\r\n                    paymentData.paymentMethod === 'test'\r\n                      ? 'border-green-600 bg-green-50'\r\n                      : 'border-gray-200 hover:border-gray-300'\r\n                  }`}\r\n                >\r\n                  <div className=\"text-center\">\r\n                    <FaCheck className=\"mx-auto text-xl mb-2 text-green-600\" />\r\n                    <p className=\"font-medium text-gray-900 text-sm\">Test Payment</p>\r\n                  </div>\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {paymentData.paymentMethod === 'flutterwave' && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h2 className=\"text-xl font-semibold text-gray-900\">Flutterwave Checkout</h2>\r\n                  <span className=\"text-sm text-gray-500\">Secure â€¢ Encrypted â€¢ Instant</span>\r\n                </div>\r\n\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    console.log('ğŸ”¥ EscrowPaymentFlow: Button clicked!');\r\n                    console.log('ğŸ”¥ EscrowPaymentFlow: loading:', loading);\r\n                    console.log('ğŸ”¥ EscrowPaymentFlow: isInitializingPayment:', isInitializingPayment);\r\n                    console.log('ğŸ”¥ EscrowPaymentFlow: step:', step);\r\n                    handleProcessPayment();\r\n                  }}\r\n                  disabled={loading || isInitializingPayment}\r\n                  className=\"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70\"\r\n                >\r\n                  {isInitializingPayment ? (\r\n                    <>\r\n                      <FaCreditCard className=\"animate-spin\" />\r\n                      <span>Initializing Flutterwave...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FaCreditCard />\r\n                      <span>Re-launch Flutterwave Checkout</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {paymentData.paymentMethod === 'test' && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n                  <p className=\"text-sm text-green-900 font-semibold\">Test Payment Mode</p>\r\n                  <p className=\"text-xs text-green-800 mt-1\">This will simulate a successful payment for testing purposes.</p>\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    setPaymentData(prev => ({ ...prev, paymentMethod: 'test' }));\r\n                    handleProcessPayment();\r\n                  }}\r\n                  disabled={loading}\r\n                  className=\"w-full bg-green-600 text-white py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70 hover:bg-green-700 transition\"\r\n                >\r\n                  {loading ? (\r\n                    <>\r\n                      <FaSpinner className=\"animate-spin\" />\r\n                      <span>Processing Test Payment...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FaCheck />\r\n                      <span>Complete Test Payment</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {checkoutUrl && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleOpenCheckout}\r\n                className=\"w-full border border-blue-600 text-blue-600 py-3 rounded-lg font-semibold\"\r\n              >\r\n                Open Checkout Window\r\n              </button>\r\n            )}\r\n\r\n            {pendingPayment && (\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                <p className=\"font-semibold text-blue-900\">Payment in progress</p>\r\n                <p className=\"text-sm text-blue-800 mt-1\">\r\n                  Reference: {pendingPayment.txRef || pendingPayment.reference}\r\n                </p>\r\n                <p className=\"text-xs text-blue-700 mt-2\">Please complete the Flutterwave checkout or click verify once done.</p>\r\n\r\n                <div className=\"mt-4 flex flex-col gap-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleVerifyPendingPayment}\r\n                    disabled={isPaymentVerifying}\r\n                    className=\"w-full bg-green-600 text-white py-2 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70\"\r\n                  >\r\n                    {isPaymentVerifying ? (\r\n                      <>\r\n                        <FaSpinner className=\"animate-spin\" />\r\n                        <span>Verifying...</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <FaCheck />\r\n                        <span>Verify Payment</span>\r\n                      </>\r\n                    )}\r\n                  </button>\r\n\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleOpenCheckout}\r\n                    className=\"w-full border border-blue-600 text-blue-600 py-2 rounded-lg font-semibold\"\r\n                  >\r\n                    Resume Payment\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {paymentError && (\r\n              <div className=\"bg-red-50 border border-red-200 text-red-700 rounded-lg p-3 text-sm\">\r\n                {paymentError}\r\n              </div>\r\n            )}\r\n            {providerLimit && (\r\n              <div className=\"mt-3 text-sm text-gray-700\">\r\n                Suggested actions: split the payment into smaller amounts, or use Bank Transfer which supports larger transfers.\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-lg shadow p-6 space-y-4\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900\">Payment Summary</h2>\r\n            <div className=\"flex justify-between text-gray-600\">\r\n              <span>Escrow for</span>\r\n              <span className=\"font-medium text-gray-900\">{itemTitle}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-gray-600\">Amount</span>\r\n              <span className=\"font-semibold text-gray-900\">{formatCurrency(itemPrice)}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-gray-600\">Escrow Fee</span>\r\n              <span className=\"font-semibold text-gray-900\">{formatCurrency(escrowFee)}</span>\r\n            </div>\r\n            <div className=\"border-t border-gray-200 pt-4 flex justify-between items-center\">\r\n              <span className=\"text-lg font-semibold text-gray-900\">Total</span>\r\n              <span className=\"text-2xl font-bold text-blue-600\">{formatCurrency(totalDue)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Step 3: Confirmation */}\r\n      {step === 3 && (\r\n        <div className=\"max-w-2xl mx-auto\">\r\n          <div className=\"bg-white rounded-lg shadow p-6 text-center\">\r\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <FaCheck className=\"text-green-600 text-2xl\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Payment Successful!</h2>\r\n            <p className=\"text-gray-600 mb-6\">\r\n              Your payment of <strong>{formatCurrency(totalDue)}</strong> is now held securely in escrow.\r\n            </p>\r\n\r\n            <div className=\"bg-green-50 p-4 rounded-lg mb-6 text-left\">\r\n              <h3 className=\"font-semibold text-green-900 mb-3 flex items-center\">\r\n                <FaLock className=\"mr-2\" />\r\n                Escrow Protection Active\r\n              </h3>\r\n              <div className=\"text-sm text-green-800 space-y-2\">\r\n                <div className=\"flex items-center\">\r\n                  <FaCheckCircle className=\"mr-2 text-green-600\" />\r\n                  <span><strong>Funds Secured:</strong> Held until you approve release.</span>\r\n                </div>\r\n                <div className=\"flex items-center\">\r\n                  <FaUserCheck className=\"mr-2 text-green-600\" />\r\n                  <span><strong>Your Control:</strong> Nothing moves without your authorization.</span>\r\n                </div>\r\n                <div className=\"flex items-center\">\r\n                  <FaHandshake className=\"mr-2 text-green-600\" />\r\n                  <span><strong>Dispute Resolution:</strong> Mediation + refund guarantees.</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-blue-50 p-4 rounded-lg mb-6 text-left\">\r\n              <h3 className=\"font-semibold text-blue-900 mb-2\">What happens next?</h3>\r\n              <ol className=\"text-sm text-blue-800 space-y-1 list-decimal list-inside\">\r\n                <li>Property documents verification begins immediately.</li>\r\n                <li>Our escrow officer reaches out to schedule inspection.</li>\r\n                <li>You approve the property condition and paperwork.</li>\r\n                <li>Funds release only after your final approval.</li>\r\n              </ol>\r\n            </div>\r\n\r\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:space-x-4\">\r\n              <button\r\n                onClick={() => navigate('/escrow')}\r\n                className=\"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors\"\r\n              >\r\n                View Escrow Status\r\n              </button>\r\n              <button\r\n                onClick={handleBackToDashboard}\r\n                className=\"flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors\"\r\n              >\r\n                Back to Dashboard\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  if (isModal) {\r\n    return (\r\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\">\r\n        <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col overflow-hidden\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"absolute top-4 right-4 text-gray-500 hover:text-gray-700 z-10 bg-white rounded-full p-1 shadow-md hover:bg-gray-100\"\r\n            aria-label=\"Close payment flow\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n          <div className=\"flex-1 overflow-y-auto p-4 md:p-6\">\r\n            {content}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Flutterwave Checkout Modal */}\r\n        {showCheckoutModal && checkoutUrl && (\r\n          <div className=\"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-2xl shadow-2xl w-full md:max-w-5xl lg:max-w-6xl max-h-[95vh] flex flex-col overflow-hidden\">\r\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">Flutterwave Payment</h3>\r\n                <button\r\n                  onClick={() => setShowCheckoutModal(false)}\r\n                  className=\"text-gray-500 hover:text-gray-700 bg-gray-100 rounded-full p-2 hover:bg-gray-200 transition-colors\"\r\n                  aria-label=\"Close checkout\"\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n              <div className=\"flex-1 overflow-hidden\">\r\n                <iframe\r\n                  src={checkoutUrl}\r\n                  title=\"Flutterwave Checkout\"\r\n                  className=\"w-full h-[75vh] min-h-[640px] border-none\"\r\n                  allow=\"payment\"\r\n                  sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-8\">\r\n      {content}\r\n      \r\n      {/* Flutterwave Checkout Modal - Full Page */}\r\n      {showCheckoutModal && checkoutUrl && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl w-full md:max-w-5xl lg:max-w-6xl max-h-[95vh] flex flex-col overflow-hidden\">\r\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900\">Flutterwave Payment</h3>\r\n              <button\r\n                onClick={() => setShowCheckoutModal(false)}\r\n                className=\"text-gray-500 hover:text-gray-700 bg-gray-100 rounded-full p-2 hover:bg-gray-200 transition-colors\"\r\n                aria-label=\"Close checkout\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"flex-1 overflow-hidden\">\r\n              <iframe\r\n                src={checkoutUrl}\r\n                title=\"Flutterwave Checkout\"\r\n                className=\"w-full h-[75vh] min-h-[640px] border-none\"\r\n                allow=\"payment\"\r\n                sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EscrowPaymentFlow;\r\n\r\n\r\n"],"names":["ESCROW_PAYMENT_STORAGE_KEY","readEscrowPaymentEntries","window","raw","localStorage","getItem","JSON","parse","error","console","warn","saveEscrowPaymentEntry","entry","updated","filter","item","paymentId","txRef","push","setItem","stringify","buildAuthHeaders","user","token","getStoredToken","_unused","fallbackEmail","email","headers","Authorization","concat","removeEscrowPaymentEntry","filtered","markEscrowTransactionFunded","escrowId","reference","method","arguments","length","undefined","updatedTransactions","map","transaction","_transaction$payment","id","_objectSpread","status","payment","paidAt","Date","toISOString","fundedAt","formatCurrency","value","amount","Number","isFinite","Intl","NumberFormat","style","currency","maximumFractionDigits","format","buildPaymentDescription","itemTitle","transactionType","_ref","_item$images","_item$images$","property","providedProperty","investment","providedInvestment","providedTransactionType","onClose","navigate","useNavigate","searchParams","useSearchParams","clearAuthRedirect","useAuth","fetchProperty","useProperty","createEscrowTransaction","useEscrow","investments","getInvestmentById","useInvestment","propertyIdFromParams","get","investmentIdFromParams","setProperty","useState","setInvestment","loading","setLoading","step","setStep","paymentData","setPaymentData","paymentMethod","cardNumber","expiryDate","cvv","cardholderName","pendingPayment","setPendingPayment","paymentStatus","setPaymentStatus","paymentError","setPaymentError","providerLimit","setProviderLimit","checkoutUrl","setCheckoutUrl","isPaymentVerifying","setIsPaymentVerifying","activeEscrowId","setActiveEscrowId","isInitializingPayment","setIsInitializingPayment","showCheckoutModal","setShowCheckoutModal","propertyId","investmentId","typeFromParams","isModal","Boolean","hydratePendingPayment","useCallback","entries","match","find","prev","useEffect","log","async","toast","currentUrl","propertyData","investmentData","storedProject","project","toString","investmentTitle","name","title","description","location","minInvestment","expectedROI","lockPeriod","image","type","loadItem","removeItem","handleEscrowPaymentMessage","event","payload","data","success","errorMessage","message","addEventListener","removeEventListener","itemPrice","price","minimumInvestment","escrowFee","Math","round","totalDue","openCheckoutWindow","url","handleOpenCheckout","handleProcessPayment","_property$owner2","_investment$location2","_escrowResult$data2","_property$owner","_investment$location","_escrowResult$data","itemPriceValue","itemId","sellerId","owner","ownerId","vendorId","sponsorId","escrowResult","uid","expectedReturn","termMonths","duration","sponsor","vendor","propertyLocation","address","city","testReference","now","random","substr","entryToSave","storedAt","isTestPayment","handleProcessTestPayment","currentItem","itemTitleValue","_data$data3","_data$data4","paymentType","relatedEntity","metadata","getApiUrl","response","fetch","body","cache","json","ok","_data$data2","_data$error","_data$error2","_data$error3","pd","providerData","meta","rawMsg","foundMax","maximum_amount","maximumAmount","max_amount","maxAmount","max_charge","maxCharge","v","test","Error","paymentRecord","authorizationUrl","link","providerReference","tx_ref","initError","stack","spinner","_jsx","className","children","emptyState","_jsxs","onClick","content","handleBackButton","max","FaArrowLeft","stepNum","FaCheck","src","images","alt","benefit","FaLock","handleProceedToPayment","FaShoppingCart","FaCreditCard","disabled","_Fragment","FaSpinner","_pendingPayment$metad","_pendingPayment$metad2","_data$data","flutterwave","providerStatus","toLowerCase","FaCheckCircle","FaUserCheck","FaHandshake","handleBackToDashboard","fill","stroke","viewBox","xmlns","strokeLinecap","strokeLinejoin","strokeWidth","d","allow","sandbox"],"sourceRoot":""}