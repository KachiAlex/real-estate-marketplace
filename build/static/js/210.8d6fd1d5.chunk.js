"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[210],{7210(e,t,s){s.r(t),s.d(t,{default:()=>N});var o=s(9379),n=s(5043),r=s(5475),l=s(3216),i=s(4345),a=s(3823),d=s(5016),c=s(2825),m=s(5369),u=s(2339),x=s(1876),p=s(579);const v="escrowPayments",y=()=>{if("undefined"===typeof window)return[];try{const e=window.localStorage.getItem(v);return e?JSON.parse(e):[]}catch(e){return console.warn("EscrowPaymentFlow: unable to read escrow payments from storage",e),[]}},h=e=>{if("undefined"!==typeof window)try{const t=y().filter(t=>t.paymentId!==e.paymentId&&t.txRef!==e.txRef);t.push(e),window.localStorage.setItem(v,JSON.stringify(t))}catch(t){console.warn("EscrowPaymentFlow: unable to save escrow payment entry",t)}},g=e=>{const t=(null===e||void 0===e?void 0:e.token)||(()=>{if("undefined"===typeof window)return null;try{return window.localStorage.getItem("token")}catch(e){return null}})(),s=null===e||void 0===e?void 0:e.email;if(!t&&!s)return null;const o={"Content-Type":"application/json"};return t?o.Authorization="Bearer ".concat(t):s&&(o["X-Mock-User-Email"]=s),o},f=e=>{if("undefined"!==typeof window)try{const t=y().filter(t=>t.paymentId!==e);window.localStorage.setItem(v,JSON.stringify(t))}catch(t){console.warn("EscrowPaymentFlow: unable to remove escrow payment entry",t)}},w=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flutterwave";if(e&&"undefined"!==typeof window)try{const n=JSON.parse(localStorage.getItem("escrowTransactions")||"[]").map(n=>{var r;return n.id===e?(0,o.A)((0,o.A)({},n),{},{status:"payment_received",payment:(0,o.A)((0,o.A)({},n.payment||{}),{},{method:s,reference:t||(null===(r=n.payment)||void 0===r?void 0:r.reference),paidAt:(new Date).toISOString()}),fundedAt:(new Date).toISOString()}):n});localStorage.setItem("escrowTransactions",JSON.stringify(n))}catch(n){console.warn("EscrowPaymentFlow: unable to mark escrow transaction funded",n)}},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=Number.isFinite(e)?e:0;return new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",maximumFractionDigits:0}).format(t)},j=(e,t)=>"investment"===t?"Escrow funding for investment opportunity: ".concat(e):"Escrow payment for property purchase: ".concat(e),N=e=>{var t,s;let{property:v=null,investment:N=null,transactionType:P="purchase",onClose:I}=e;const k=(0,l.Zp)(),[F]=(0,r.ok)(),{user:E,clearAuthRedirect:A}=(0,d.As)(),{fetchProperty:S}=(0,i.NC)(),{createEscrowTransaction:C}=(0,a.N)(),{investments:T,getInvestmentById:R}=(0,c.H)(),M=F.get("propertyId"),D=F.get("investmentId"),[O,z]=(0,n.useState)(v),[L,B]=(0,n.useState)(N),[U,_]=(0,n.useState)(!(v||N)),[J,H]=(0,n.useState)(1),[V,W]=(0,n.useState)({paymentMethod:"flutterwave",cardNumber:"",expiryDate:"",cvv:"",cardholderName:""}),[Y,G]=(0,n.useState)(null),[Q,X]=(0,n.useState)("idle"),[Z,q]=(0,n.useState)(""),[K,$]=(0,n.useState)(null),[ee,te]=(0,n.useState)(""),[se,oe]=(0,n.useState)(!1),[ne,re]=(0,n.useState)(null),[le,ie]=(0,n.useState)(!1),[ae,de]=(0,n.useState)(!1),ce=(null===v||void 0===v?void 0:v.id)||(null===v||void 0===v?void 0:v.propertyId)||M,me=(null===N||void 0===N?void 0:N.id)||D,ue=F.get("type")||"purchase",xe=v||N?P:ue,pe=Boolean(I),ve=(0,n.useCallback)(()=>{if("undefined"===typeof window)return;const e=y();if(!e||0===e.length)return;const t=e.find(e=>!(!ne||e.escrowId!==ne)||(!(null===O||void 0===O||!O.id||e.propertyId!==O.id)||!(null===L||void 0===L||!L.id||e.investmentId!==L.id)));t&&(G(t),X(t.status||"processing"),te(t.checkoutUrl||""),t.escrowId&&re(t.escrowId),H(e=>e<2?2:e))},[null===O||void 0===O?void 0:O.id,null===L||void 0===L?void 0:L.id,ne]);(0,n.useEffect)(()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: Component mounting..."),console.log("\ud83d\udd25 EscrowPaymentFlow: providedProperty:",v),console.log("\ud83d\udd25 EscrowPaymentFlow: providedInvestment:",N),v||N?(console.log("\ud83d\udd25 EscrowPaymentFlow: Data already provided, setting loading to false"),_(!1)):console.log("\ud83d\udd25 EscrowPaymentFlow: No data provided, will fetch from params")},[v,N]),(0,n.useEffect)(()=>{if(v||N)return void _(!1);return(async()=>{if(!ce&&!me)return u.Ay.error("No property or investment specified"),void k("/properties");if(!E){const e=ce?"/escrow/create?propertyId=".concat(ce,"&type=").concat(xe):"/escrow/create?investmentId=".concat(me,"&type=").concat(xe);return localStorage.setItem("authRedirectUrl",e),u.Ay.error("Please login to continue"),void k("/")}A();try{if(ce){const e=await S(ce);e?z(e):(u.Ay.error("Property not found"),k("/properties"))}else if(me){let t=R(me);if(!t)try{const e=localStorage.getItem("pendingInvestmentProject");if(e){const s=JSON.parse(e);s.id.toString()===me.toString()&&(t={id:s.id,investmentTitle:s.name,title:s.name,description:s.description,location:s.location,minInvestment:s.minInvestment,expectedROI:s.expectedROI,lockPeriod:s.lockPeriod,image:s.image,status:s.status||"active",type:s.type})}}catch(e){console.error("Error parsing stored project:",e)}t?B(t):(u.Ay.error("Investment not found"),k("/investment"))}}catch(e){console.error("Error loading item:",e),u.Ay.error("Failed to load item details"),k("/properties")}finally{_(!1)}})(),()=>{!N&&D&&localStorage.removeItem("pendingInvestmentProject")}},[ce,me,E,S,R,k,xe,A,v,N,D]),(0,n.useEffect)(()=>{ve()},[ve]),(0,n.useEffect)(()=>{if("undefined"===typeof window)return;const e=e=>{const{type:t,payload:s}=e.data||{};if("ESCROW_PAYMENT_STATUS"===t&&s&&(!s.escrowId||!ne||s.escrowId===ne))if("success"===s.status)X("completed"),q(""),f(s.paymentId),w(s.escrowId||ne,s.reference||s.txRef,"flutterwave"),re(s.escrowId||ne),G(null),te(""),u.Ay.success("Payment verified! Funds are now held securely in escrow.");else if("error"===s.status){X("failed");const e=s.message||"Payment verification failed. Please try again.";q(e),u.Ay.error(e)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[ne,u.Ay]),(0,n.useEffect)(()=>{"completed"===Q&&H(3)},[Q]),(0,n.useEffect)(()=>{v&&z(v)},[v]),(0,n.useEffect)(()=>{N&&B(N)},[N]);const ye=O||L,he=O?O.price:(null===L||void 0===L?void 0:L.minInvestment)||(null===L||void 0===L?void 0:L.minimumInvestment)||0,ge=Math.round(.005*(he||0)),fe=(he||0)+ge,we=O?O.title:(null===L||void 0===L?void 0:L.investmentTitle)||(null===L||void 0===L?void 0:L.title)||"Investment Purchase",be=e=>{e&&"undefined"!==typeof window?de(!0):u.Ay.error("Checkout link unavailable. Please re-initialize payment.")},je=()=>{be(ee)},Ne=async()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: handleProcessPayment called"),console.log("\ud83d\udd25 User:",E),console.log("\ud83d\udd25 Payment data:",V),console.log("\ud83d\udd25 Property:",O),console.log("\ud83d\udd25 Investment:",L);try{var e,t,s;if(console.log("\ud83d\udd25 EscrowPaymentFlow: Starting validation..."),"card"===V.paymentMethod){if(console.log("\ud83d\udd25 EscrowPaymentFlow: Validating card payment..."),console.log("\ud83d\udd25 EscrowPaymentFlow: Card details:",V),!V.cardNumber||!V.expiryDate||!V.cvv||!V.cardholderName)return console.log("\u274c EscrowPaymentFlow: Card validation failed"),void u.Ay.error("Please fill in all payment details")}else{if("test"===V.paymentMethod)return console.log("\ud83d\udd25 EscrowPaymentFlow: Using test payment method"),void(async()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: handleProcessTestPayment called");try{var e,t,s;_(!0),q("");const n=O||L?O?O.price:(null===L||void 0===L?void 0:L.minInvestment)||(null===L||void 0===L?void 0:L.minimumInvestment)||0:0,r=(O?O.title:(null===L||void 0===L?void 0:L.investmentTitle)||null===L||void 0===L||L.title,O?O.id:null===L||void 0===L?void 0:L.id);if(!r||!n||n<=0)return u.Ay.error("Invalid item or price"),void _(!1);const l=(null===O||void 0===O||null===(e=O.owner)||void 0===e?void 0:e.id)||(null===O||void 0===O?void 0:O.ownerId)||(null===L||void 0===L?void 0:L.vendorId)||(null===L||void 0===L?void 0:L.sponsorId)||null;console.log("\ud83d\udd25 EscrowPaymentFlow: Creating escrow transaction for test payment...");const i=await C(r,n,E.uid||E.id,l,{type:"investment"===xe?"investment":"property",investmentData:L?(0,o.A)((0,o.A)({},L),{},{title:L.title||L.investmentTitle,investmentTitle:L.investmentTitle||L.title,expectedROI:L.expectedROI||L.expectedReturn||0,expectedReturn:L.expectedReturn||L.expectedROI||0,lockPeriod:L.lockPeriod||L.termMonths||L.duration||0,termMonths:L.termMonths||L.duration||L.lockPeriod||0,duration:L.duration||L.termMonths||L.lockPeriod||0,vendorId:L.vendorId||L.sponsorId,sponsorId:L.sponsorId||L.vendorId,sponsor:L.sponsor||L.vendor,vendor:L.vendor||L.sponsor,propertyLocation:L.propertyLocation||(null!==(t=L.location)&&void 0!==t&&t.address?"".concat(L.location.address,", ").concat(L.location.city):"N/A")}):null});if(!i.success)return u.Ay.error(i.error||"Failed to create escrow transaction"),void _(!1);const a=i.id||(null===(s=i.data)||void 0===s?void 0:s.id);if(!a)return u.Ay.error("Failed to get escrow transaction ID"),void _(!1);console.log("\u2705 EscrowPaymentFlow: Simulating test payment completion...");const d="TEST_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));w(a,d,"test");const c={escrowId:a,paymentId:"test_".concat(a),reference:d,txRef:d,propertyId:null===O||void 0===O?void 0:O.id,investmentId:null===L||void 0===L?void 0:L.id,status:"completed",checkoutUrl:"",storedAt:Date.now(),isTestPayment:!0};h(c),G(c),X("completed"),H(3),u.Ay.success("Test payment completed successfully!"),me&&localStorage.setItem("pendingInvestmentProject",JSON.stringify(L)),_(!1)}catch(n){console.error("\u274c EscrowPaymentFlow: Test payment error:",n),u.Ay.error("Test payment failed: ".concat(n.message||"An error occurred")),_(!1)}})();console.log("\ud83d\udd25 EscrowPaymentFlow: Using Flutterwave payment, skipping card validation")}console.log("\ud83d\udd25 EscrowPaymentFlow: Setting loading state..."),_(!0),q("");const m=O||L;console.log("\ud83d\udd25 EscrowPaymentFlow: Current item:",m);const p=m?O?O.price:(null===L||void 0===L?void 0:L.minInvestment)||(null===L||void 0===L?void 0:L.minimumInvestment)||0:0,v=O?O.title:(null===L||void 0===L?void 0:L.investmentTitle)||(null===L||void 0===L?void 0:L.title)||"Investment",y=O?O.id:null===L||void 0===L?void 0:L.id;if(console.log("\ud83d\udd25 EscrowPaymentFlow: Item details:",{itemId:y,itemPriceValue:p,itemTitleValue:v}),!y||!p||p<=0)return console.log("\u274c EscrowPaymentFlow: Invalid item or price"),u.Ay.error("Invalid item or price"),void _(!1);const f=(null===O||void 0===O||null===(e=O.owner)||void 0===e?void 0:e.id)||(null===O||void 0===O?void 0:O.ownerId)||(null===L||void 0===L?void 0:L.vendorId)||(null===L||void 0===L?void 0:L.sponsorId)||null;console.log("\ud83d\udd25 EscrowPaymentFlow: Seller ID:",f),console.log("\ud83d\udd25 EscrowPaymentFlow: Creating escrow transaction...");const N=await C(y,p,E.uid||E.id,f,{type:"investment"===xe?"investment":"property",investmentData:L?(0,o.A)((0,o.A)({},L),{},{title:L.title||L.investmentTitle,investmentTitle:L.investmentTitle||L.title,expectedROI:L.expectedROI||L.expectedReturn||0,expectedReturn:L.expectedReturn||L.expectedROI||0,lockPeriod:L.lockPeriod||L.termMonths||L.duration||0,termMonths:L.termMonths||L.duration||L.lockPeriod||0,duration:L.duration||L.termMonths||L.lockPeriod||0,vendorId:L.vendorId||L.sponsorId,sponsorId:L.sponsorId||L.vendorId,sponsor:L.sponsor||L.vendor,vendor:L.vendor||L.sponsor,propertyLocation:L.propertyLocation||(null!==(t=L.location)&&void 0!==t&&t.address?"".concat(L.location.address,", ").concat(L.location.city):"N/A")}):null});if(console.log("\ud83d\udd25 EscrowPaymentFlow: Escrow result:",N),!N.success)return u.Ay.error(N.error||"Failed to create escrow transaction"),void _(!1);const P=N.id||(null===(s=N.data)||void 0===s?void 0:s.id);if(!P)return u.Ay.error("Failed to get escrow transaction ID"),void _(!1);const I=g(E);if(!I)return u.Ay.error("Unable to determine authentication headers. Please login again."),void _(!1);re(P);try{var n,r;ie(!0),console.log("\ud83d\ude80 EscrowPaymentFlow: Starting payment initialization...");const e={amount:p,paymentMethod:"flutterwave",paymentType:"escrow",relatedEntity:{type:"investment"===xe?"investment":"property",id:P,metadata:{escrowId:P,propertyId:(null===O||void 0===O?void 0:O.id)||null,investmentId:(null===L||void 0===L?void 0:L.id)||null}},description:j(v,xe),currency:"NGN"};console.log("\ud83d\udd25 EscrowPaymentFlow: API Payload:",e),console.log("\ud83d\udd25 EscrowPaymentFlow: API URL:",(0,x.e9)("/payments/initialize")),console.log("\ud83d\udd25 EscrowPaymentFlow: Headers:",I),console.log("\ud83d\udd25 EscrowPaymentFlow: Cache busting with timestamp:",Date.now());const t=await fetch((0,x.e9)("/payments/initialize"),{method:"POST",headers:I,body:JSON.stringify(e),cache:"no-store"});console.log("\ud83d\udd25 EscrowPaymentFlow: Response status:",t.status);const s=await t.json();if(console.log("\ud83d\udd25 EscrowPaymentFlow: Response data:",s),!t.ok||!s.success){var l,i,a,d;const e=(null===(l=s.data)||void 0===l?void 0:l.providerData)||s.providerData||(null===(i=s.error)||void 0===i?void 0:i.providerData)||(null===(a=s.error)||void 0===a?void 0:a.meta)||{},t=s.message||(null===e||void 0===e?void 0:e.message)||(null===(d=s.error)||void 0===d?void 0:d.message)||"",o=[null===e||void 0===e?void 0:e.maximum_amount,null===e||void 0===e?void 0:e.maximumAmount,null===e||void 0===e?void 0:e.max_amount,null===e||void 0===e?void 0:e.maxAmount,null===e||void 0===e?void 0:e.max_charge,null===e||void 0===e?void 0:e.maxCharge].find(e=>Number.isFinite(Number(e)))||null;if(o)return $(Number(o)),q("Charge amount must not exceed ".concat(b(Number(o)),". Try Bank Transfer or split the payment.")),void ie(!1);if(/exceed|maximum|max/i.test(t))return q(t||"Charge amount exceeds provider limit. Try another payment method."),void ie(!1);throw new Error(s.message||"Failed to initialize payment")}const o=(null===(n=s.data)||void 0===n?void 0:n.providerData)||{},c=(null===(r=s.data)||void 0===r?void 0:r.payment)||s.data,m=o.authorizationUrl||o.link,y=o.txRef||o.tx_ref||(null===c||void 0===c?void 0:c.reference);if(!m)throw new Error("Payment authorization link missing from response");const g={escrowId:P,paymentId:null===c||void 0===c?void 0:c.id,reference:null===c||void 0===c?void 0:c.reference,txRef:y,propertyId:null===O||void 0===O?void 0:O.id,investmentId:null===L||void 0===L?void 0:L.id,status:"processing",checkoutUrl:m,storedAt:Date.now()};h(g),G(g),te(m),X("processing"),H(2),be(m),u.Ay.success("Flutterwave checkout launched. Complete payment to proceed."),me&&localStorage.setItem("pendingInvestmentProject",JSON.stringify(L))}catch(c){console.error("EscrowPaymentFlow: payment initialization error",c),q(c.message||"Unable to initialize payment."),u.Ay.error(c.message||"Failed to initialize payment")}finally{ie(!1)}}catch(m){console.error("\u274c EscrowPaymentFlow: Payment error:",m),console.error("\u274c EscrowPaymentFlow: Error details:",m.message),console.error("\u274c EscrowPaymentFlow: Error stack:",m.stack),u.Ay.error("Payment failed: ".concat(m.message||"An error occurred"))}finally{_(!1)}};if(U){const e=(0,p.jsx)("div",{className:"flex items-center justify-center w-full py-16",children:(0,p.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600"})});return pe?(0,p.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-6",children:e}):(0,p.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,p.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})}if(!O&&!L){const e=(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:ce?"Property Not Found":"Investment Not Found"}),(0,p.jsx)("button",{onClick:()=>{pe&&I?I():k(ce?"/properties":"/investment")},className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:ce?"Back to Properties":"Back to Investments"})]});return pe?(0,p.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-6",children:e}):(0,p.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:e})}const Pe=(0,p.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,p.jsxs)("div",{className:"mb-8",children:[(0,p.jsxs)("button",{onClick:()=>{1!==J?H(e=>Math.max(1,e-1)):pe&&I?I():k(-1)},className:"flex items-center text-gray-600 hover:text-gray-800 mb-4",children:[(0,p.jsx)(m.QVr,{className:"mr-2"}),1===J?O?"Back to Property":"Back to Investment":"Previous Step"]}),(0,p.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:1===J?O?"Review Purchase":"Review Investment":2===J?"Payment Details":"Payment Confirmation"}),(0,p.jsx)("div",{className:"flex items-center space-x-4 mt-4",children:[1,2,3].map(e=>(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(J>=e?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:J>e?(0,p.jsx)(m.CMH,{}):e}),e<3&&(0,p.jsx)("div",{className:"w-16 h-1 mx-2 ".concat(J>e?"bg-blue-600":"bg-gray-200")})]},e))})]}),1===J&&(0,p.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,p.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,p.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:O?"Property Details":"Investment Details"}),(0,p.jsxs)("div",{className:"flex items-start space-x-4 mb-6",children:[(0,p.jsx)("img",{src:(null===ye||void 0===ye?void 0:ye.image)||(null===ye||void 0===ye||null===(t=ye.images)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.url)||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=200&h=150&fit=crop",alt:(null===ye||void 0===ye?void 0:ye.title)||(null===ye||void 0===ye?void 0:ye.investmentTitle)||(null===ye||void 0===ye?void 0:ye.name),className:"w-32 h-24 object-cover rounded-lg"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"font-semibold text-gray-900",children:(null===ye||void 0===ye?void 0:ye.title)||(null===ye||void 0===ye?void 0:ye.investmentTitle)||(null===ye||void 0===ye?void 0:ye.name)}),(0,p.jsx)("p",{className:"text-gray-600",children:(null===ye||void 0===ye?void 0:ye.location)||"Location pending"}),(0,p.jsx)("p",{className:"text-sm text-gray-500 mt-1 line-clamp-3",children:(null===ye||void 0===ye?void 0:ye.description)||"Property description will be shared by the vendor."})]})]}),(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("span",{className:"text-gray-600",children:"Property Price"}),(0,p.jsx)("span",{className:"font-semibold text-gray-900",children:b(he)})]}),(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("span",{className:"text-gray-600",children:"Escrow Protection Fee (0.5%)"}),(0,p.jsx)("span",{className:"font-semibold text-gray-900",children:b(ge)})]}),(0,p.jsxs)("div",{className:"border-t border-gray-200 pt-3 flex items-center justify-between",children:[(0,p.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Total Due Today"}),(0,p.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:b(fe)})]})]})]}),(0,p.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,p.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Escrow Protection Benefits"}),(0,p.jsx)("div",{className:"space-y-4",children:[{title:"Secure Payment Holding",description:"Your funds stay in escrow until every milestone you approve is met."},{title:"Document Verification",description:"The team verifies title, inspection reports, and contract documents."},{title:"Dispute Resolution",description:"Dedicated mediation support with guaranteed refund safeguards."}].map(e=>(0,p.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,p.jsx)(m.JhU,{className:"text-blue-600 mt-1"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"font-semibold text-gray-900",children:e.title}),(0,p.jsx)("p",{className:"text-gray-600 text-sm",children:e.description})]})]},e.title))}),(0,p.jsxs)("button",{onClick:()=>{H(2)},className:"w-full mt-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2",children:[(0,p.jsx)(m.AsH,{}),(0,p.jsx)("span",{children:"Continue to Payment"})]})]})]}),2===J&&(0,p.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,p.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-6",children:[(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsx)("label",{className:"block text-sm font-semibold text-gray-900",children:"Payment Method"}),(0,p.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,p.jsx)("button",{type:"button",onClick:()=>W(e=>(0,o.A)((0,o.A)({},e),{},{paymentMethod:"flutterwave"})),className:"p-4 border-2 rounded-lg transition ".concat("flutterwave"===V.paymentMethod?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)(m.x1c,{className:"mx-auto text-xl mb-2 text-blue-600"}),(0,p.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:"Flutterwave"})]})}),(0,p.jsx)("button",{type:"button",onClick:()=>W(e=>(0,o.A)((0,o.A)({},e),{},{paymentMethod:"test"})),className:"p-4 border-2 rounded-lg transition ".concat("test"===V.paymentMethod?"border-green-600 bg-green-50":"border-gray-200 hover:border-gray-300"),children:(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)(m.CMH,{className:"mx-auto text-xl mb-2 text-green-600"}),(0,p.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:"Test Payment"})]})})]})]}),"flutterwave"===V.paymentMethod&&(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Flutterwave Checkout"}),(0,p.jsx)("span",{className:"text-sm text-gray-500",children:"Secure \u2022 Encrypted \u2022 Instant"})]}),(0,p.jsx)("button",{type:"button",onClick:()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: Button clicked!"),console.log("\ud83d\udd25 EscrowPaymentFlow: loading:",U),console.log("\ud83d\udd25 EscrowPaymentFlow: isInitializingPayment:",le),console.log("\ud83d\udd25 EscrowPaymentFlow: step:",J),Ne()},disabled:U||le,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70",children:le?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.x1c,{className:"animate-spin"}),(0,p.jsx)("span",{children:"Initializing Flutterwave..."})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.x1c,{}),(0,p.jsx)("span",{children:"Re-launch Flutterwave Checkout"})]})})]}),"test"===V.paymentMethod&&(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,p.jsx)("p",{className:"text-sm text-green-900 font-semibold",children:"Test Payment Mode"}),(0,p.jsx)("p",{className:"text-xs text-green-800 mt-1",children:"This will simulate a successful payment for testing purposes."})]}),(0,p.jsx)("button",{type:"button",onClick:()=>{W(e=>(0,o.A)((0,o.A)({},e),{},{paymentMethod:"test"})),Ne()},disabled:U,className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70 hover:bg-green-700 transition",children:U?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.hW,{className:"animate-spin"}),(0,p.jsx)("span",{children:"Processing Test Payment..."})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.CMH,{}),(0,p.jsx)("span",{children:"Complete Test Payment"})]})})]}),ee&&(0,p.jsx)("button",{type:"button",onClick:je,className:"w-full border border-blue-600 text-blue-600 py-3 rounded-lg font-semibold",children:"Open Checkout Window"}),Y&&(0,p.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,p.jsx)("p",{className:"font-semibold text-blue-900",children:"Payment in progress"}),(0,p.jsxs)("p",{className:"text-sm text-blue-800 mt-1",children:["Reference: ",Y.txRef||Y.reference]}),(0,p.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"Please complete the Flutterwave checkout or click verify once done."}),(0,p.jsxs)("div",{className:"mt-4 flex flex-col gap-3",children:[(0,p.jsx)("button",{type:"button",onClick:async()=>{if(null===Y||void 0===Y||!Y.id)return void u.Ay.error("No payment to verify. Please initialize checkout first.");const e=g(E);if(e){oe(!0),q("");try{var t,s,o;const n=await fetch((0,x.e9)("/payments/".concat(Y.id,"/verify")),{method:"POST",headers:e,body:JSON.stringify({providerReference:Y.txRef||(null===(t=Y.metadata)||void 0===t||null===(s=t.flutterwave)||void 0===s?void 0:s.txRef)||Y.reference,txRef:Y.txRef||Y.reference,status:Q})}),r=await n.json();if(!n.ok||!r.success)throw new Error(r.message||"Payment verification failed");const l=((null===(o=r.data)||void 0===o?void 0:o.status)||"").toLowerCase();if("completed"===l||"success"===l||"successful"===l)X("completed"),w(ne,Y.reference||Y.txRef,"flutterwave"),f(Y.id),G(null),te(""),u.Ay.success("Payment verified successfully!");else{if("processing"!==l&&"pending"!==l)throw X("failed"),new Error("Payment could not be verified. Please try another attempt.");X("processing"),(0,u.Ay)("Flutterwave is still processing this payment. Please try again shortly.")}}catch(n){console.error("EscrowPaymentFlow: manual verification error",n),q(n.message||"Unable to verify payment right now."),u.Ay.error(n.message||"Failed to verify payment")}finally{oe(!1)}}else u.Ay.error("Please login again to verify payment.")},disabled:se,className:"w-full bg-green-600 text-white py-2 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70",children:se?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.hW,{className:"animate-spin"}),(0,p.jsx)("span",{children:"Verifying..."})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.CMH,{}),(0,p.jsx)("span",{children:"Verify Payment"})]})}),(0,p.jsx)("button",{type:"button",onClick:je,className:"w-full border border-blue-600 text-blue-600 py-2 rounded-lg font-semibold",children:"Resume Payment"})]})]}),Z&&(0,p.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-3 text-sm",children:Z}),K&&(0,p.jsx)("div",{className:"mt-3 text-sm text-gray-700",children:"Suggested actions: split the payment into smaller amounts, or use Bank Transfer which supports larger transfers."})]}),(0,p.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[(0,p.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Payment Summary"}),(0,p.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,p.jsx)("span",{children:"Escrow for"}),(0,p.jsx)("span",{className:"font-medium text-gray-900",children:we})]}),(0,p.jsxs)("div",{className:"flex justify-between",children:[(0,p.jsx)("span",{className:"text-gray-600",children:"Amount"}),(0,p.jsx)("span",{className:"font-semibold text-gray-900",children:b(he)})]}),(0,p.jsxs)("div",{className:"flex justify-between",children:[(0,p.jsx)("span",{className:"text-gray-600",children:"Escrow Fee"}),(0,p.jsx)("span",{className:"font-semibold text-gray-900",children:b(ge)})]}),(0,p.jsxs)("div",{className:"border-t border-gray-200 pt-4 flex justify-between items-center",children:[(0,p.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Total"}),(0,p.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:b(fe)})]})]})]}),3===J&&(0,p.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,p.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[(0,p.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,p.jsx)(m.CMH,{className:"text-green-600 text-2xl"})}),(0,p.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),(0,p.jsxs)("p",{className:"text-gray-600 mb-6",children:["Your payment of ",(0,p.jsx)("strong",{children:b(fe)})," is now held securely in escrow."]}),(0,p.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg mb-6 text-left",children:[(0,p.jsxs)("h3",{className:"font-semibold text-green-900 mb-3 flex items-center",children:[(0,p.jsx)(m.JhU,{className:"mr-2"}),"Escrow Protection Active"]}),(0,p.jsxs)("div",{className:"text-sm text-green-800 space-y-2",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)(m.A7C,{className:"mr-2 text-green-600"}),(0,p.jsxs)("span",{children:[(0,p.jsx)("strong",{children:"Funds Secured:"})," Held until you approve release."]})]}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)(m.BAG,{className:"mr-2 text-green-600"}),(0,p.jsxs)("span",{children:[(0,p.jsx)("strong",{children:"Your Control:"})," Nothing moves without your authorization."]})]}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)(m.DDN,{className:"mr-2 text-green-600"}),(0,p.jsxs)("span",{children:[(0,p.jsx)("strong",{children:"Dispute Resolution:"})," Mediation + refund guarantees."]})]})]})]}),(0,p.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6 text-left",children:[(0,p.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"What happens next?"}),(0,p.jsxs)("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[(0,p.jsx)("li",{children:"Property documents verification begins immediately."}),(0,p.jsx)("li",{children:"Our escrow officer reaches out to schedule inspection."}),(0,p.jsx)("li",{children:"You approve the property condition and paperwork."}),(0,p.jsx)("li",{children:"Funds release only after your final approval."})]})]}),(0,p.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:space-x-4",children:[(0,p.jsx)("button",{onClick:()=>k("/escrow"),className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"View Escrow Status"}),(0,p.jsx)("button",{onClick:()=>{k("/dashboard")},className:"flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})]})]})})]});return pe?(0,p.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:[(0,p.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col overflow-hidden",children:[(0,p.jsx)("button",{onClick:I,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 z-10 bg-white rounded-full p-1 shadow-md hover:bg-gray-100","aria-label":"Close payment flow",children:(0,p.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,p.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:Pe})]}),ae&&ee&&(0,p.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:(0,p.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full md:max-w-5xl lg:max-w-6xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Flutterwave Payment"}),(0,p.jsx)("button",{onClick:()=>de(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-100 rounded-full p-2 hover:bg-gray-200 transition-colors","aria-label":"Close checkout",children:(0,p.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,p.jsx)("iframe",{src:ee,title:"Flutterwave Checkout",className:"w-full h-[75vh] min-h-[640px] border-none",allow:"payment",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"})})]})})]}):(0,p.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[Pe,ae&&ee&&(0,p.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:(0,p.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full md:max-w-5xl lg:max-w-6xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Flutterwave Payment"}),(0,p.jsx)("button",{onClick:()=>de(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-100 rounded-full p-2 hover:bg-gray-200 transition-colors","aria-label":"Close checkout",children:(0,p.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,p.jsx)("iframe",{src:ee,title:"Flutterwave Checkout",className:"w-full h-[75vh] min-h-[640px] border-none",allow:"payment",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"})})]})})]})}}}]);
//# sourceMappingURL=210.8d6fd1d5.chunk.js.map