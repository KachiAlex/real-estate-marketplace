"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[694],{1694(e,n,t){t.r(n),t.d(n,{default:()=>ee});var a=t(5043),s=t(3216),r=t(4063),i=t(3519),l=t(9379),o=t(45),c=t(8139),d=t.n(c),u=t(7852),m=t(579);const v=["bsPrefix","variant","animation","size","as","className"],h=a.forwardRef((e,n)=>{let{bsPrefix:t,variant:a,animation:s="border",size:r,as:i="div",className:c}=e,h=(0,o.A)(e,v);t=(0,u.oU)(t,"spinner");const x="".concat(t,"-").concat(s);return(0,m.jsx)(i,(0,l.A)((0,l.A)({ref:n},h),{},{className:d()(c,x,r&&"".concat(x,"-").concat(r),a&&"text-".concat(a))}))});h.displayName="Spinner";const x=h;var f=t(7636),y=t(4282),j=t(1072),p=t(8602),A=t(8258),b=t(9620),g=(t(6440),t(1969)),N=t(3818);var I=t(3539);const w=a.createContext(null);w.displayName="NavContext";const C=w,_=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=e?String(e):n||null},P=a.createContext(null),k=a.createContext(null);var D=t(5425),R=t(8894),S=t(4140);const O=["as","active","eventKey"];function E(e){let{key:n,onClick:t,active:s,id:r,role:i,disabled:l}=e;const o=(0,a.useContext)(P),c=(0,a.useContext)(C),d=(0,a.useContext)(k);let u=s;const m={role:i};if(c){i||"tablist"!==c.role||(m.role="tab");const e=c.getControllerId(null!=n?n:null),t=c.getControlledId(null!=n?n:null);m[(0,D.sE)("event-key")]=n,m.id=e||r,u=null==s&&null!=n?c.activeKey===n:s,!u&&(null!=d&&d.unmountOnExit||null!=d&&d.mountOnEnter)||(m["aria-controls"]=t)}return"tab"===m.role&&(m["aria-selected"]=u,u||(m.tabIndex=-1),l&&(m.tabIndex=-1,m["aria-disabled"]=!0)),m.onClick=(0,R.A)(e=>{l||(null==t||t(e),null!=n&&o&&!e.isPropagationStopped()&&o(n,e))}),[m,{isActive:u}]}const K=a.forwardRef((e,n)=>{let{as:t=S.Ay,active:a,eventKey:s}=e,r=function(e,n){if(null==e)return{};var t={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(n.indexOf(a)>=0)continue;t[a]=e[a]}return t}(e,O);const[i,l]=E(Object.assign({key:_(s,r.href),active:a},r));return i[(0,D.sE)("active")]=l.isActive,(0,m.jsx)(t,Object.assign({},r,i,{ref:n}))});K.displayName="NavItem";const T=K,B=["as","onSelect","activeKey","role","onKeyDown"];const F=()=>{},L=(0,D.sE)("event-key"),z=a.forwardRef((e,n)=>{let{as:t="div",onSelect:s,activeKey:r,role:i,onKeyDown:l}=e,o=function(e,n){if(null==e)return{};var t={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(n.indexOf(a)>=0)continue;t[a]=e[a]}return t}(e,B);const c=function(){const[,e]=(0,a.useReducer)(e=>e+1,0);return e}(),d=(0,a.useRef)(!1),u=(0,a.useContext)(P),v=(0,a.useContext)(k);let h,x;v&&(i=i||"tablist",r=v.activeKey,h=v.getControlledId,x=v.getControllerId);const f=(0,a.useRef)(null),y=e=>{const n=f.current;if(!n)return null;const t=(0,N.A)(n,"[".concat(L,"]:not([aria-disabled=true])")),a=n.querySelector("[aria-selected=true]");if(!a||a!==document.activeElement)return null;const s=t.indexOf(a);if(-1===s)return null;let r=s+e;return r>=t.length&&(r=0),r<0&&(r=t.length-1),t[r]},j=(e,n)=>{null!=e&&(null==s||s(e,n),null==u||u(e,n))};(0,a.useEffect)(()=>{if(f.current&&d.current){const e=f.current.querySelector("[".concat(L,"][aria-selected=true]"));null==e||e.focus()}d.current=!1});const p=(0,I.A)(n,f);return(0,m.jsx)(P.Provider,{value:j,children:(0,m.jsx)(C.Provider,{value:{role:i,activeKey:_(r),getControlledId:h||F,getControllerId:x||F},children:(0,m.jsx)(t,Object.assign({},o,{onKeyDown:e=>{if(null==l||l(e),!v)return;let n;switch(e.key){case"ArrowLeft":case"ArrowUp":n=y(-1);break;case"ArrowRight":case"ArrowDown":n=y(1);break;default:return}n&&(e.preventDefault(),j(n.dataset[(0,D.y)("EventKey")]||null,e),d.current=!0,c())},ref:p,role:i}))})})});z.displayName="Nav";const H=Object.assign(z,{Item:T});var U=t(6618);const V=["bsPrefix","active","disabled","eventKey","className","variant","action","as"],W=a.forwardRef((e,n)=>{let{bsPrefix:t,active:a,disabled:s,eventKey:r,className:i,variant:c,action:v,as:h}=e,x=(0,o.A)(e,V);t=(0,u.oU)(t,"list-group-item");const[f,y]=E((0,l.A)({key:_(r,x.href),active:a},x)),j=(0,U.A)(e=>{if(s)return e.preventDefault(),void e.stopPropagation();f.onClick(e)});s&&void 0===x.tabIndex&&(x.tabIndex=-1,x["aria-disabled"]=!0);const p=h||(v?x.href?"a":"button":"div");return(0,m.jsx)(p,(0,l.A)((0,l.A)((0,l.A)({ref:n},x),f),{},{onClick:j,className:d()(i,t,y.isActive&&"active",s&&"disabled",c&&"".concat(t,"-").concat(c),v&&"".concat(t,"-action"))}))});W.displayName="ListGroupItem";const G=W,q=["className","bsPrefix","variant","horizontal","numbered","as"],Z=a.forwardRef((e,n)=>{const t=(0,g.Zw)(e,{activeKey:"onSelect"}),{className:a,bsPrefix:s,variant:r,horizontal:i,numbered:c,as:v="div"}=t,h=(0,o.A)(t,q),x=(0,u.oU)(s,"list-group");let f;return i&&(f=!0===i?"horizontal":"horizontal-".concat(i)),(0,m.jsx)(H,(0,l.A)((0,l.A)({ref:n},h),{},{as:v,className:d()(a,x,r&&"".concat(x,"-").concat(r),f&&"".concat(x,"-").concat(f),c&&"".concat(x,"-numbered"))}))});Z.displayName="ListGroup";const $=Object.assign(Z,{Item:G});var J=t(2083),M=t(9853),Q=t(3823),X=t(2825),Y=t(5016);const ee=()=>{var e,n,t,l,o,c,d;const{id:u}=(0,s.g)(),v=(0,s.Zp)(),{user:h}=(0,Y.As)(),{getEscrowTransaction:g,confirmPayment:N,releaseFunds:I,recordROIPayment:w,completeTransaction:C}=(0,Q.N)(),{getInvestmentById:_}=(0,X.H)(),[P,k]=(0,a.useState)(null),[D,R]=(0,a.useState)(null),[S,O]=(0,a.useState)(null),[E,K]=(0,a.useState)(null),[T,B]=(0,a.useState)(!0),[F,L]=(0,a.useState)(null),[z,H]=(0,a.useState)(!1),[U,V]=(0,a.useState)(!1),[W,G]=(0,a.useState)(""),[q,Z]=(0,a.useState)(!1);(0,a.useEffect)(()=>{ee()},[u]);const ee=async()=>{try{B(!0),L(null);const r=await g(u);if(!r)return L("Escrow transaction not found"),void B(!1);if(k(r),r.investmentId||"investment"===r.type){const e=r.investmentId||u;try{const n=await _(e);n&&R(n)}catch(s){console.warn("Error loading investment:",s)}}const i=r.vendorId||r.sellerId;var e,n;if(r.sellerName)O({id:i,firstName:(null===(e=r.sellerName)||void 0===e?void 0:e.split(" ")[0])||"",lastName:(null===(n=r.sellerName)||void 0===n?void 0:n.split(" ").slice(1).join(" "))||"",email:r.sellerEmail||""});const l=r.buyerId;var t,a;if(r.buyerName)K({id:l,firstName:(null===(t=r.buyerName)||void 0===t?void 0:t.split(" ")[0])||"",lastName:(null===(a=r.buyerName)||void 0===a?void 0:a.split(" ").slice(1).join(" "))||"",email:r.buyerEmail||""})}catch(s){console.error("Error loading transaction details:",s),L(s.message||"Failed to load transaction details")}finally{B(!1)}},ne=()=>!(!h||!P)&&(h.uid===P.buyerId?["documents_verified"].includes(P.status):h.uid===P.vendorId?["payment_received","funds_released"].includes(P.status):"admin"===h.role&&["documents_uploaded","buyer_confirmed","roi_paid"].includes(P.status));if(T)return(0,m.jsx)(i.A,{className:"py-5",children:(0,m.jsx)("div",{className:"text-center",children:(0,m.jsx)(x,{animation:"border",role:"status",children:(0,m.jsx)("span",{className:"visually-hidden",children:"Loading..."})})})});if(F||!P)return(0,m.jsxs)(i.A,{className:"py-5",children:[(0,m.jsx)(f.A,{variant:"danger",children:F||"Transaction not found"}),(0,m.jsx)(y.A,{variant:"outline-primary",onClick:()=>v("/dashboard"),children:"Back to Dashboard"})]});const te={pending_payment:10,payment_received:20,documents_uploaded:40,documents_verified:60,buyer_confirmed:80,funds_released:90,roi_paid:95,completed:100,vendor_default:0,failed:0}[P.status]||0;return(0,m.jsxs)(i.A,{className:"py-5",children:[(0,m.jsxs)(j.A,{children:[(0,m.jsx)(p.A,{lg:8,children:(0,m.jsxs)(A.A,{className:"mb-4",children:[(0,m.jsxs)(A.A.Header,{className:"d-flex justify-content-between align-items-center",children:[(0,m.jsx)("h3",{children:"Escrow Transaction"}),(e=>{const n={pending_payment:{variant:"warning",text:"Pending Payment"},payment_received:{variant:"info",text:"Payment Received"},documents_uploaded:{variant:"primary",text:"Documents Uploaded"},documents_verified:{variant:"success",text:"Documents Verified"},buyer_confirmed:{variant:"success",text:"Buyer Confirmed"},funds_released:{variant:"info",text:"Funds Released"},roi_paid:{variant:"success",text:"ROI Paid"},completed:{variant:"success",text:"Completed"},vendor_default:{variant:"danger",text:"Vendor Default"},failed:{variant:"danger",text:"Failed"}}[e]||{variant:"secondary",text:e};return(0,m.jsx)(r.A,{bg:n.variant,children:n.text})})(P.status)]}),(0,m.jsxs)(A.A.Body,{children:[(0,m.jsx)("h5",{children:"Transaction Progress"}),(0,m.jsx)(b.A,{now:te,label:"".concat(te,"%"),className:"mb-4"}),(0,m.jsxs)(j.A,{children:[(0,m.jsxs)(p.A,{md:6,children:[(0,m.jsx)("h6",{children:"Transaction Details"}),(0,m.jsxs)($,{className:"mb-4",children:[(0,m.jsxs)($.Item,{children:[(0,m.jsx)("strong",{children:"Amount:"})," $",P.amount.toLocaleString()]}),(0,m.jsxs)($.Item,{children:[(0,m.jsx)("strong",{children:"Created:"})," ",(null===(e=P.createdAt)||void 0===e||null===(n=e.toDate)||void 0===n||null===(t=n.call(e))||void 0===t?void 0:t.toLocaleDateString())||"N/A"]}),(0,m.jsxs)($.Item,{children:[(0,m.jsx)("strong",{children:"Type:"})," Investment Escrow"]})]})]}),(0,m.jsxs)(p.A,{md:6,children:[(0,m.jsx)("h6",{children:"Parties"}),(0,m.jsxs)($,{className:"mb-4",children:[(0,m.jsxs)($.Item,{children:[(0,m.jsx)("strong",{children:"Buyer:"})," ",null===E||void 0===E?void 0:E.firstName," ",null===E||void 0===E?void 0:E.lastName]}),(0,m.jsxs)($.Item,{children:[(0,m.jsx)("strong",{children:"Vendor:"})," ",(null===S||void 0===S?void 0:S.companyName)||(null===S||void 0===S?void 0:S.firstName)," ",null===S||void 0===S?void 0:S.lastName]}),(0,m.jsxs)($.Item,{children:[(0,m.jsx)("strong",{children:"Investment:"})," ",null===D||void 0===D?void 0:D.title]})]})]})]}),P.propertyDocuments&&P.propertyDocuments.length>0&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h5",{children:"Property Documents"}),(0,m.jsxs)(f.A,{variant:"info",children:[(0,m.jsxs)("h6",{children:["Document Status: ",P.documentVerificationStatus]}),(0,m.jsx)("p",{className:"mb-2",children:"The investment company has uploaded property documents as collateral."}),(0,m.jsx)(y.A,{variant:"outline-primary",onClick:()=>H(!0),children:"View Documents"})]})]}),P.roiAmount&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h5",{children:"ROI Payment"}),(0,m.jsxs)(f.A,{variant:"success",children:[(0,m.jsxs)("h6",{children:["ROI Amount: $",P.roiAmount.toLocaleString()]}),(0,m.jsxs)("p",{className:"mb-0",children:["Paid on: ",(null===(l=P.roiPaidAt)||void 0===l||null===(o=l.toDate)||void 0===o||null===(c=o.call(l))||void 0===c?void 0:c.toLocaleDateString())||"N/A"]})]})]}),P.adminNotes&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h5",{children:"Admin Notes"}),(0,m.jsx)(f.A,{variant:"light",children:(0,m.jsx)("p",{className:"mb-0",children:P.adminNotes})})]})]})]})}),(0,m.jsx)(p.A,{lg:4,children:(0,m.jsxs)(A.A,{className:"sticky-top",style:{top:"20px"},children:[(0,m.jsx)(A.A.Header,{children:(0,m.jsx)("h5",{children:"Actions"})}),(0,m.jsxs)(A.A.Body,{children:[F&&(0,m.jsx)(f.A,{variant:"danger",children:F}),ne()&&(0,m.jsxs)("div",{className:"d-grid gap-2",children:[h.uid===P.buyerId&&"documents_verified"===P.status&&(0,m.jsx)(y.A,{variant:"success",onClick:async()=>{try{Z(!0),await N(u),await ee()}catch(e){L(e.message)}finally{Z(!1)}},disabled:q,children:q?"Processing...":"Confirm Payment"}),h.uid===P.vendorId&&"funds_released"===P.status&&(0,m.jsx)(y.A,{variant:"primary",onClick:()=>V(!0),disabled:q,children:"Record ROI Payment"}),"admin"===h.role&&"roi_paid"===P.status&&(0,m.jsx)(y.A,{variant:"success",onClick:async()=>{try{Z(!0),await C(u),await ee()}catch(e){L(e.message)}finally{Z(!1)}},disabled:q,children:"Complete Transaction"})]}),!ne()&&(0,m.jsx)(f.A,{variant:"info",children:(0,m.jsxs)("p",{className:"mb-0",children:["pending_payment"===P.status&&"Waiting for payment...","payment_received"===P.status&&"Waiting for document upload...","documents_uploaded"===P.status&&"Waiting for document verification...","buyer_confirmed"===P.status&&"Waiting for fund release...","funds_released"===P.status&&"Waiting for ROI payment...","completed"===P.status&&"Transaction completed successfully!"]})}),(0,m.jsx)("div",{className:"mt-3",children:(0,m.jsx)(y.A,{variant:"outline-secondary",onClick:()=>v("/dashboard"),className:"w-100",children:"Back to Dashboard"})})]})]})})]}),(0,m.jsxs)(J.A,{show:z,onHide:()=>H(!1),size:"lg",children:[(0,m.jsx)(J.A.Header,{closeButton:!0,children:(0,m.jsx)(J.A.Title,{children:"Property Documents"})}),(0,m.jsx)(J.A.Body,{children:null===(d=P.propertyDocuments)||void 0===d?void 0:d.map((e,n)=>{var t,a,s;return(0,m.jsx)(A.A,{className:"mb-3",children:(0,m.jsx)(A.A.Body,{children:(0,m.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h6",{children:e.name}),(0,m.jsxs)("small",{className:"text-muted",children:["Uploaded: ",(null===(t=e.uploadedAt)||void 0===t||null===(a=t.toDate)||void 0===a||null===(s=a.call(t))||void 0===s?void 0:s.toLocaleDateString())||"N/A"]})]}),(0,m.jsx)(y.A,{variant:"outline-primary",href:e.url,target:"_blank",children:"View Document"})]})})},n)})}),(0,m.jsx)(J.A.Footer,{children:(0,m.jsx)(y.A,{variant:"secondary",onClick:()=>H(!1),children:"Close"})})]}),(0,m.jsxs)(J.A,{show:U,onHide:()=>V(!1),children:[(0,m.jsx)(J.A.Header,{closeButton:!0,children:(0,m.jsx)(J.A.Title,{children:"Record ROI Payment"})}),(0,m.jsx)(J.A.Body,{children:(0,m.jsxs)(M.A,{children:[(0,m.jsxs)(M.A.Group,{className:"mb-3",children:[(0,m.jsx)(M.A.Label,{children:"ROI Amount Paid"}),(0,m.jsx)(M.A.Control,{type:"number",value:W,onChange:e=>G(e.target.value),placeholder:"Enter ROI amount",min:"0",step:"0.01"})]}),(0,m.jsx)(f.A,{variant:"info",children:(0,m.jsx)("p",{className:"mb-0",children:"This will record the ROI payment made to the investor. Once confirmed, the transaction can be completed and property documents returned."})})]})}),(0,m.jsxs)(J.A.Footer,{children:[(0,m.jsx)(y.A,{variant:"secondary",onClick:()=>V(!1),children:"Cancel"}),(0,m.jsx)(y.A,{variant:"success",onClick:async()=>{if(!W||parseFloat(W)<=0)L("Please enter a valid ROI amount");else try{Z(!0),await w(u,parseFloat(W),null),V(!1),G(""),await ee()}catch(e){L(e.message)}finally{Z(!1)}},disabled:q||!W,children:q?"Processing...":"Record Payment"})]})]})]})}}}]);
//# sourceMappingURL=694.f47a7a62.chunk.js.map