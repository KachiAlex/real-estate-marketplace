{"version":3,"file":"static/js/864.ad40e14c.chunk.js","mappings":"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","sources":["pages/BuyerInspectionRequests.js","services/inspectionService.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { updateInspectionRequest, getInspectionAnalytics, listInspectionRequestsByBuyer } from '../services/inspectionService';\r\nimport { FaEye } from 'react-icons/fa';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst BuyerInspectionRequests = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [requests, setRequests] = useState([]);\r\n  const [analytics, setAnalytics] = useState(null);\r\n  const prevStatusRef = useRef({});\r\n  const [showRescheduleModal, setShowRescheduleModal] = useState(false);\r\n  const [rescheduleRequest, setRescheduleRequest] = useState(null);\r\n  const [rescheduleDate, setRescheduleDate] = useState('');\r\n  const [rescheduleTime, setRescheduleTime] = useState('');\r\n  const [rescheduleNote, setRescheduleNote] = useState('');\r\n\r\n  const ensureNotificationPermission = async () => {\r\n    try {\r\n      if (!('Notification' in window)) return;\r\n      if (Notification.permission === 'default') {\r\n        await Notification.requestPermission();\r\n      }\r\n    } catch (e) {}\r\n  };\r\n\r\n  const showWebNotification = (title, options = {}) => {\r\n    try {\r\n      if (!('Notification' in window)) return;\r\n      if (Notification.permission === 'granted') new Notification(title, options);\r\n    } catch (e) {}\r\n  };\r\n\r\n  const toDateTime = (dateStr, timeStr) => {\r\n    try { return new Date(`${dateStr}T${timeStr}:00`); } catch { return null; }\r\n  };\r\n\r\n  const buildCalendar = (r) => {\r\n    const title = `Property Inspection - ${r.projectName}`;\r\n    const start = r.confirmedDate && r.confirmedTime ? toDateTime(r.confirmedDate, r.confirmedTime) : toDateTime(r.preferredDate, r.preferredTime);\r\n    const end = start ? new Date(start.getTime() + 60 * 60 * 1000) : null; // 1 hour\r\n    const details = `Inspection at ${r.projectLocation || ''}`;\r\n    const location = r.projectLocation || '';\r\n    return { title, start, end, details, location };\r\n  };\r\n\r\n  const formatDateICS = (d) => {\r\n    const pad = (n) => String(n).padStart(2, '0');\r\n    return `${d.getUTCFullYear()}${pad(d.getUTCMonth()+1)}${pad(d.getUTCDate())}T${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}00Z`;\r\n  };\r\n\r\n  const downloadICS = (r) => {\r\n    const { title, start, end, details, location } = buildCalendar(r);\r\n    if (!start || !end) { return; }\r\n    const ics = [\r\n      'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//PropertyArk//Inspection//EN','BEGIN:VEVENT',\r\n      `UID:${r.id}@propertyark`,`DTSTAMP:${formatDateICS(new Date())}`,\r\n      `DTSTART:${formatDateICS(start)}`,`DTEND:${formatDateICS(end)}`,\r\n      `SUMMARY:${title}`,`DESCRIPTION:${details}`,`LOCATION:${location}`,'END:VEVENT','END:VCALENDAR'\r\n    ].join('\\r\\n');\r\n    const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url; a.download = `inspection-${r.id}.ics`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);\r\n  };\r\n\r\n  const openGoogleCalendar = (r) => {\r\n    const { title, start, end, details, location } = buildCalendar(r);\r\n    if (!start || !end) { return; }\r\n    const fmt = (d) => `${d.getUTCFullYear()}${String(d.getUTCMonth()+1).padStart(2,'0')}${String(d.getUTCDate()).padStart(2,'0')}T${String(d.getUTCHours()).padStart(2,'0')}${String(d.getUTCMinutes()).padStart(2,'0')}00Z`;\r\n    const text = encodeURIComponent(title);\r\n    const dates = `${fmt(start)}/${fmt(end)}`;\r\n    const detailsEnc = encodeURIComponent(details);\r\n    const locationEnc = encodeURIComponent(location);\r\n    const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${dates}&details=${detailsEnc}&location=${locationEnc}`;\r\n    window.open(url, '_blank');\r\n  };\r\n\r\n  // Load requests from localStorage (primary source for now)\r\n  const loadRequestsFromLocalStorage = () => {\r\n    if (!user?.id) return [];\r\n    \r\n    try {\r\n      const viewingRequests = JSON.parse(localStorage.getItem('viewingRequests') || '[]');\r\n      \r\n      // Filter by user ID (check both userId and buyerId for compatibility)\r\n      const userRequests = viewingRequests.filter(req => \r\n        req.userId === user.id || req.buyerId === user.id\r\n      );\r\n      \r\n      // Transform localStorage format to match component expectations\r\n      const transformed = userRequests.map(req => ({\r\n        id: req.id,\r\n        // Map property fields to project fields (for display compatibility)\r\n        projectName: req.propertyTitle || req.projectName || req.title || 'Property',\r\n        projectLocation: req.propertyLocation || req.projectLocation || req.location || '',\r\n        // Keep original fields\r\n        preferredDate: req.preferredDate,\r\n        preferredTime: req.preferredTime,\r\n        confirmedDate: req.confirmedDate,\r\n        confirmedTime: req.confirmedTime,\r\n        proposedDate: req.proposedDate,\r\n        proposedTime: req.proposedTime,\r\n        status: req.status || 'pending_vendor',\r\n        createdAt: req.requestedAt || req.createdAt || new Date().toISOString(),\r\n        // Keep other fields\r\n        ...req\r\n      }));\r\n      \r\n      // Sort by date (newest first)\r\n      transformed.sort((a, b) => {\r\n        const dateA = new Date(a.createdAt || 0);\r\n        const dateB = new Date(b.createdAt || 0);\r\n        return dateB - dateA;\r\n      });\r\n      \r\n      return transformed;\r\n    } catch (error) {\r\n      console.error('Error loading requests from localStorage:', error);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  // Update requests state\r\n  const updateRequests = (newRequests) => {\r\n    setRequests(newRequests);\r\n    ensureNotificationPermission();\r\n    const prev = prevStatusRef.current || {};\r\n    for (const r of newRequests) {\r\n      const previous = prev[r.id];\r\n      if (previous && previous !== r.status) {\r\n        if (r.status === 'accepted') {\r\n          showWebNotification('Inspection confirmed', { body: `${r.projectName} on ${r.confirmedDate} ${r.confirmedTime}` });\r\n        } else if (r.status === 'proposed_new_time') {\r\n          showWebNotification('Vendor proposed a new time', { body: `${r.projectName}: ${r.proposedDate} ${r.proposedTime}` });\r\n        } else if (r.status === 'declined') {\r\n          showWebNotification('Inspection declined', { body: `${r.projectName}` });\r\n        } else if (r.status === 'cancelled_by_vendor') {\r\n          showWebNotification('Vendor cancelled inspection', { body: `${r.projectName} was cancelled by vendor` });\r\n          toast.error(`Vendor cancelled inspection for ${r.projectName}`);\r\n        }\r\n      }\r\n    }\r\n    prevStatusRef.current = Object.fromEntries(newRequests.map(x => [x.id, x.status]));\r\n    if (user?.id) {\r\n      setAnalytics(getInspectionAnalytics({ role: 'buyer', userId: user.id }));\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!user?.id) {\r\n      setRequests([]);\r\n      return;\r\n    }\r\n\r\n    // Load from localStorage (primary source)\r\n    const localRequests = loadRequestsFromLocalStorage();\r\n    updateRequests(localRequests);\r\n\r\n    // Poll for updates every 5 seconds as fallback\r\n    const pollInterval = setInterval(() => {\r\n      const updatedRequests = loadRequestsFromLocalStorage();\r\n      updateRequests(updatedRequests);\r\n    }, 5000);\r\n\r\n    // Listen for viewing updates from other components\r\n    const handleViewingsUpdate = () => {\r\n      const updatedRequests = loadRequestsFromLocalStorage();\r\n      updateRequests(updatedRequests);\r\n    };\r\n\r\n    const handleAnalyticsUpdate = (event) => {\r\n      if (!user?.id) return;\r\n      const detail = event.detail || event;\r\n      if (detail?.buyerId && detail.buyerId !== user.id) return;\r\n      const data = getInspectionAnalytics({ role: 'buyer', userId: user.id });\r\n      setAnalytics(data);\r\n    };\r\n\r\n    window.addEventListener('viewingsUpdated', handleViewingsUpdate);\r\n    window.addEventListener('inspectionAnalyticsUpdated', handleAnalyticsUpdate);\r\n    window.addEventListener('storage', (e) => {\r\n      if (e.key === 'viewingRequests') {\r\n        handleViewingsUpdate();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      clearInterval(pollInterval);\r\n      window.removeEventListener('viewingsUpdated', handleViewingsUpdate);\r\n      window.removeEventListener('inspectionAnalyticsUpdated', handleAnalyticsUpdate);\r\n    };\r\n  }, [user?.id]);\r\n\r\n  useEffect(() => {\r\n    if (!user?.id) {\r\n      setAnalytics(null);\r\n      return;\r\n    }\r\n    setAnalytics(getInspectionAnalytics({ role: 'buyer', userId: user.id }));\r\n  }, [user?.id]);\r\n\r\n  const acceptProposal = async (r) => {\r\n    if (!r.proposedDate || !r.proposedTime) {\r\n      toast.error('No proposed time from vendor');\r\n      return;\r\n    }\r\n    const ok = await updateInspectionRequest(r.id, {\r\n      status: 'accepted',\r\n      confirmedDate: r.proposedDate,\r\n      confirmedTime: r.proposedTime\r\n    });\r\n    if (ok) toast.success('Proposal accepted'); else toast.error('Failed to accept');\r\n  };\r\n\r\n  const declineProposal = async (r) => {\r\n    const ok = await updateInspectionRequest(r.id, { status: 'declined' });\r\n    if (ok) toast.success('Proposal declined'); else toast.error('Failed to decline');\r\n  };\r\n\r\n  const handleCancelRequest = async (r) => {\r\n    const confirm = window.confirm('Cancel this inspection request? Vendors will be notified.');\r\n    if (!confirm) return;\r\n    const ok = await updateInspectionRequest(r.id, { status: 'cancelled_by_buyer', cancelledAt: new Date().toISOString() });\r\n    if (ok) toast.success('Inspection cancelled'); else toast.error('Failed to cancel');\r\n  };\r\n\r\n  const openReschedule = (r) => {\r\n    setRescheduleRequest(r);\r\n    setRescheduleDate(r.preferredDate || '');\r\n    setRescheduleTime(r.preferredTime || '');\r\n    setRescheduleNote('');\r\n    setShowRescheduleModal(true);\r\n  };\r\n\r\n  const submitReschedule = async () => {\r\n    if (!rescheduleRequest || !rescheduleDate || !rescheduleTime) {\r\n      toast.error('Select your new date and time');\r\n      return;\r\n    }\r\n    const ok = await updateInspectionRequest(rescheduleRequest.id, {\r\n      status: 'buyer_rescheduled',\r\n      preferredDate: rescheduleDate,\r\n      preferredTime: rescheduleTime,\r\n      buyerMessage: rescheduleNote || '',\r\n      proposedDate: null,\r\n      proposedTime: null\r\n    });\r\n    if (ok) {\r\n      toast.success('Reschedule request sent to vendor');\r\n      setShowRescheduleModal(false);\r\n      setRescheduleRequest(null);\r\n      setRescheduleDate('');\r\n      setRescheduleTime('');\r\n      setRescheduleNote('');\r\n    } else {\r\n      toast.error('Failed to reschedule');\r\n    }\r\n  };\r\n\r\n  const handleViewProperty = (request) => {\r\n    // Try to get propertyId from the request\r\n    const propertyId = request.propertyId || request.projectId;\r\n    \r\n    if (propertyId) {\r\n      navigate(`/property/${propertyId}`);\r\n    } else {\r\n      toast.error('Property information not available');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">My Inspection Requests</h1>\r\n        <p className=\"text-gray-600\">Track and respond to vendor proposals</p>\r\n      </div>\r\n\r\n      {analytics && (\r\n        <div className=\"space-y-4 mb-6\">\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            <div className=\"bg-blue-50 border border-blue-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-blue-600\">Pending Responses</p>\r\n              <p className=\"text-3xl font-semibold text-blue-900\">{analytics.pendingResponses}</p>\r\n            </div>\r\n            <div className=\"bg-green-50 border border-green-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-green-600\">Confirmed</p>\r\n              <p className=\"text-3xl font-semibold text-green-900\">{analytics.confirmed}</p>\r\n            </div>\r\n            <div className=\"bg-purple-50 border border-purple-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-purple-600\">Vendor Reschedules</p>\r\n              <p className=\"text-3xl font-semibold text-purple-900\">{analytics.vendorProposals}</p>\r\n            </div>\r\n            <div className=\"bg-red-50 border border-red-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-red-600\">Vendor Cancellations</p>\r\n              <p className=\"text-3xl font-semibold text-red-900\">{analytics.cancelledByVendor}</p>\r\n            </div>\r\n          </div>\r\n\r\n          {analytics.timeline?.length > 0 && (\r\n            <div className=\"bg-white rounded-2xl border border-gray-100 shadow-sm p-4\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h3 className=\"text-sm font-semibold text-gray-900\">Last 7 days activity</h3>\r\n                <span className=\"text-xs text-gray-500\">{analytics.totalRequests} total requests</span>\r\n              </div>\r\n              <div className=\"flex gap-3 overflow-x-auto text-sm\">\r\n                {analytics.timeline.map((item) => (\r\n                  <div key={item.date} className=\"flex-1 min-w-[90px] text-center\">\r\n                    <p className=\"text-gray-500 text-xs\">{new Date(item.date).toLocaleDateString()}</p>\r\n                    <p className=\"text-lg font-semibold text-gray-900\">{item.count}</p>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white rounded-lg shadow\">\r\n        <div className=\"p-4 border-b border-gray-200 text-sm text-gray-600\">{requests.length} request(s)</div>\r\n        <div className=\"divide-y\">\r\n          {requests.length === 0 && (\r\n            <div className=\"p-6 text-sm text-gray-600\">No inspection requests yet.</div>\r\n          )}\r\n          {requests.map((r) => (\r\n            <div key={r.id} className=\"p-4 flex items-center text-sm\">\r\n              <div className=\"w-1/5\">\r\n                <div className=\"font-medium text-gray-900\">{r.projectName}</div>\r\n                <div className=\"text-gray-600\">{r.projectLocation}</div>\r\n              </div>\r\n              <div className=\"w-1/5\">\r\n                <div>Preferred: {r.preferredDate} {r.preferredTime}</div>\r\n                {r.proposedDate && r.proposedTime && (\r\n                  <div className=\"text-xs text-gray-600\">Vendor proposed: {r.proposedDate} {r.proposedTime}</div>\r\n                )}\r\n              </div>\r\n              <div className=\"w-1/5\">\r\n                <span className={`px-2 py-1 rounded-full text-xs ${\r\n                  r.status === 'pending_vendor' ? 'bg-yellow-100 text-yellow-800' :\r\n                  r.status === 'accepted' ? 'bg-green-100 text-green-800' :\r\n                  r.status === 'proposed_new_time' ? 'bg-blue-100 text-blue-800' :\r\n                  r.status === 'pending_vendor_confirmation' ? 'bg-yellow-100 text-yellow-800' :\r\n                  'bg-red-100 text-red-800'\r\n                }`}>\r\n                  {r.status?.replaceAll('_',' ') || 'pending'}\r\n                </span>\r\n              </div>\r\n              <div className=\"w-2/5 flex flex-wrap gap-2 items-center\">\r\n                {/* View Property Icon */}\r\n                <button\r\n                  onClick={() => handleViewProperty(r)}\r\n                  className=\"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors\"\r\n                  title=\"View Property Details\"\r\n                >\r\n                  <FaEye className=\"w-5 h-5\" />\r\n                </button>\r\n                \r\n                {r.status === 'proposed_new_time' && (\r\n                  <>\r\n                    <button onClick={() => acceptProposal(r)} className=\"px-3 py-1 bg-green-600 text-white rounded\">Accept Proposal</button>\r\n                    <button onClick={() => declineProposal(r)} className=\"px-3 py-1 bg-red-600 text-white rounded\">Decline</button>\r\n                  </>\r\n                )}\r\n                {r.status === 'accepted' && (\r\n                  <>\r\n                    <button onClick={() => openGoogleCalendar(r)} className=\"px-3 py-1 bg-gray-800 text-white rounded\">Google Calendar</button>\r\n                    <button onClick={() => downloadICS(r)} className=\"px-3 py-1 border rounded\">Download .ics</button>\r\n                  </>\r\n                )}\r\n                {r.status !== 'cancelled_by_buyer' && r.status !== 'declined' && (\r\n                  <>\r\n                    <button onClick={() => openReschedule(r)} className=\"px-3 py-1 bg-blue-600 text-white rounded\">Reschedule</button>\r\n                    <button onClick={() => handleCancelRequest(r)} className=\"px-3 py-1 bg-red-100 text-red-700 rounded border border-red-300\">Cancel</button>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {showRescheduleModal && rescheduleRequest && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-lg max-w-md w-full p-6\">\r\n            <div className=\"flex items-start justify-between mb-4\">\r\n              <div>\r\n                <h3 className=\"text-lg font-bold text-gray-900\">Reschedule Inspection</h3>\r\n                <p className=\"text-sm text-gray-500\">{rescheduleRequest.projectName}</p>\r\n              </div>\r\n              <button onClick={() => setShowRescheduleModal(false)} className=\"text-gray-500 hover:text-gray-700\">Ã—</button>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">New date</label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={rescheduleDate}\r\n                  onChange={(e) => setRescheduleDate(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">New time</label>\r\n                <input\r\n                  type=\"time\"\r\n                  value={rescheduleTime}\r\n                  onChange={(e) => setRescheduleTime(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Message to vendor (optional)</label>\r\n                <textarea\r\n                  value={rescheduleNote}\r\n                  onChange={(e) => setRescheduleNote(e.target.value)}\r\n                  rows={3}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  placeholder=\"Share context for the new time\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"flex justify-between mt-6\">\r\n              <button onClick={() => setShowRescheduleModal(false)} className=\"px-5 py-2 border rounded-lg\">Close</button>\r\n              <button onClick={submitReschedule} className=\"px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">Send Update</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BuyerInspectionRequests;\r\n\r\n\r\n\r\n\r\n\r\n","import notificationService from './notificationService';\r\n\r\nconst COLLECTION = 'inspectionRequests';\r\nconst VIEWING_REQUESTS_KEY = 'viewingRequests';\r\nconst INSPECTION_ACTIVITY_KEY = 'inspectionActivityLog';\r\nconst ANALYTICS_EVENT = 'inspectionAnalyticsUpdated';\r\nconst ACTIVITY_EVENT = 'inspectionActivity';\r\n\r\nconst defaultAnalytics = {\r\n  totalRequests: 0,\r\n  pendingResponses: 0,\r\n  confirmed: 0,\r\n  vendorProposals: 0,\r\n  buyerReschedules: 0,\r\n  cancelledByBuyer: 0,\r\n  cancelledByVendor: 0,\r\n  timeline: []\r\n};\r\n\r\nconst safeWindowDispatch = (eventName, detail) => {\r\n  if (typeof window === 'undefined') return;\r\n  if (eventName === 'storage') {\r\n    try {\r\n      window.dispatchEvent(new StorageEvent('storage', detail));\r\n    } catch {\r\n      window.dispatchEvent(new CustomEvent('storage', { detail }));\r\n    }\r\n    return;\r\n  }\r\n  if (typeof window.dispatchEvent === 'function') {\r\n    window.dispatchEvent(new CustomEvent(eventName, { detail }));\r\n  }\r\n};\r\n\r\nconst getStoredRequests = () => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(VIEWING_REQUESTS_KEY) || '[]');\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\nconst saveStoredRequests = (requests) => {\r\n  localStorage.setItem(VIEWING_REQUESTS_KEY, JSON.stringify(requests));\r\n};\r\n\r\nconst getActivityLog = () => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(INSPECTION_ACTIVITY_KEY) || '[]');\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\nconst saveActivityLog = (log) => {\r\n  localStorage.setItem(INSPECTION_ACTIVITY_KEY, JSON.stringify(log));\r\n};\r\n\r\nconst buildActivityPayload = (action, request) => ({\r\n  action,\r\n  requestId: request.id,\r\n  propertyTitle: request.propertyTitle || request.projectTitle || request.projectName || request.title || 'Property',\r\n  buyerId: request.buyerId || request.userId,\r\n  vendorId: request.vendorId,\r\n  vendorEmail: request.vendorEmail,\r\n  status: request.status,\r\n  timestamp: new Date().toISOString()\r\n});\r\n\r\nconst formatDateTimeLabel = (date, time) => {\r\n  if (!date && !time) return '';\r\n  if (!time) return date;\r\n  if (!date) return time;\r\n  return `${date} ${time}`;\r\n};\r\n\r\nconst buildInspectionNotificationEntries = (action, request, payload) => {\r\n  const entries = [];\r\n  const propertyTitle = payload.propertyTitle;\r\n  const buyerName = request.buyerName || request.userName || 'Buyer';\r\n  const vendorName = request.vendorName || request.vendor || request.owner || 'Vendor';\r\n  const preferredLabel = formatDateTimeLabel(request.preferredDate, request.preferredTime);\r\n  const confirmedLabel = formatDateTimeLabel(request.confirmedDate, request.confirmedTime);\r\n  const proposedLabel = formatDateTimeLabel(request.proposedDate, request.proposedTime);\r\n\r\n  const pushForVendor = (title, message) => {\r\n    if (request.vendorId || request.vendorEmail) {\r\n      entries.push({\r\n        recipientId: request.vendorId,\r\n        recipientEmail: request.vendorEmail,\r\n        roles: ['vendor'],\r\n        type: action,\r\n        title,\r\n        message,\r\n        priority: 'medium',\r\n        metadata: { requestId: request.id, propertyTitle, buyerName, vendorName }\r\n      });\r\n    }\r\n  };\r\n\r\n  const pushForBuyer = (title, message) => {\r\n    if (request.buyerId || request.userId || request.buyerEmail || request.userEmail) {\r\n      entries.push({\r\n        recipientId: request.buyerId || request.userId,\r\n        recipientEmail: request.buyerEmail || request.userEmail,\r\n        roles: ['buyer'],\r\n        type: action,\r\n        title,\r\n        message,\r\n        priority: 'medium',\r\n        metadata: { requestId: request.id, propertyTitle, buyerName, vendorName }\r\n      });\r\n    }\r\n  };\r\n\r\n  switch (action) {\r\n    case 'inspection_requested':\r\n      pushForVendor('New inspection request', `${buyerName} requested to view ${propertyTitle} ${preferredLabel ? `on ${preferredLabel}` : ''}`.trim());\r\n      break;\r\n    case 'inspection_confirmed':\r\n      pushForBuyer('Inspection confirmed', `${vendorName} confirmed ${propertyTitle} ${confirmedLabel ? `for ${confirmedLabel}` : ''}`.trim());\r\n      break;\r\n    case 'vendor_proposed_new_time':\r\n      pushForBuyer('Vendor proposed new time', `${vendorName} suggested ${proposedLabel || 'another slot'} for ${propertyTitle}`);\r\n      break;\r\n    case 'buyer_rescheduled':\r\n      pushForVendor('Buyer requested new time', `${buyerName} rescheduled ${propertyTitle} ${preferredLabel ? `to ${preferredLabel}` : ''}`.trim());\r\n      break;\r\n    case 'inspection_cancelled_by_buyer':\r\n      pushForVendor('Inspection cancelled by buyer', `${buyerName} cancelled ${propertyTitle}`);\r\n      break;\r\n    case 'inspection_cancelled_by_vendor':\r\n      pushForBuyer('Inspection cancelled by vendor', `${vendorName} cancelled ${propertyTitle}`);\r\n      break;\r\n    case 'inspection_declined':\r\n      pushForBuyer('Inspection declined', `${vendorName} declined the request for ${propertyTitle}`);\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  return entries;\r\n};\r\n\r\nconst persistInspectionNotifications = (entries = []) => {\r\n  if (!entries.length || typeof window === 'undefined') return;\r\n  const payloads = entries\r\n    .filter((entry) => entry.recipientId)\r\n    .map((entry) => ({\r\n      recipientId: entry.recipientId,\r\n      type: entry.type,\r\n      title: entry.title,\r\n      message: entry.message,\r\n      priority: entry.priority || 'medium',\r\n      metadata: {\r\n        ...(entry.metadata || {}),\r\n        source: entry.metadata?.source || 'inspection_client_sync'\r\n      },\r\n      data: entry.metadata || {}\r\n    }));\r\n\r\n  if (!payloads.length) return;\r\n\r\n  notificationService.createInspectionNotifications(payloads)\r\n    .then((result) => {\r\n      if (!result?.success) {\r\n        console.warn('Failed to persist inspection notifications', result);\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error persisting inspection notifications:', error);\r\n    });\r\n};\r\n\r\nconst logInspectionActivity = (action, request) => {\r\n  if (!action || !request) return;\r\n  const payload = buildActivityPayload(action, request);\r\n  const log = getActivityLog();\r\n  log.unshift(payload);\r\n  if (log.length > 200) {\r\n    log.pop();\r\n  }\r\n  saveActivityLog(log);\r\n  safeWindowDispatch(ACTIVITY_EVENT, payload);\r\n  safeWindowDispatch(ANALYTICS_EVENT, payload);\r\n  const notifications = buildInspectionNotificationEntries(action, request, payload);\r\n  if (notifications.length) {\r\n    safeWindowDispatch('inspectionNotification', { action, payload, notifications, request });\r\n    persistInspectionNotifications(notifications);\r\n  }\r\n};\r\n\r\nconst deriveActionFromStatus = (previous, next, updates = {}) => {\r\n  const status = (next?.status || updates.status || '').toLowerCase();\r\n  if (!status && (updates.proposedDate || updates.proposedTime)) {\r\n    return 'vendor_proposed_new_time';\r\n  }\r\n  switch (status) {\r\n    case 'accepted':\r\n    case 'confirmed':\r\n      return 'inspection_confirmed';\r\n    case 'proposed_new_time':\r\n      return 'vendor_proposed_new_time';\r\n    case 'buyer_rescheduled':\r\n      return 'buyer_rescheduled';\r\n    case 'cancelled_by_buyer':\r\n      return 'inspection_cancelled_by_buyer';\r\n    case 'cancelled_by_vendor':\r\n      return 'inspection_cancelled_by_vendor';\r\n    case 'declined':\r\n      return 'inspection_declined';\r\n    default:\r\n      if (previous && previous.status !== next?.status) {\r\n        return `inspection_status_${next?.status || 'updated'}`;\r\n      }\r\n      return null;\r\n  }\r\n};\r\n\r\nconst getDateKey = (isoDate) => {\r\n  const date = isoDate ? new Date(isoDate) : new Date();\r\n  return date.toISOString().slice(0, 10);\r\n};\r\n\r\nconst matchesBuyer = (request, buyerId) => {\r\n  if (!buyerId) return false;\r\n  return request?.buyerId === buyerId || request?.userId === buyerId;\r\n};\r\n\r\nconst matchesVendor = (request, vendorId, vendorEmail) => {\r\n  if (!vendorId && !vendorEmail) return false;\r\n  return (vendorId && request?.vendorId === vendorId) || (vendorEmail && request?.vendorEmail === vendorEmail);\r\n};\r\n\r\nexport const getInspectionAnalytics = ({ role = 'buyer', userId, vendorId, vendorEmail } = {}) => {\r\n  if (typeof window === 'undefined') return { ...defaultAnalytics };\r\n  if (role === 'buyer' && !userId) return { ...defaultAnalytics };\r\n  if (role === 'vendor' && !vendorId && !vendorEmail) return { ...defaultAnalytics };\r\n\r\n  const requests = getStoredRequests();\r\n  const relevant = requests.filter((req) =>\r\n    role === 'buyer' ? matchesBuyer(req, userId) : matchesVendor(req, vendorId || req.vendorId, vendorEmail)\r\n  );\r\n\r\n  const analytics = {\r\n    totalRequests: relevant.length,\r\n    pendingResponses: 0,\r\n    confirmed: 0,\r\n    vendorProposals: 0,\r\n    buyerReschedules: 0,\r\n    cancelledByBuyer: 0,\r\n    cancelledByVendor: 0,\r\n    timeline: []\r\n  };\r\n\r\n  const pendingStatuses = ['pending', 'pending_vendor', 'pending_vendor_confirmation'];\r\n  const log = getActivityLog();\r\n  const activityFilter = (entry) =>\r\n    role === 'buyer' ? entry?.buyerId === userId : matchesVendor(entry, vendorId, vendorEmail);\r\n\r\n  relevant.forEach((req) => {\r\n    const status = (req.status || '').toLowerCase();\r\n    if (pendingStatuses.includes(status)) {\r\n      analytics.pendingResponses += 1;\r\n    }\r\n    if (['accepted', 'confirmed'].includes(status)) {\r\n      analytics.confirmed += 1;\r\n    }\r\n    if (status === 'proposed_new_time') {\r\n      analytics.vendorProposals += 1;\r\n    }\r\n    if (status === 'buyer_rescheduled') {\r\n      analytics.buyerReschedules += 1;\r\n    }\r\n    if (status === 'cancelled_by_buyer') {\r\n      analytics.cancelledByBuyer += 1;\r\n    }\r\n    if (['cancelled_by_vendor', 'declined'].includes(status)) {\r\n      analytics.cancelledByVendor += 1;\r\n    }\r\n  });\r\n\r\n  const lastSevenDays = Array.from({ length: 7 }).map((_, idx) => {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() - (6 - idx));\r\n    const dateKey = date.toISOString().slice(0, 10);\r\n    const dailyCount = log.filter((entry) => activityFilter(entry) && getDateKey(entry.timestamp) === dateKey).length;\r\n    return { date: dateKey, count: dailyCount };\r\n  });\r\n\r\n  analytics.timeline = lastSevenDays;\r\n  return analytics;\r\n};\r\n\r\nexport const createInspectionRequest = async (requestData) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for creating inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const existing = getStoredRequests();\r\n    const newRequest = {\r\n      id: `viewing-${Date.now()}`,\r\n      ...requestData,\r\n      createdAt: new Date().toISOString(),\r\n      status: 'pending'\r\n    };\r\n    existing.push(newRequest);\r\n    saveStoredRequests(existing);\r\n    \r\n    // Dispatch event to notify Dashboard and other components\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      viewingRequest: newRequest,\r\n      action: 'created'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(existing)\r\n    });\r\n    logInspectionActivity('inspection_requested', newRequest);\r\n    \r\n    return newRequest;\r\n  } catch (error) {\r\n    console.error('Error creating inspection request:', error);\r\n    // Final fallback to localStorage\r\n    const existing = getStoredRequests();\r\n    const newRequest = {\r\n      id: `viewing-${Date.now()}`,\r\n      ...requestData,\r\n      createdAt: new Date().toISOString(),\r\n      status: 'pending'\r\n    };\r\n    existing.push(newRequest);\r\n    saveStoredRequests(existing);\r\n    \r\n    // Dispatch event to notify Dashboard and other components\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      viewingRequest: newRequest,\r\n      action: 'created'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(existing)\r\n    });\r\n    logInspectionActivity('inspection_requested', newRequest);\r\n    \r\n    return newRequest;\r\n  }\r\n};\r\n\r\nexport const listInspectionRequestsByVendor = async (vendorId, vendorEmail) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const local = getStoredRequests();\r\n    \r\n    // Filter by vendorId or vendorEmail\r\n    const filtered = local.filter((r) => \r\n      (vendorId && r.vendorId === vendorId) || \r\n      (vendorEmail && r.vendorEmail === vendorEmail)\r\n    );\r\n    \r\n    // Sort newest first\r\n    filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\r\n    \r\n    return filtered;\r\n  } catch (error) {\r\n    console.error('Error listing inspection requests:', error);\r\n    // Final fallback to localStorage\r\n    const local = getStoredRequests();\r\n    const filtered = local.filter((r) => \r\n      (vendorId && r.vendorId === vendorId) || \r\n      (vendorEmail && r.vendorEmail === vendorEmail)\r\n    );\r\n    return filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\r\n  }\r\n};\r\n\r\nexport const listInspectionRequestsByBuyer = async (buyerId) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for buyer inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const local = getStoredRequests();\r\n    const filtered = local.filter((r) => r.buyerId === buyerId);\r\n    return filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\r\n  } catch (error) {\r\n    console.error('Error listing buyer inspection requests:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const updateInspectionRequest = async (requestId, updates) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for updating inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const all = getStoredRequests();\r\n    let nextRecord = null;\r\n    const updated = all.map((r) => {\r\n      if (r.id === requestId) {\r\n        nextRecord = { ...r, ...updates, updatedAt: new Date().toISOString() };\r\n        return nextRecord;\r\n      }\r\n      return r;\r\n    });\r\n    if (!nextRecord) {\r\n      saveStoredRequests(all);\r\n      return false;\r\n    }\r\n    saveStoredRequests(updated);\r\n    \r\n    // Dispatch event to notify Dashboard and other components when status changes\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      requestId,\r\n      updates,\r\n      action: 'updated'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(updated)\r\n    });\r\n    const action = deriveActionFromStatus(all.find((r) => r.id === requestId), nextRecord, updates);\r\n    if (action) {\r\n      logInspectionActivity(action, nextRecord);\r\n    }\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error updating inspection request:', error);\r\n    // Final fallback to localStorage\r\n    const all = getStoredRequests();\r\n    let nextRecord = null;\r\n    const updated = all.map((r) => {\r\n      if (r.id === requestId) {\r\n        nextRecord = { ...r, ...updates, updatedAt: new Date().toISOString() };\r\n        return nextRecord;\r\n      }\r\n      return r;\r\n    });\r\n    if (!nextRecord) {\r\n      saveStoredRequests(all);\r\n      return false;\r\n    }\r\n    saveStoredRequests(updated);\r\n    \r\n    // Dispatch event to notify Dashboard and other components when status changes\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      requestId,\r\n      updates,\r\n      action: 'updated'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(updated)\r\n    });\r\n    const action = deriveActionFromStatus(all.find((r) => r.id === requestId), nextRecord, updates);\r\n    if (action) {\r\n      logInspectionActivity(action, nextRecord);\r\n    }\r\n    \r\n    return true;\r\n  }\r\n};\r\n\r\nexport const syncLocalInspectionRequests = async () => {\r\n  try {\r\n    // Try to sync with API if available\r\n    const local = getStoredRequests();\r\n    console.log('Inspection requests stored locally:', local.length);\r\n    return { synced: local.length };\r\n  } catch (error) {\r\n    console.error('syncLocalInspectionRequests failed:', error);\r\n    return { synced: 0 };\r\n  }\r\n};\r\n\r\nexport default {\r\n  createInspectionRequest,\r\n  listInspectionRequestsByVendor,\r\n  listInspectionRequestsByBuyer,\r\n  updateInspectionRequest,\r\n  syncLocalInspectionRequests,\r\n  getInspectionAnalytics\r\n};"],"names":["BuyerInspectionRequests","_analytics$timeline","user","useAuth","navigate","useNavigate","requests","setRequests","useState","analytics","setAnalytics","prevStatusRef","useRef","showRescheduleModal","setShowRescheduleModal","rescheduleRequest","setRescheduleRequest","rescheduleDate","setRescheduleDate","rescheduleTime","setRescheduleTime","rescheduleNote","setRescheduleNote","showWebNotification","title","options","arguments","length","undefined","window","Notification","permission","e","toDateTime","dateStr","timeStr","Date","concat","_unused","buildCalendar","r","projectName","start","confirmedDate","confirmedTime","preferredDate","preferredTime","end","getTime","details","projectLocation","location","formatDateICS","d","pad","n","String","padStart","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","loadRequestsFromLocalStorage","id","viewingRequests","JSON","parse","localStorage","getItem","transformed","filter","req","userId","buyerId","map","_objectSpread","propertyTitle","propertyLocation","proposedDate","proposedTime","status","createdAt","requestedAt","toISOString","sort","a","b","dateA","error","console","updateRequests","newRequests","async","requestPermission","ensureNotificationPermission","prev","current","previous","body","toast","Object","fromEntries","x","getInspectionAnalytics","role","useEffect","localRequests","pollInterval","setInterval","updatedRequests","handleViewingsUpdate","handleAnalyticsUpdate","event","detail","data","addEventListener","key","clearInterval","removeEventListener","_jsxs","className","children","_jsx","pendingResponses","confirmed","vendorProposals","cancelledByVendor","timeline","totalRequests","item","date","toLocaleDateString","count","_r$status","replaceAll","onClick","request","propertyId","projectId","handleViewProperty","FaEye","_Fragment","updateInspectionRequest","success","acceptProposal","declineProposal","fmt","text","encodeURIComponent","dates","detailsEnc","locationEnc","url","open","openGoogleCalendar","ics","join","blob","Blob","type","URL","createObjectURL","document","createElement","href","download","appendChild","click","removeChild","revokeObjectURL","downloadICS","openReschedule","confirm","cancelledAt","handleCancelRequest","value","onChange","target","rows","placeholder","buyerMessage","VIEWING_REQUESTS_KEY","INSPECTION_ACTIVITY_KEY","defaultAnalytics","buyerReschedules","cancelledByBuyer","safeWindowDispatch","eventName","dispatchEvent","CustomEvent","StorageEvent","getStoredRequests","_unused2","saveStoredRequests","setItem","stringify","getActivityLog","_unused3","formatDateTimeLabel","time","logInspectionActivity","action","payload","buildActivityPayload","requestId","projectTitle","vendorId","vendorEmail","timestamp","log","unshift","pop","saveActivityLog","notifications","buildInspectionNotificationEntries","entries","buyerName","userName","vendorName","vendor","owner","preferredLabel","confirmedLabel","proposedLabel","pushForVendor","message","push","recipientId","recipientEmail","roles","priority","metadata","pushForBuyer","buyerEmail","userEmail","trim","payloads","entry","_entry$metadata","source","notificationService","createInspectionNotifications","then","result","warn","catch","persistInspectionNotifications","deriveActionFromStatus","next","updates","toLowerCase","matchesVendor","relevant","matchesBuyer","pendingStatuses","forEach","includes","lastSevenDays","Array","from","_","idx","setDate","getDate","dateKey","slice","dailyCount","activityFilter","isoDate","createInspectionRequest","existing","newRequest","now","requestData","viewingRequest","newValue","listInspectionRequestsByVendor","filtered","all","nextRecord","updated","updatedAt","find"],"sourceRoot":""}