"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[694],{1694:(e,n,t)=>{t.r(n),t.d(n,{default:()=>J});var s=t(5043),a=t(3216),r=t(4063),i=t(3519),l=t(8139),o=t.n(l),d=t(7852),c=t(579);const u=s.forwardRef((e,n)=>{let{bsPrefix:t,variant:s,animation:a="border",size:r,as:i="div",className:l,...u}=e;t=(0,d.oU)(t,"spinner");const m=`${t}-${a}`;return(0,c.jsx)(i,{ref:n,...u,className:o()(l,m,r&&`${m}-${r}`,s&&`text-${s}`)})});u.displayName="Spinner";const m=u;var v=t(7636),h=t(4282),x=t(1072),f=t(8602),y=t(8258),j=t(9620),p=(t(6440),t(1969)),A=t(3818);var g=t(3539);const b=s.createContext(null);b.displayName="NavContext";const N=b,I=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=e?String(e):n||null},w=s.createContext(null),C=s.createContext(null);var _=t(5425),k=t(8894),P=t(4140);const D=["as","active","eventKey"];function R(e){let{key:n,onClick:t,active:a,id:r,role:i,disabled:l}=e;const o=(0,s.useContext)(w),d=(0,s.useContext)(N),c=(0,s.useContext)(C);let u=a;const m={role:i};if(d){i||"tablist"!==d.role||(m.role="tab");const e=d.getControllerId(null!=n?n:null),t=d.getControlledId(null!=n?n:null);m[(0,_.sE)("event-key")]=n,m.id=e||r,u=null==a&&null!=n?d.activeKey===n:a,!u&&(null!=c&&c.unmountOnExit||null!=c&&c.mountOnEnter)||(m["aria-controls"]=t)}return"tab"===m.role&&(m["aria-selected"]=u,u||(m.tabIndex=-1),l&&(m.tabIndex=-1,m["aria-disabled"]=!0)),m.onClick=(0,k.A)(e=>{l||(null==t||t(e),null!=n&&o&&!e.isPropagationStopped()&&o(n,e))}),[m,{isActive:u}]}const S=s.forwardRef((e,n)=>{let{as:t=P.Ay,active:s,eventKey:a}=e,r=function(e,n){if(null==e)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(n.indexOf(s)>=0)continue;t[s]=e[s]}return t}(e,D);const[i,l]=R(Object.assign({key:I(a,r.href),active:s},r));return i[(0,_.sE)("active")]=l.isActive,(0,c.jsx)(t,Object.assign({},r,i,{ref:n}))});S.displayName="NavItem";const O=S,$=["as","onSelect","activeKey","role","onKeyDown"];const E=()=>{},K=(0,_.sE)("event-key"),T=s.forwardRef((e,n)=>{let{as:t="div",onSelect:a,activeKey:r,role:i,onKeyDown:l}=e,o=function(e,n){if(null==e)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(n.indexOf(s)>=0)continue;t[s]=e[s]}return t}(e,$);const d=function(){const[,e]=(0,s.useReducer)(e=>e+1,0);return e}(),u=(0,s.useRef)(!1),m=(0,s.useContext)(w),v=(0,s.useContext)(C);let h,x;v&&(i=i||"tablist",r=v.activeKey,h=v.getControlledId,x=v.getControllerId);const f=(0,s.useRef)(null),y=e=>{const n=f.current;if(!n)return null;const t=(0,A.A)(n,`[${K}]:not([aria-disabled=true])`),s=n.querySelector("[aria-selected=true]");if(!s||s!==document.activeElement)return null;const a=t.indexOf(s);if(-1===a)return null;let r=a+e;return r>=t.length&&(r=0),r<0&&(r=t.length-1),t[r]},j=(e,n)=>{null!=e&&(null==a||a(e,n),null==m||m(e,n))};(0,s.useEffect)(()=>{if(f.current&&u.current){const e=f.current.querySelector(`[${K}][aria-selected=true]`);null==e||e.focus()}u.current=!1});const p=(0,g.A)(n,f);return(0,c.jsx)(w.Provider,{value:j,children:(0,c.jsx)(N.Provider,{value:{role:i,activeKey:I(r),getControlledId:h||E,getControllerId:x||E},children:(0,c.jsx)(t,Object.assign({},o,{onKeyDown:e=>{if(null==l||l(e),!v)return;let n;switch(e.key){case"ArrowLeft":case"ArrowUp":n=y(-1);break;case"ArrowRight":case"ArrowDown":n=y(1);break;default:return}n&&(e.preventDefault(),j(n.dataset[(0,_.y)("EventKey")]||null,e),u.current=!0,d())},ref:p,role:i}))})})});T.displayName="Nav";const B=Object.assign(T,{Item:O});var F=t(6618);const L=s.forwardRef((e,n)=>{let{bsPrefix:t,active:s,disabled:a,eventKey:r,className:i,variant:l,action:u,as:m,...v}=e;t=(0,d.oU)(t,"list-group-item");const[h,x]=R({key:I(r,v.href),active:s,...v}),f=(0,F.A)(e=>{if(a)return e.preventDefault(),void e.stopPropagation();h.onClick(e)});a&&void 0===v.tabIndex&&(v.tabIndex=-1,v["aria-disabled"]=!0);const y=m||(u?v.href?"a":"button":"div");return(0,c.jsx)(y,{ref:n,...v,...h,onClick:f,className:o()(i,t,x.isActive&&"active",a&&"disabled",l&&`${t}-${l}`,u&&`${t}-action`)})});L.displayName="ListGroupItem";const H=L,U=s.forwardRef((e,n)=>{const{className:t,bsPrefix:s,variant:a,horizontal:r,numbered:i,as:l="div",...u}=(0,p.Zw)(e,{activeKey:"onSelect"}),m=(0,d.oU)(s,"list-group");let v;return r&&(v=!0===r?"horizontal":`horizontal-${r}`),(0,c.jsx)(B,{ref:n,...u,as:l,className:o()(t,m,a&&`${m}-${a}`,v&&`${m}-${v}`,i&&`${m}-numbered`)})});U.displayName="ListGroup";const V=Object.assign(U,{Item:H});var z=t(2083),W=t(9853),G=t(3823),q=t(2825),Z=t(5016);const J=()=>{var e,n,t,l,o,d,u;const{id:p}=(0,a.g)(),A=(0,a.Zp)(),{user:g}=(0,Z.As)(),{getEscrowTransaction:b,confirmPayment:N,releaseFunds:I,recordROIPayment:w,completeTransaction:C}=(0,G.N)(),{getInvestmentById:_}=(0,q.H)(),[k,P]=(0,s.useState)(null),[D,R]=(0,s.useState)(null),[S,O]=(0,s.useState)(null),[$,E]=(0,s.useState)(null),[K,T]=(0,s.useState)(!0),[B,F]=(0,s.useState)(null),[L,H]=(0,s.useState)(!1),[U,J]=(0,s.useState)(!1),[M,Q]=(0,s.useState)(""),[X,Y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{ee()},[p]);const ee=async()=>{try{T(!0),F(null);const r=await b(p);if(!r)return F("Escrow transaction not found"),void T(!1);if(P(r),r.investmentId||"investment"===r.type){const e=r.investmentId||p;try{const n=await _(e);n&&R(n)}catch(a){console.warn("Error loading investment:",a)}}const i=r.vendorId||r.sellerId;var e,n;if(r.sellerName)O({id:i,firstName:(null===(e=r.sellerName)||void 0===e?void 0:e.split(" ")[0])||"",lastName:(null===(n=r.sellerName)||void 0===n?void 0:n.split(" ").slice(1).join(" "))||"",email:r.sellerEmail||""});const l=r.buyerId;var t,s;if(r.buyerName)E({id:l,firstName:(null===(t=r.buyerName)||void 0===t?void 0:t.split(" ")[0])||"",lastName:(null===(s=r.buyerName)||void 0===s?void 0:s.split(" ").slice(1).join(" "))||"",email:r.buyerEmail||""})}catch(a){console.error("Error loading transaction details:",a),F(a.message||"Failed to load transaction details")}finally{T(!1)}},ne=()=>!(!g||!k)&&(g.uid===k.buyerId?["documents_verified"].includes(k.status):g.uid===k.vendorId?["payment_received","funds_released"].includes(k.status):"admin"===g.role&&["documents_uploaded","buyer_confirmed","roi_paid"].includes(k.status));if(K)return(0,c.jsx)(i.A,{className:"py-5",children:(0,c.jsx)("div",{className:"text-center",children:(0,c.jsx)(m,{animation:"border",role:"status",children:(0,c.jsx)("span",{className:"visually-hidden",children:"Loading..."})})})});if(B||!k)return(0,c.jsxs)(i.A,{className:"py-5",children:[(0,c.jsx)(v.A,{variant:"danger",children:B||"Transaction not found"}),(0,c.jsx)(h.A,{variant:"outline-primary",onClick:()=>A("/dashboard"),children:"Back to Dashboard"})]});const te={pending_payment:10,payment_received:20,documents_uploaded:40,documents_verified:60,buyer_confirmed:80,funds_released:90,roi_paid:95,completed:100,vendor_default:0,failed:0}[k.status]||0;return(0,c.jsxs)(i.A,{className:"py-5",children:[(0,c.jsxs)(x.A,{children:[(0,c.jsx)(f.A,{lg:8,children:(0,c.jsxs)(y.A,{className:"mb-4",children:[(0,c.jsxs)(y.A.Header,{className:"d-flex justify-content-between align-items-center",children:[(0,c.jsx)("h3",{children:"Escrow Transaction"}),(e=>{const n={pending_payment:{variant:"warning",text:"Pending Payment"},payment_received:{variant:"info",text:"Payment Received"},documents_uploaded:{variant:"primary",text:"Documents Uploaded"},documents_verified:{variant:"success",text:"Documents Verified"},buyer_confirmed:{variant:"success",text:"Buyer Confirmed"},funds_released:{variant:"info",text:"Funds Released"},roi_paid:{variant:"success",text:"ROI Paid"},completed:{variant:"success",text:"Completed"},vendor_default:{variant:"danger",text:"Vendor Default"},failed:{variant:"danger",text:"Failed"}}[e]||{variant:"secondary",text:e};return(0,c.jsx)(r.A,{bg:n.variant,children:n.text})})(k.status)]}),(0,c.jsxs)(y.A.Body,{children:[(0,c.jsx)("h5",{children:"Transaction Progress"}),(0,c.jsx)(j.A,{now:te,label:`${te}%`,className:"mb-4"}),(0,c.jsxs)(x.A,{children:[(0,c.jsxs)(f.A,{md:6,children:[(0,c.jsx)("h6",{children:"Transaction Details"}),(0,c.jsxs)(V,{className:"mb-4",children:[(0,c.jsxs)(V.Item,{children:[(0,c.jsx)("strong",{children:"Amount:"})," $",k.amount.toLocaleString()]}),(0,c.jsxs)(V.Item,{children:[(0,c.jsx)("strong",{children:"Created:"})," ",(null===(e=k.createdAt)||void 0===e||null===(n=e.toDate)||void 0===n||null===(t=n.call(e))||void 0===t?void 0:t.toLocaleDateString())||"N/A"]}),(0,c.jsxs)(V.Item,{children:[(0,c.jsx)("strong",{children:"Type:"})," Investment Escrow"]})]})]}),(0,c.jsxs)(f.A,{md:6,children:[(0,c.jsx)("h6",{children:"Parties"}),(0,c.jsxs)(V,{className:"mb-4",children:[(0,c.jsxs)(V.Item,{children:[(0,c.jsx)("strong",{children:"Buyer:"})," ",null===$||void 0===$?void 0:$.firstName," ",null===$||void 0===$?void 0:$.lastName]}),(0,c.jsxs)(V.Item,{children:[(0,c.jsx)("strong",{children:"Vendor:"})," ",(null===S||void 0===S?void 0:S.companyName)||(null===S||void 0===S?void 0:S.firstName)," ",null===S||void 0===S?void 0:S.lastName]}),(0,c.jsxs)(V.Item,{children:[(0,c.jsx)("strong",{children:"Investment:"})," ",null===D||void 0===D?void 0:D.title]})]})]})]}),k.propertyDocuments&&k.propertyDocuments.length>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h5",{children:"Property Documents"}),(0,c.jsxs)(v.A,{variant:"info",children:[(0,c.jsxs)("h6",{children:["Document Status: ",k.documentVerificationStatus]}),(0,c.jsx)("p",{className:"mb-2",children:"The investment company has uploaded property documents as collateral."}),(0,c.jsx)(h.A,{variant:"outline-primary",onClick:()=>H(!0),children:"View Documents"})]})]}),k.roiAmount&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h5",{children:"ROI Payment"}),(0,c.jsxs)(v.A,{variant:"success",children:[(0,c.jsxs)("h6",{children:["ROI Amount: $",k.roiAmount.toLocaleString()]}),(0,c.jsxs)("p",{className:"mb-0",children:["Paid on: ",(null===(l=k.roiPaidAt)||void 0===l||null===(o=l.toDate)||void 0===o||null===(d=o.call(l))||void 0===d?void 0:d.toLocaleDateString())||"N/A"]})]})]}),k.adminNotes&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h5",{children:"Admin Notes"}),(0,c.jsx)(v.A,{variant:"light",children:(0,c.jsx)("p",{className:"mb-0",children:k.adminNotes})})]})]})]})}),(0,c.jsx)(f.A,{lg:4,children:(0,c.jsxs)(y.A,{className:"sticky-top",style:{top:"20px"},children:[(0,c.jsx)(y.A.Header,{children:(0,c.jsx)("h5",{children:"Actions"})}),(0,c.jsxs)(y.A.Body,{children:[B&&(0,c.jsx)(v.A,{variant:"danger",children:B}),g&&ne()&&(0,c.jsxs)("div",{className:"d-grid gap-2",children:[(null===g||void 0===g?void 0:g.uid)===k.buyerId&&"documents_verified"===k.status&&(0,c.jsx)(h.A,{variant:"success",onClick:async()=>{try{Y(!0),await N(p),await ee()}catch(e){F(e.message)}finally{Y(!1)}},disabled:X,children:X?"Processing...":"Confirm Payment"}),(null===g||void 0===g?void 0:g.uid)===k.vendorId&&"funds_released"===k.status&&(0,c.jsx)(h.A,{variant:"primary",onClick:()=>J(!0),disabled:X,children:"Record ROI Payment"}),"admin"===(null===g||void 0===g?void 0:g.role)&&"roi_paid"===k.status&&(0,c.jsx)(h.A,{variant:"success",onClick:async()=>{try{Y(!0),await C(p),await ee()}catch(e){F(e.message)}finally{Y(!1)}},disabled:X,children:"Complete Transaction"})]}),!ne()&&(0,c.jsx)(v.A,{variant:"info",children:(0,c.jsxs)("p",{className:"mb-0",children:["pending_payment"===k.status&&"Waiting for payment...","payment_received"===k.status&&"Waiting for document upload...","documents_uploaded"===k.status&&"Waiting for document verification...","buyer_confirmed"===k.status&&"Waiting for fund release...","funds_released"===k.status&&"Waiting for ROI payment...","completed"===k.status&&"Transaction completed successfully!"]})}),(0,c.jsx)("div",{className:"mt-3",children:(0,c.jsx)(h.A,{variant:"outline-secondary",onClick:()=>A("/dashboard"),className:"w-100",children:"Back to Dashboard"})})]})]})})]}),(0,c.jsxs)(z.A,{show:L,onHide:()=>H(!1),size:"lg",children:[(0,c.jsx)(z.A.Header,{closeButton:!0,children:(0,c.jsx)(z.A.Title,{children:"Property Documents"})}),(0,c.jsx)(z.A.Body,{children:null===(u=k.propertyDocuments)||void 0===u?void 0:u.map((e,n)=>{var t,s,a;return(0,c.jsx)(y.A,{className:"mb-3",children:(0,c.jsx)(y.A.Body,{children:(0,c.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h6",{children:e.name}),(0,c.jsxs)("small",{className:"text-muted",children:["Uploaded: ",(null===(t=e.uploadedAt)||void 0===t||null===(s=t.toDate)||void 0===s||null===(a=s.call(t))||void 0===a?void 0:a.toLocaleDateString())||"N/A"]})]}),(0,c.jsx)(h.A,{variant:"outline-primary",href:e.url,target:"_blank",children:"View Document"})]})})},n)})}),(0,c.jsx)(z.A.Footer,{children:(0,c.jsx)(h.A,{variant:"secondary",onClick:()=>H(!1),children:"Close"})})]}),(0,c.jsxs)(z.A,{show:U,onHide:()=>J(!1),children:[(0,c.jsx)(z.A.Header,{closeButton:!0,children:(0,c.jsx)(z.A.Title,{children:"Record ROI Payment"})}),(0,c.jsx)(z.A.Body,{children:(0,c.jsxs)(W.A,{children:[(0,c.jsxs)(W.A.Group,{className:"mb-3",children:[(0,c.jsx)(W.A.Label,{children:"ROI Amount Paid"}),(0,c.jsx)(W.A.Control,{type:"number",value:M,onChange:e=>Q(e.target.value),placeholder:"Enter ROI amount",min:"0",step:"0.01"})]}),(0,c.jsx)(v.A,{variant:"info",children:(0,c.jsx)("p",{className:"mb-0",children:"This will record the ROI payment made to the investor. Once confirmed, the transaction can be completed and property documents returned."})})]})}),(0,c.jsxs)(z.A.Footer,{children:[(0,c.jsx)(h.A,{variant:"secondary",onClick:()=>J(!1),children:"Cancel"}),(0,c.jsx)(h.A,{variant:"success",onClick:async()=>{if(!M||parseFloat(M)<=0)F("Please enter a valid ROI amount");else try{Y(!0),await w(p,parseFloat(M),null),J(!1),Q(""),await ee()}catch(e){F(e.message)}finally{Y(!1)}},disabled:X||!M,children:X?"Processing...":"Record Payment"})]})]})]})}}}]);
//# sourceMappingURL=694.a4b09192.chunk.js.map