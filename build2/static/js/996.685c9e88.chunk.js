"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[996],{325:(e,t,a)=>{a.d(t,{A:()=>r});const r=new class{async uploadFile(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{var r,s,o,l,i;const n=new FormData;n.append("file",e),n.append("uploadType","generic"),n.append("metadata",JSON.stringify({path:t,...a}));const d=await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:n}),c=await d.json();if(!d.ok||null===c||void 0===c||!c.success)throw new Error((null===c||void 0===c?void 0:c.message)||"Upload failed");return{success:!0,url:null===(r=c.data)||void 0===r?void 0:r.url,path:(null===(s=c.data)||void 0===s?void 0:s.publicId)||t,name:(null===(o=c.data)||void 0===o?void 0:o.originalName)||e.name,size:(null===(l=c.data)||void 0===l?void 0:l.size)||e.size,type:(null===(i=c.data)||void 0===i?void 0:i.format)||e.type}}catch(n){return console.error("Error uploading file:",n),{success:!1,error:n.message||"Upload failed"}}}async uploadMultipleFiles(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{var r,s,o;const l=new FormData;e.forEach(e=>l.append("files",e)),l.append("uploadType","multiple"),l.append("metadata",JSON.stringify({basePath:t,...a}));const i=await fetch("/api/upload/multiple",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:l}),n=await i.json();if(!i.ok||null===n||void 0===n||!n.success)throw new Error((null===n||void 0===n?void 0:n.message)||"Upload failed");return{success:!0,successful:(null===(r=n.data)||void 0===r?void 0:r.successful)||[],failed:(null===(s=n.data)||void 0===s?void 0:s.failed)||[],total:(null===(o=n.data)||void 0===o?void 0:o.total)||e.length}}catch(l){return console.error("Error uploading multiple files:",l),{success:!1,error:l.message||"Upload failed"}}}async moveFile(e,t){return{success:!0,url:null,path:t||e,name:(t||e||"").split("/").pop()}}async uploadPropertyImages(e,t,a){try{var r,s,o;const l=new FormData;e.forEach(e=>{l.append("files",e)}),l.append("uploadType","property_images"),l.append("metadata",JSON.stringify({propertyId:t,userId:a}));const i=await fetch("/api/upload/multiple",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:l}),n=await i.json();if(!i.ok||null===n||void 0===n||!n.success)throw new Error((null===n||void 0===n?void 0:n.message)||"Upload failed");return{success:!0,successful:(null===(r=n.data)||void 0===r?void 0:r.successful)||[],failed:(null===(s=n.data)||void 0===s?void 0:s.failed)||[],total:(null===(o=n.data)||void 0===o?void 0:o.total)||e.length}}catch(l){return console.error("Error uploading property images:",l),{success:!1,error:l.message||"Upload failed"}}}async uploadUserAvatar(e,t){if(!t)return{success:!1,error:"User ID is required"};const a=`users/${t}/avatar/${`avatar_${t}_${Date.now()}.${e.name.split(".").pop()}`}`,r=this.validateFile(e,["image/jpeg","image/jpg","image/png","image/gif","image/webp"],5242880);if(!r.valid)return{success:!1,error:r.errors.join(", ")};const s=await this.uploadFile(e,a,{userId:t});if(s.success){const e={userId:t,avatarUrl:s.url,uploadDate:(new Date).toISOString(),fileName:s.name};localStorage.setItem(`user_avatar_${t}`,JSON.stringify(e))}return s}getFallbackAvatar(e){const t=`https://ui-avatars.com/api/?name=${encodeURIComponent(e)}&background=random&size=200`,a={userId:e,avatarUrl:t,uploadDate:(new Date).toISOString(),fileName:"fallback_avatar",isFallback:!0};return localStorage.setItem(`user_avatar_${e}`,JSON.stringify(a)),{success:!0,url:t,path:`users/${e}/avatar/fallback_${Date.now()}`,name:"fallback_avatar",size:0,type:"image/png",isFallback:!0}}async uploadEscrowDocument(e,t,a,r){try{var s,o,l,i,n;const d=new FormData;d.append("file",e),d.append("uploadType","escrow_document"),d.append("metadata",JSON.stringify({escrowId:t,documentType:a,userId:r}));const c=await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:d}),u=await c.json();if(!c.ok||null===u||void 0===u||!u.success)throw new Error((null===u||void 0===u?void 0:u.message)||"Upload failed");return{success:!0,url:null===(s=u.data)||void 0===s?void 0:s.url,path:null===(o=u.data)||void 0===o?void 0:o.publicId,name:null===(l=u.data)||void 0===l?void 0:l.originalName,size:null===(i=u.data)||void 0===i?void 0:i.size,type:null===(n=u.data)||void 0===n?void 0:n.format}}catch(d){return console.error("Error uploading escrow document:",d),{success:!1,error:d.message||"Upload failed"}}}async deleteFile(){return{success:!1,error:"Delete is not supported in this build."}}async getFileMetadata(){return{success:!1,error:"Metadata lookup is not supported in this build."}}async listFiles(){return{success:!1,error:"Listing files is not supported in this build."}}async getPropertyImages(){return{success:!1,error:"Listing images is not supported in this build."}}async getEscrowDocuments(){return{success:!1,error:"Listing documents is not supported in this build."}}validateFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5242880;const r=[];return t.length>0&&!t.includes(e.type)&&r.push(`File type ${e.type} is not allowed. Allowed types: ${t.join(", ")}`),e.size>a&&r.push(`File size ${(e.size/1024/1024).toFixed(2)}MB exceeds maximum allowed size of ${(a/1024/1024).toFixed(2)}MB`),{valid:0===r.length,errors:r}}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}}},9996:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var r=a(5043),s=a(5016),o=a(5369),l=a(3768),i=a(325),n=a(579);const d=()=>{var e;const{user:t,updateUserProfile:a}=(0,s.As)(),[d,c]=(0,r.useState)({firstName:(null===t||void 0===t?void 0:t.firstName)||"",lastName:(null===t||void 0===t?void 0:t.lastName)||"",email:(null===t||void 0===t?void 0:t.email)||(null===t||void 0===t||null===(e=t.user)||void 0===e?void 0:e.email)||"",phone:(null===t||void 0===t?void 0:t.phone)||"",bio:(null===t||void 0===t?void 0:t.bio)||"",avatar:(null===t||void 0===t?void 0:t.avatar)||""}),[u,m]=(0,r.useState)({}),[g,p]=(0,r.useState)(!1),[v,x]=(0,r.useState)(!1),[b,h]=(0,r.useState)((null===t||void 0===t?void 0:t.avatar)||null),[f,y]=(0,r.useState)(!1),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(t){var e;let r=null;try{const e=JSON.parse(localStorage.getItem("currentUser")||"{}");e.avatar&&e.avatar.startsWith("data:")&&(r=e.avatar)}catch(a){console.error("Error reading localStorage:",a)}const s=r||(null===t||void 0===t?void 0:t.avatar)||"",o=!b||s&&s!==b;c({firstName:(null===t||void 0===t?void 0:t.firstName)||"",lastName:(null===t||void 0===t?void 0:t.lastName)||"",email:(null===t||void 0===t?void 0:t.email)||(null===t||void 0===t||null===(e=t.user)||void 0===e?void 0:e.email)||"",phone:(null===t||void 0===t?void 0:t.phone)||"",bio:(null===t||void 0===t?void 0:t.bio)||"",avatar:s}),o&&h(s||null)}},[t]);const j=e=>{const{name:t,value:a}=e.target;c(e=>({...e,[t]:a})),u[t]&&m(e=>({...e,[t]:""}))},w=()=>{var e;null===(e=N.current)||void 0===e||e.click()};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile Settings"}),(0,n.jsx)("p",{className:"mt-1 text-gray-600",children:"Manage your account information"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,n.jsx)("div",{className:"lg:col-span-2",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Personal Information"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Profile Picture"}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)("div",{className:"relative",children:[b?(0,n.jsx)("img",{src:b,alt:"Profile",className:"h-24 w-24 rounded-full object-cover border-4 border-gray-200"}):(0,n.jsx)("div",{className:"h-24 w-24 rounded-full bg-gray-200 flex items-center justify-center border-4 border-gray-300",children:(0,n.jsx)(o.x$1,{className:"h-10 w-10 text-gray-400"})}),(0,n.jsx)("button",{type:"button",onClick:w,disabled:v,className:"absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",children:(0,n.jsx)(o.p5B,{className:"h-3 w-3"})})]}),(0,n.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,n.jsxs)("button",{type:"button",onClick:w,disabled:v,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:[(0,n.jsx)(o.HVe,{className:"mr-2 h-4 w-4"}),v?"Uploading...":"Change Picture"]}),b&&(0,n.jsxs)("button",{type:"button",onClick:async()=>{try{h(null),c(e=>({...e,avatar:""}));try{const e=JSON.parse(localStorage.getItem("currentUser")||"{}");delete e.avatar,localStorage.setItem("currentUser",JSON.stringify(e))}catch(e){console.error("Error removing avatar from localStorage:",e)}await a({avatar:""}),N.current&&(N.current.value=""),l.Ay.success("Profile picture removed")}catch(t){console.error("Error removing avatar:",t),l.Ay.error("Failed to remove profile picture")}},className:"flex items-center px-4 py-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors",children:[(0,n.jsx)(o.QCr,{className:"mr-2 h-4 w-4"}),"Remove Picture"]}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"JPG, PNG, WEBP or GIF. Max size 5MB"})]}),(0,n.jsx)("input",{ref:N,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:async e=>{var r;const s=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!s)return;if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(s.type))return void l.Ay.error("Please select a valid image file (JPEG, PNG, WEBP, or GIF)");if(s.size>5242880)return void l.Ay.error("Image size must be less than 5MB");const o=await new Promise((e,t)=>{const a=new FileReader;a.onload=t=>{h(t.target.result),e(t.target.result)},a.onerror=t,a.readAsDataURL(s)});x(!0);try{const e=(null===t||void 0===t?void 0:t.id)||(null===t||void 0===t?void 0:t.uid);if(!e)throw new Error("User not authenticated");const r=await i.A.uploadUserAvatar(s,e);let n;if(!r.success){console.error("Backend upload failed:",r.error),console.log("Using local data URL as fallback"),n=o;try{const e={...JSON.parse(localStorage.getItem("currentUser")||"{}"),avatar:n};localStorage.setItem("currentUser",JSON.stringify(e)),console.log("Saved avatar to localStorage:",n.substring(0,50)+"...")}catch(d){console.error("Error saving to localStorage:",d)}try{await a({avatar:n})}catch(u){console.warn("updateUserProfile failed:",u)}return c(e=>({...e,avatar:n})),h(n),void l.Ay.error("Profile picture saved locally. Server upload failed.")}n=r.url,console.log("Backend upload successful:",n),await a({avatar:n}),c(e=>({...e,avatar:n})),h(n);try{const e={...JSON.parse(localStorage.getItem("currentUser")||"{}"),avatar:n};localStorage.setItem("currentUser",JSON.stringify(e))}catch(d){console.error("Error saving to localStorage:",d)}l.Ay.success("Profile picture uploaded successfully!")}catch(m){var n;console.error("Avatar upload error:",m);let e="Failed to upload profile picture";null!==(n=m.message)&&void 0!==n&&n.includes("permission")?e="Upload permission denied. Please try again.":m.message&&(e=m.message),l.Ay.error(e),h((null===t||void 0===t?void 0:t.avatar)||null)}finally{x(!1),N.current&&(N.current.value="")}},className:"hidden"})]})]}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const r=(()=>{const e={};return d.firstName||(e.firstName="First name is required"),d.lastName||(e.lastName="Last name is required"),e})();if(Object.keys(r).length>0)m(r);else{p(!0);try{const r=b||d.avatar||(null===t||void 0===t?void 0:t.avatar)||"",s={firstName:d.firstName,lastName:d.lastName,phone:d.phone,bio:d.bio,avatar:r};a&&await a(s);try{const e={...JSON.parse(localStorage.getItem("currentUser")||"{}"),...s};localStorage.setItem("currentUser",JSON.stringify(e)),console.log("Profile saved to localStorage")}catch(e){console.error("Error updating localStorage:",e)}c(e=>({...e,avatar:r})),r&&h(r),y(!0),l.Ay.success("Profile updated successfully!"),setTimeout(()=>y(!1),3e3)}catch(s){console.error("Profile update error:",s),l.Ay.error("Failed to update profile")}finally{p(!1)}}},className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),(0,n.jsx)("input",{type:"text",name:"firstName",value:d.firstName,onChange:j,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(u.firstName?"border-red-300":"border-gray-300")}),u.firstName&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.firstName})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),(0,n.jsx)("input",{type:"text",name:"lastName",value:d.lastName,onChange:j,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(u.lastName?"border-red-300":"border-gray-300")}),u.lastName&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.lastName})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email ",(0,n.jsx)("span",{className:"text-gray-400 text-xs",children:"(Cannot be changed)"})]}),(0,n.jsx)("input",{type:"email",name:"email",value:d.email,readOnly:!0,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-600 cursor-not-allowed"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Your email is locked to your login credentials"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,n.jsx)("input",{type:"tel",name:"phone",value:d.phone,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(555) 123-4567"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,n.jsx)("textarea",{name:"bio",value:d.bio,onChange:j,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tell us about yourself..."})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",disabled:g,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:g?"Saving...":"Save Changes"})})]})]})}),(0,n.jsxs)("div",{className:"lg:col-span-1",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Information"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Member Since"}),(0,n.jsx)("p",{className:"font-medium",children:null!==t&&void 0!==t&&t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Account Status"}),(0,n.jsx)("p",{className:"font-medium text-green-600",children:"Active"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"User ID"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("p",{className:"font-mono font-bold text-blue-600 text-lg tracking-wider",children:(null===t||void 0===t?void 0:t.userCode)||"PAK-XXXXXX"}),(0,n.jsx)("button",{onClick:async e=>{const a=e.currentTarget,r=a.textContent;try{const e=(null===t||void 0===t?void 0:t.userCode)||"";if(!e)return void l.Ay.error("User ID not available");await navigator.clipboard.writeText(e),a.textContent="Copied!",a.classList.add("bg-green-100","text-green-700"),a.classList.remove("bg-blue-100","text-blue-700"),l.Ay.success(`User ID "${e}" copied!`,{icon:"\u2705",duration:3e3,style:{background:"#10b981",color:"#fff"}}),setTimeout(()=>{a.textContent=r,a.classList.remove("bg-green-100","text-green-700"),a.classList.add("bg-blue-100","text-blue-700")},2e3)}catch(s){const e=(null===t||void 0===t?void 0:t.userCode)||"";if(!e)return void l.Ay.error("User ID not available");const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),a.textContent="Copied!",a.classList.add("bg-green-100","text-green-700"),a.classList.remove("bg-blue-100","text-blue-700"),l.Ay.success(`User ID "${e}" copied!`,{icon:"\u2705",duration:3e3,style:{background:"#10b981",color:"#fff"}}),setTimeout(()=>{a.textContent=r,a.classList.remove("bg-green-100","text-green-700"),a.classList.add("bg-blue-100","text-blue-700")},2e3)}},className:"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded transition-colors",children:"Copy"})]})]}),(null===t||void 0===t?void 0:t.vendorCode)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Vendor ID"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("p",{className:"font-mono font-bold text-green-600 text-lg tracking-wider",children:t.vendorCode}),(0,n.jsx)("button",{onClick:async e=>{const a=e.currentTarget,r=a.textContent;try{const e=(null===t||void 0===t?void 0:t.vendorCode)||"";if(!e)return void l.Ay.error("Vendor ID not available");await navigator.clipboard.writeText(e),a.textContent="Copied!",a.classList.add("bg-blue-100","text-blue-700"),a.classList.remove("bg-green-100","text-green-700"),l.Ay.success(`Vendor ID "${e}" copied!`,{icon:"\u2705",duration:3e3,style:{background:"#10b981",color:"#fff"}}),setTimeout(()=>{a.textContent=r,a.classList.remove("bg-blue-100","text-blue-700"),a.classList.add("bg-green-100","text-green-700")},2e3)}catch(s){const e=(null===t||void 0===t?void 0:t.vendorCode)||"";if(!e)return void l.Ay.error("Vendor ID not available");const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),a.textContent="Copied!",a.classList.add("bg-blue-100","text-blue-700"),a.classList.remove("bg-green-100","text-green-700"),l.Ay.success(`Vendor ID "${e}" copied!`,{icon:"\u2705",duration:3e3,style:{background:"#10b981",color:"#fff"}}),setTimeout(()=>{a.textContent=r,a.classList.remove("bg-blue-100","text-blue-700"),a.classList.add("bg-green-100","text-green-700")},2e3)}},className:"text-xs bg-green-100 hover:bg-green-200 text-green-700 px-2 py-1 rounded transition-colors",children:"Copy"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Share this with buyers to find your properties"})]})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md",children:"Change Password"}),(0,n.jsx)("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md",children:"Notification Settings"}),(0,n.jsx)("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md",children:"Privacy Settings"}),(0,n.jsx)("button",{className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md",children:"Delete Account"})]})]})]})]})]})})}}}]);
//# sourceMappingURL=996.685c9e88.chunk.js.map