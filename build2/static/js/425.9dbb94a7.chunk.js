"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[425],{3425:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var s=r(5043),a=r(3216),o=r(5475),i=r(5016),l=r(4345),n=r(5369),d=r(3768),c=r(579);const p=()=>{const{user:e}=(0,i.As)(),t=(0,a.Zp)(),{properties:r=[],toggleFavorite:p,fetchProperties:m,loading:u}=(0,l.NC)(),[g,v]=(0,s.useState)([]),[x,h]=(0,s.useState)(!0),[y,b]=(0,s.useState)("dateAdded"),[f,N]=(0,s.useState)("all"),j=(0,s.useCallback)(()=>{if(!e||!e.id)return console.warn("SavedProperties: No user available, skipping load"),v([]),void h(!1);try{const t=`favorites_${e.id}`,s=JSON.parse(localStorage.getItem(t)||"[]"),a=`favorites_metadata_${e.id}`,o=JSON.parse(localStorage.getItem(a)||"{}");if(console.log("SavedProperties: Loading saved properties",{savedFavoriteIds:s,savedFavoriteIdsCount:s.length,propertiesAvailable:r.length,savedMetadataCount:Object.keys(o).length,propertyIdsSample:r.slice(0,3).map(e=>e.id||e.propertyId||e._id)}),!Array.isArray(s)||0===s.length)return v([]),void h(!1);const i=(e,t)=>{var r,s,a,o,i,l,n;return{id:String(e.id||e.propertyId||e._id||t),title:e.title||"Untitled Property",location:"string"===typeof e.location?e.location:null!==(r=e.location)&&void 0!==r&&r.address?`${e.location.address}${e.location.city?", "+e.location.city:""}${e.location.state?", "+e.location.state:""}`.replace(/^, |, $/g,"").trim():e.city&&e.state?`${e.city}, ${e.state}`:e.city||e.state||e.address||"Location not specified",price:e.price||0,bedrooms:e.bedrooms||(null===(s=e.details)||void 0===s?void 0:s.bedrooms)||0,bathrooms:e.bathrooms||(null===(a=e.details)||void 0===a?void 0:a.bathrooms)||0,area:e.area||(null===(o=e.details)||void 0===o?void 0:o.sqft)||e.sqft||0,image:e.image||(null===(i=e.images)||void 0===i||null===(l=i[0])||void 0===l?void 0:l.url)||(null===(n=e.images)||void 0===n?void 0:n[0])||"https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=400&h=300&fit=crop",dateAdded:e.dateAdded||e.createdAt||(new Date).toISOString().split("T")[0],status:e.status||e.listingType||e.statusSlug||"available",type:e.type||e.typeSlug||"sale",agent:e.agent||e.owner||{name:e.vendorName||"Property Agent",phone:e.vendorPhone||e.contactPhone||"+234-XXX-XXXX",email:e.vendorEmail||e.contactEmail||"agent@example.com"}}},l=s.map(e=>{const t=String(e),s=r.find(r=>{const s=r.id||r.propertyId||r._id;return String(s||"")===t||s===e||String(s)===String(e)});if(s)return i(s,e);const a=o[t];return a?(console.log("SavedProperties: Using saved metadata for property",t),i(a,e)):(console.warn("SavedProperties: Property not found in properties list or metadata",{favoriteId:e,favoriteIdStr:t,favoriteIdType:typeof e,availablePropertyIds:r.map(e=>({id:e.id||e.propertyId||e._id,idStr:String(e.id||e.propertyId||e._id),type:typeof(e.id||e.propertyId||e._id)})).slice(0,5)}),null)}).filter(Boolean);console.log("SavedProperties: Loaded properties result",{savedFavoriteIdsCount:s.length,matchedPropertiesCount:l.length,totalPropertiesAvailable:r.length,unmatchedIds:s.filter(e=>!l.find(t=>{var r;return t.id===e||(null===(r=t.id)||void 0===r?void 0:r.toString())===(null===e||void 0===e?void 0:e.toString())}))}),v(l),h(!1)}catch(t){console.error("Error loading saved properties:",t),v([]),h(!1)}},[e,r]);(0,s.useEffect)(()=>{e&&m&&(0!==r.length||u||(console.log("SavedProperties: Fetching properties..."),m()))},[e,m,r.length,u]),(0,s.useEffect)(()=>{if(0===r.length){const e=setTimeout(()=>{j()},500);return()=>clearTimeout(e)}j()},[j,r.length]),(0,s.useEffect)(()=>{if(!e)return;const t=t=>{t.key===`favorites_${e.id}`&&(console.log("SavedProperties: Storage change detected, reloading..."),j())};window.addEventListener("storage",t);const r=e=>{console.log("SavedProperties: Favorites updated event received",e.detail),setTimeout(()=>{j()},100)};return window.addEventListener("favoritesUpdated",r),()=>{window.removeEventListener("storage",t),window.removeEventListener("favoritesUpdated",r)}},[e,j]);const w=r=>{if(console.log("\ud83d\udd25 SavedProperties: handleBuyProperty called with property:",r),!e)return console.warn("\ud83d\udd25 SavedProperties: No user logged in"),void d.Ay.error("Please register to purchase properties");if("sold"===r.status)return console.warn("\ud83d\udd25 SavedProperties: Property already sold"),void d.Ay.error("This property has already been sold");const s=`/escrow/create?propertyId=${r.id}&type=purchase`;console.log("\ud83d\udd25 SavedProperties: Navigating to:",s),console.log("\ud83d\udd25 SavedProperties: Property ID:",r.id,"Type:",typeof r.id),t(s)},S=t=>{var r,s;if(console.log("Contact Agent clicked, property:",t,"user:",e),!e)return void d.Ay.error("Please register to contact agents");!function(t,r){var s,a,o,i,l,n,d,c,p,m,u,g,v,x,h,y,b,f,N;let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!e||!e.id||!t)return void console.warn("createInquiry: Missing user or property information");const w=JSON.parse(localStorage.getItem("inquiries")||"[]"),S=w.find(r=>r.propertyId===t.id&&(r.userId===e.id||r.buyerId===e.id)&&("new"===r.status||"pending"===r.status||"contacted"===r.status));if(S)return S;const P="string"===typeof t.location?t.location:(null===(s=t.location)||void 0===s?void 0:s.address)||(null===(a=t.location)||void 0===a?void 0:a.city)||t.address||t.city||"Location not specified",A={id:`inquiry-${Date.now()}`,propertyId:t.id,propertyTitle:t.title,propertyLocation:P,propertyPrice:t.price||0,propertyImage:(null===(o=t.images)||void 0===o||null===(i=o[0])||void 0===i?void 0:i.url)||t.image||(null===(l=t.images)||void 0===l?void 0:l[0])||"",propertyBedrooms:t.bedrooms||(null===(n=t.details)||void 0===n?void 0:n.bedrooms)||0,propertyBathrooms:t.bathrooms||(null===(d=t.details)||void 0===d?void 0:d.bathrooms)||0,propertyArea:t.area||(null===(c=t.details)||void 0===c?void 0:c.sqft)||0,userId:e.id,buyerId:e.id,buyerName:`${e.firstName} ${e.lastName}`,buyerEmail:e.email,buyerPhone:e.phone||"",vendorId:t.vendorId||(null===(p=t.owner)||void 0===p?void 0:p.id)||(null===(m=t.vendor)||void 0===m?void 0:m.id)||"",vendorName:null!==(u=t.owner)&&void 0!==u&&u.firstName?`${t.owner.firstName} ${t.owner.lastName||""}`.trim():null!==(g=t.vendor)&&void 0!==g&&g.firstName?`${t.vendor.firstName} ${t.vendor.lastName||""}`.trim():(null===(v=t.agent)||void 0===v?void 0:v.name)||"Property Vendor",vendorEmail:(null===(x=t.owner)||void 0===x?void 0:x.email)||(null===(h=t.vendor)||void 0===h?void 0:h.email)||t.vendorEmail||(null===(y=t.agent)||void 0===y?void 0:y.email)||"",vendorPhone:(null===(b=t.owner)||void 0===b?void 0:b.phone)||t.vendorPhone||t.contactPhone||(null===(f=t.vendor)||void 0===f?void 0:f.phone)||(null===(N=t.agent)||void 0===N?void 0:N.phone)||"",inquiryType:r,message:j||`I'm interested in ${t.title}. Please contact me.`,status:"new",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),responses:[]};w.push(A),localStorage.setItem("inquiries",JSON.stringify(w)),window.dispatchEvent(new CustomEvent("inquiriesUpdated",{detail:{inquiry:A,action:"created"}})),window.dispatchEvent(new StorageEvent("storage",{key:"inquiries",newValue:JSON.stringify(w)}))}(t,"call",`I'm interested in ${t.title}. Please contact me via phone call.`);const a=(null===t||void 0===t||null===(r=t.agent)||void 0===r?void 0:r.phone)||(null===t||void 0===t||null===(s=t.owner)||void 0===s?void 0:s.phone)||(null===t||void 0===t?void 0:t.vendorPhone)||(null===t||void 0===t?void 0:t.contactPhone);a?(window.location.href=`tel:${a}`,d.Ay.success("Inquiry saved to My Inquiries.")):d.Ay.error("Agent phone number not available")},P=e=>{switch(e){case"available":return"bg-green-100 text-green-800";case"sold":return"bg-red-100 text-red-800";case"rented":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},A=e=>{switch(e){case"available":return"Available";case"sold":return"Sold";case"rented":return"Rented";default:return"Unknown"}},I=g.filter(e=>"all"===f||("available"===f?"available"===e.status:"sold"===f?"sold"===e.status:"rented"!==f||"rented"===e.status)).sort((e,t)=>{switch(y){case"priceHigh":const r=parseFloat(e.price)||0;return(parseFloat(t.price)||0)-r;case"priceLow":return(parseFloat(e.price)||0)-(parseFloat(t.price)||0);case"dateAdded":const s=e.dateAdded?new Date(e.dateAdded):new Date(0),a=t.dateAdded?new Date(t.dateAdded):new Date(0),o=isNaN(s.getTime())?0:s.getTime();return(isNaN(a.getTime())?0:a.getTime())-o;case"bedrooms":const i=parseInt(e.bedrooms)||0;return(parseInt(t.bedrooms)||0)-i;default:return 0}});return x?(0,c.jsx)("div",{className:"p-6",children:(0,c.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue"})})}):(0,c.jsxs)("div",{className:"p-6",children:[(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Saved Properties"}),(0,c.jsx)("p",{className:"text-gray-600",children:"Manage your saved properties and track their availability status"})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,c.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,c.jsx)(n.Mbv,{className:"text-brand-blue text-xl"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Saved"}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]})]})}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,c.jsx)(n.Ny1,{className:"text-green-600 text-xl"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Available"}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:g.filter(e=>"available"===e.status).length})]})]})}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"p-3 bg-red-100 rounded-lg",children:(0,c.jsx)(n.qbC,{className:"text-red-600 text-xl"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Sold/Rented"}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:g.filter(e=>"sold"===e.status||"rented"===e.status).length})]})]})}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"p-3 bg-orange-100 rounded-lg",children:(0,c.jsx)(n.vq8,{className:"text-brand-orange text-xl"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Locations"}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:new Set(g.map(e=>{if("string"===typeof e.location){var t;const r=e.location.split(",");return(null===(t=r[r.length>1?1:0])||void 0===t?void 0:t.trim())||e.location}return e.location||"Unknown"})).size})]})]})})]}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-4",children:(0,c.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,c.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)(n.YsJ,{className:"text-gray-500"}),(0,c.jsxs)("select",{value:f,onChange:e=>{N(e.target.value)},className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,c.jsx)("option",{value:"all",children:"All Properties"}),(0,c.jsx)("option",{value:"available",children:"Available"}),(0,c.jsx)("option",{value:"sold",children:"Sold"}),(0,c.jsx)("option",{value:"rented",children:"Rented"})]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)(n.MjW,{className:"text-gray-500"}),(0,c.jsxs)("select",{value:y,onChange:e=>{b(e.target.value)},className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,c.jsx)("option",{value:"dateAdded",children:"Date Added"}),(0,c.jsx)("option",{value:"priceHigh",children:"Price: High to Low"}),(0,c.jsx)("option",{value:"priceLow",children:"Price: Low to High"}),(0,c.jsx)("option",{value:"bedrooms",children:"Bedrooms"})]})]})]}),(0,c.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",I.length," of ",g.length," properties"]})]})}),0===I.length?(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,c.jsx)(n.Mbv,{className:"text-gray-300 text-6xl mx-auto mb-4"}),(0,c.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Saved Properties"}),(0,c.jsx)("p",{className:"text-gray-600 mb-6",children:"all"===f?"You haven't saved any properties yet. Start browsing to save your favorites!":`No ${f} properties found in your saved list.`}),(0,c.jsx)(o.N_,{to:"/properties",className:"btn-primary inline-flex items-center",children:"Browse Properties"})]}):(0,c.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map(r=>(0,c.jsxs)("div",{className:"property-card",children:[(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)(o.N_,{to:`/property/${r.id}`,className:"block cursor-pointer",children:(0,c.jsx)("img",{src:r.image,alt:r.title,className:"property-card-image"})}),(0,c.jsx)("div",{className:"absolute top-2 left-2",children:(0,c.jsx)("span",{className:`tag ${P(r.status)}`,children:A(r.status)})}),(0,c.jsxs)("div",{className:"absolute top-2 right-2 flex space-x-2 z-10",children:[(0,c.jsx)("button",{onClick:async e=>{e.stopPropagation();const t=`${window.location.origin}/property/${r.id}`;try{navigator.share?await navigator.share({title:r.title,text:r.title,url:t}):(await navigator.clipboard.writeText(t),d.Ay.success("Link copied"))}catch(e){}},className:"text-white bg-black bg-opacity-50 p-1 rounded hover:bg-opacity-70 transition-all",children:(0,c.jsx)(n.Zzu,{className:"text-sm"})}),(0,c.jsx)("button",{onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{const e=String(t),r=await p(e);r&&r.success?(setTimeout(()=>{j()},100),window.dispatchEvent(new CustomEvent("favoritesUpdated",{detail:{propertyId:e,favorited:!1}})),d.Ay.success("Property removed from saved list")):d.Ay.error("Failed to remove property")}catch(r){console.error("Error removing property:",r),d.Ay.error("Failed to remove property")}else d.Ay.error("Please register to manage saved properties")})(r.id)},className:"text-white bg-red-500 bg-opacity-80 p-1 rounded hover:bg-opacity-100 transition-all",children:(0,c.jsx)(n.qbC,{className:"text-sm"})})]})]}),(0,c.jsxs)(o.N_,{to:`/property/${r.id}`,className:"block property-card-content cursor-pointer",children:[(0,c.jsxs)("div",{className:"property-price",children:["\u20a6",(r.price||0).toLocaleString(),"rent"===r.type&&(0,c.jsx)("span",{className:"text-sm text-gray-500",children:"/month"})]}),(0,c.jsx)("h3",{className:"property-title",children:r.title}),(0,c.jsxs)("p",{className:"property-location",children:[(0,c.jsx)(n.vq8,{className:"mr-1"}),r.location]}),(0,c.jsxs)("div",{className:"property-features",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)(n.TiC,{}),(0,c.jsxs)("span",{children:[r.bedrooms," Bedrooms"]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)(n.F6e,{}),(0,c.jsxs)("span",{children:[r.bathrooms," Bathrooms"]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)(n.c7S,{}),(0,c.jsxs)("span",{children:[r.area,"m\xb2"]})]})]})]}),(0,c.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 px-4 pb-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-3",children:[(0,c.jsxs)("span",{children:["Added: ",new Date(r.dateAdded).toLocaleDateString()]}),(0,c.jsxs)("span",{children:["Agent: ",r.agent.name]})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[console.log("\ud83d\udd25 SavedProperties: Rendering buttons for property:",{id:r.id,type:r.type,status:r.status,showBuyButton:"sale"===r.type&&"available"===r.status}),"sale"===r.type&&"available"===r.status&&(0,c.jsxs)("button",{onClick:e=>{console.log("\ud83d\udd25 SavedProperties: Buy button clicked!",{property:r}),e.stopPropagation(),w(r)},className:"w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center",children:[(0,c.jsx)(n.AsH,{className:"mr-2"}),"Buy Property - \u20a6",(r.price||0).toLocaleString()]}),"rent"===r.type&&"available"===r.status&&(0,c.jsxs)("button",{onClick:e=>{e.stopPropagation(),w(r)},className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center",children:[(0,c.jsx)(n.AsH,{className:"mr-2"}),"Rent Property - \u20a6",(r.price||0).toLocaleString(),"/month"]}),"sold"===r.status&&(0,c.jsx)("div",{className:"w-full bg-red-100 text-red-800 py-2 px-4 rounded-lg text-center",children:"Property Sold"}),"rented"===r.status&&(0,c.jsx)("div",{className:"w-full bg-blue-100 text-blue-800 py-2 px-4 rounded-lg text-center",children:"Property Rented"}),(0,c.jsxs)("div",{className:"flex space-x-2",children:[(0,c.jsx)("div",{onClick:e=>{e.stopPropagation(),t(`/property/${r.id}`)},className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors text-center cursor-pointer",children:"View Details"}),(0,c.jsxs)("button",{onClick:t=>{t.stopPropagation(),(t=>{if(!e||!e.id||!e.firstName||!e.lastName||!e.email)return void d.Ay.error("User information incomplete. Please refresh and try again.");const r={id:`viewing-${Date.now()}`,propertyId:t.id,propertyTitle:t.title,propertyLocation:t.location,userId:e.id,userName:`${e.firstName} ${e.lastName}`,userEmail:e.email,status:"pending",requestedAt:(new Date).toISOString(),preferredDate:null,preferredTime:null,message:"",agentContact:t.agent||{name:"Property Agent",phone:"+234-XXX-XXXX",email:"agent@example.com"}},s=JSON.parse(localStorage.getItem("viewingRequests")||"[]");s.push(r),localStorage.setItem("viewingRequests",JSON.stringify(s)),d.Ay.success(`Viewing request sent for "${t.title}"! The agent will contact you within 24 hours.`),setTimeout(()=>{d.Ay.info(`Agent: ${r.agentContact.name} | Phone: ${r.agentContact.phone}`)},2e3)})(r)},className:"flex-1 bg-orange-100 text-orange-700 py-2 px-4 rounded-lg hover:bg-orange-200 transition-colors flex items-center justify-center",children:[(0,c.jsx)(n.itz,{className:"mr-1"}),"Schedule Viewing"]}),(0,c.jsxs)("button",{onClick:e=>{e.stopPropagation(),S(r)},className:"flex-1 bg-blue-100 text-blue-700 py-2 px-4 rounded-lg hover:bg-blue-200 transition-colors flex items-center justify-center",children:[(0,c.jsx)(n.Cab,{className:"mr-1"}),"Contact Agent"]})]})]})]})]},r.id))})]})}}}]);
//# sourceMappingURL=425.9dbb94a7.chunk.js.map