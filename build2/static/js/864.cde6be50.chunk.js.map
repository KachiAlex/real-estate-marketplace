{"version":3,"file":"static/js/864.cde6be50.chunk.js","mappings":"wOAOA,MA2aA,EA3agCA,KAAO,IAADC,EACpC,MAAM,KAAEC,IAASC,EAAAA,EAAAA,MACXC,GAAWC,EAAAA,EAAAA,OACVC,EAAUC,IAAeC,EAAAA,EAAAA,UAAS,KAClCC,EAAWC,IAAgBF,EAAAA,EAAAA,UAAS,MACrCG,GAAgBC,EAAAA,EAAAA,QAAO,CAAC,IACvBC,EAAqBC,IAA0BN,EAAAA,EAAAA,WAAS,IACxDO,EAAmBC,IAAwBR,EAAAA,EAAAA,UAAS,OACpDS,EAAgBC,IAAqBV,EAAAA,EAAAA,UAAS,KAC9CW,EAAgBC,IAAqBZ,EAAAA,EAAAA,UAAS,KAC9Ca,EAAgBC,IAAqBd,EAAAA,EAAAA,UAAS,IAW/Ce,EAAsB,SAACC,GAAyB,IAAlBC,EAAOC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC7C,IACE,KAAM,iBAAkBG,QAAS,OACD,YAA5BC,aAAaC,YAA0B,IAAID,aAAaN,EAAOC,EACrE,CAAE,MAAOO,GAAI,CACf,EAEMC,EAAaA,CAACC,EAASC,KAC3B,IAAM,OAAO,IAAIC,KAAK,GAAGF,KAAWC,OAAe,CAAE,MAAQ,OAAO,IAAM,GAGtEE,EAAiBC,IACrB,MAAMd,EAAQ,yBAAyBc,EAAEC,cACnCC,EAAQF,EAAEG,eAAiBH,EAAEI,cAAgBT,EAAWK,EAAEG,cAAeH,EAAEI,eAAiBT,EAAWK,EAAEK,cAAeL,EAAEM,eAC1HC,EAAML,EAAQ,IAAIJ,KAAKI,EAAMM,UAAY,MAAkB,KAGjE,MAAO,CAAEtB,QAAOgB,QAAOK,MAAKE,QAFZ,iBAAiBT,EAAEU,iBAAmB,KAEjBC,SADpBX,EAAEU,iBAAmB,KAIlCE,EAAiBC,IACrB,MAAMC,EAAOC,GAAMC,OAAOD,GAAGE,SAAS,EAAG,KACzC,MAAO,GAAGJ,EAAEK,mBAAmBJ,EAAID,EAAEM,cAAc,KAAKL,EAAID,EAAEO,iBAAiBN,EAAID,EAAEQ,iBAAiBP,EAAID,EAAES,uBA+BxGC,EAA+BA,KACnC,GAAS,OAAJ3D,QAAI,IAAJA,IAAAA,EAAM4D,GAAI,MAAO,GAEtB,IACE,MAAMC,EAAkBC,KAAKC,MAAMC,aAAaC,QAAQ,oBAAsB,MAQxEC,EALeL,EAAgBM,OAAOC,GAC1CA,EAAIC,SAAWrE,EAAK4D,IAAMQ,EAAIE,UAAYtE,EAAK4D,IAIhBW,IAAIH,IAAG,CACtCR,GAAIQ,EAAIR,GAERvB,YAAa+B,EAAII,eAAiBJ,EAAI/B,aAAe+B,EAAI9C,OAAS,WAClEwB,gBAAiBsB,EAAIK,kBAAoBL,EAAItB,iBAAmBsB,EAAIrB,UAAY,GAEhFN,cAAe2B,EAAI3B,cACnBC,cAAe0B,EAAI1B,cACnBH,cAAe6B,EAAI7B,cACnBC,cAAe4B,EAAI5B,cACnBkC,aAAcN,EAAIM,aAClBC,aAAcP,EAAIO,aAClBC,OAAQR,EAAIQ,QAAU,iBACtBC,UAAWT,EAAIU,aAAeV,EAAIS,YAAa,IAAI3C,MAAO6C,iBAEvDX,KAUL,OANAF,EAAYc,KAAK,CAACC,EAAGC,KACnB,MAAMC,EAAQ,IAAIjD,KAAK+C,EAAEJ,WAAa,GAEtC,OADc,IAAI3C,KAAKgD,EAAEL,WAAa,GACvBM,IAGVjB,CACT,CAAE,MAAOkB,GAEP,OADAC,QAAQD,MAAM,4CAA6CA,GACpD,EACT,GAIIE,EAAkBC,IACtBlF,EAAYkF,GA5GuBC,WACnC,IACE,KAAM,iBAAkB7D,QAAS,OACD,YAA5BC,aAAaC,kBACTD,aAAa6D,mBAEvB,CAAE,MAAO3D,GAAI,GAuGb4D,GACA,MAAMC,EAAOlF,EAAcmF,SAAW,CAAC,EACvC,IAAK,MAAMxD,KAAKmD,EAAa,CAC3B,MAAMM,EAAWF,EAAKvD,EAAEwB,IACpBiC,GAAYA,IAAazD,EAAEwC,SACZ,aAAbxC,EAAEwC,OACJvD,EAAoB,uBAAwB,CAAEyE,KAAM,GAAG1D,EAAEC,kBAAkBD,EAAEG,iBAAiBH,EAAEI,kBAC1E,sBAAbJ,EAAEwC,OACXvD,EAAoB,6BAA8B,CAAEyE,KAAM,GAAG1D,EAAEC,gBAAgBD,EAAEsC,gBAAgBtC,EAAEuC,iBAC7E,aAAbvC,EAAEwC,OACXvD,EAAoB,sBAAuB,CAAEyE,KAAM,GAAG1D,EAAEC,gBAClC,wBAAbD,EAAEwC,SACXvD,EAAoB,8BAA+B,CAAEyE,KAAM,GAAG1D,EAAEC,wCAChE0D,EAAAA,GAAMX,MAAM,mCAAmChD,EAAEC,gBAGvD,CACA5B,EAAcmF,QAAUI,OAAOC,YAAYV,EAAYhB,IAAI2B,GAAK,CAACA,EAAEtC,GAAIsC,EAAEtB,UACrE5E,GAAQA,EAAK4D,IACfpD,GAAa2F,EAAAA,EAAAA,IAAuB,CAAEC,KAAM,QAAS/B,OAAQrE,EAAK4D,QAItEyC,EAAAA,EAAAA,WAAU,KACR,GAAS,OAAJrG,QAAI,IAAJA,IAAAA,EAAM4D,GAET,YADAvD,EAAY,IAKd,MAAMiG,EAAgB3C,IACtB2B,EAAegB,GAGf,MAAMC,EAAeC,YAAY,KAC/B,MAAMC,EAAkB9C,IACxB2B,EAAemB,IACd,KAGGC,EAAuBA,KAC3B,MAAMD,EAAkB9C,IACxB2B,EAAemB,IAGXE,EAAyBC,IAC7B,GAAS,OAAJ5G,QAAI,IAAJA,IAAAA,EAAM4D,GAAI,OACf,MAAMiD,EAASD,EAAMC,QAAUD,EAC/B,GAAU,OAANC,QAAM,IAANA,GAAAA,EAAQvC,SAAWuC,EAAOvC,UAAYtE,EAAK4D,GAAI,OACnD,MAAMkD,GAAOX,EAAAA,EAAAA,IAAuB,CAAEC,KAAM,QAAS/B,OAAQrE,EAAK4D,KAClEpD,EAAasG,IAWf,OARAnF,OAAOoF,iBAAiB,kBAAmBL,GAC3C/E,OAAOoF,iBAAiB,6BAA8BJ,GACtDhF,OAAOoF,iBAAiB,UAAYjF,IACpB,oBAAVA,EAAEkF,KACJN,MAIG,KACLO,cAAcV,GACd5E,OAAOuF,oBAAoB,kBAAmBR,GAC9C/E,OAAOuF,oBAAoB,6BAA8BP,KAE1D,CAAK,OAAJ3G,QAAI,IAAJA,OAAI,EAAJA,EAAM4D,MAEVyC,EAAAA,EAAAA,WAAU,KACC,OAAJrG,QAAI,IAAJA,GAAAA,EAAM4D,GAIXpD,GAAa2F,EAAAA,EAAAA,IAAuB,CAAEC,KAAM,QAAS/B,OAAQrE,EAAK4D,MAHhEpD,EAAa,OAId,CAAK,OAAJR,QAAI,IAAJA,OAAI,EAAJA,EAAM4D,KAuEV,OACEuD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,MAAKC,SAAA,EAClBF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,OAAMC,SAAA,EACnBC,EAAAA,EAAAA,KAAA,MAAIF,UAAU,mCAAkCC,SAAC,4BACjDC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,gBAAeC,SAAC,6CAG9B9G,IACC4G,EAAAA,EAAAA,MAAA,OAAKC,UAAU,iBAAgBC,SAAA,EAC7BF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,uDAAsDC,SAAA,EACnEF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,mDAAkDC,SAAA,EAC/DC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,wBAAuBC,SAAC,uBACrCC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,uCAAsCC,SAAE9G,EAAUgH,uBAEjEJ,EAAAA,EAAAA,MAAA,OAAKC,UAAU,qDAAoDC,SAAA,EACjEC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,yBAAwBC,SAAC,eACtCC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,wCAAuCC,SAAE9G,EAAUiH,gBAElEL,EAAAA,EAAAA,MAAA,OAAKC,UAAU,uDAAsDC,SAAA,EACnEC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,0BAAyBC,SAAC,wBACvCC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,yCAAwCC,SAAE9G,EAAUkH,sBAEnEN,EAAAA,EAAAA,MAAA,OAAKC,UAAU,iDAAgDC,SAAA,EAC7DC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,uBAAsBC,SAAC,0BACpCC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,sCAAqCC,SAAE9G,EAAUmH,2BAI/C,QAAlB3H,EAAAQ,EAAUoH,gBAAQ,IAAA5H,OAAA,EAAlBA,EAAoB0B,QAAS,IAC5B0F,EAAAA,EAAAA,MAAA,OAAKC,UAAU,4DAA2DC,SAAA,EACxEF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,yCAAwCC,SAAA,EACrDC,EAAAA,EAAAA,KAAA,MAAIF,UAAU,sCAAqCC,SAAC,0BACpDF,EAAAA,EAAAA,MAAA,QAAMC,UAAU,wBAAuBC,SAAA,CAAE9G,EAAUqH,cAAc,yBAEnEN,EAAAA,EAAAA,KAAA,OAAKF,UAAU,qCAAoCC,SAChD9G,EAAUoH,SAASpD,IAAKsD,IACvBV,EAAAA,EAAAA,MAAA,OAAqBC,UAAU,kCAAiCC,SAAA,EAC9DC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,wBAAuBC,SAAE,IAAInF,KAAK2F,EAAKC,MAAMC,wBAC1DT,EAAAA,EAAAA,KAAA,KAAGF,UAAU,sCAAqCC,SAAEQ,EAAKG,UAFjDH,EAAKC,gBAW3BX,EAAAA,EAAAA,MAAA,OAAKC,UAAU,6BAA4BC,SAAA,EACzCF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,qDAAoDC,SAAA,CAAEjH,EAASqB,OAAO,kBACrF0F,EAAAA,EAAAA,MAAA,OAAKC,UAAU,WAAUC,SAAA,CACF,IAApBjH,EAASqB,SACR6F,EAAAA,EAAAA,KAAA,OAAKF,UAAU,4BAA2BC,SAAC,gCAE5CjH,EAASmE,IAAKnC,IAAC,IAAA6F,EAAA,OACdd,EAAAA,EAAAA,MAAA,OAAgBC,UAAU,gCAA+BC,SAAA,EACvDF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,QAAOC,SAAA,EACpBC,EAAAA,EAAAA,KAAA,OAAKF,UAAU,4BAA2BC,SAAEjF,EAAEC,eAC9CiF,EAAAA,EAAAA,KAAA,OAAKF,UAAU,gBAAeC,SAAEjF,EAAEU,sBAEpCqE,EAAAA,EAAAA,MAAA,OAAKC,UAAU,QAAOC,SAAA,EACpBF,EAAAA,EAAAA,MAAA,OAAAE,SAAA,CAAK,cAAYjF,EAAEK,cAAc,IAAEL,EAAEM,iBACpCN,EAAEsC,cAAgBtC,EAAEuC,eACnBwC,EAAAA,EAAAA,MAAA,OAAKC,UAAU,wBAAuBC,SAAA,CAAC,oBAAkBjF,EAAEsC,aAAa,IAAEtC,EAAEuC,oBAGhF2C,EAAAA,EAAAA,KAAA,OAAKF,UAAU,QAAOC,UACpBC,EAAAA,EAAAA,KAAA,QAAMF,UAAW,mCACF,mBAAbhF,EAAEwC,OAA8B,gCACnB,aAAbxC,EAAEwC,OAAwB,8BACb,sBAAbxC,EAAEwC,OAAiC,4BACtB,gCAAbxC,EAAEwC,OAA2C,gCAC7C,2BACCyC,UACQ,QAARY,EAAA7F,EAAEwC,cAAM,IAAAqD,OAAA,EAARA,EAAUC,WAAW,IAAI,OAAQ,eAGtCf,EAAAA,EAAAA,MAAA,OAAKC,UAAU,0CAAyCC,SAAA,EAEtDC,EAAAA,EAAAA,KAAA,UACEa,QAASA,IA1FGC,KAE1B,MAAMC,EAAaD,EAAQC,YAAcD,EAAQE,UAE7CD,EACFnI,EAAS,aAAamI,KAEtBtC,EAAAA,GAAMX,MAAM,uCAmFemD,CAAmBnG,GAClCgF,UAAU,mFACV9F,MAAM,wBAAuB+F,UAE7BC,EAAAA,EAAAA,KAACkB,EAAAA,IAAK,CAACpB,UAAU,cAGL,sBAAbhF,EAAEwC,SACDuC,EAAAA,EAAAA,MAAAsB,EAAAA,SAAA,CAAApB,SAAA,EACEC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IA7JZ3C,WACrB,IAAKpD,EAAEsC,eAAiBtC,EAAEuC,aAExB,YADAoB,EAAAA,GAAMX,MAAM,sCAGGsD,EAAAA,EAAAA,IAAwBtG,EAAEwB,GAAI,CAC7CgB,OAAQ,WACRrC,cAAeH,EAAEsC,aACjBlC,cAAeJ,EAAEuC,eAEXoB,EAAAA,GAAM4C,QAAQ,qBAA2B5C,EAAAA,GAAMX,MAAM,qBAmJtBwD,CAAexG,GAAIgF,UAAU,4CAA2CC,SAAC,qBAChGC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IAjJX3C,iBACLkD,EAAAA,EAAAA,IAAwBtG,EAAEwB,GAAI,CAAEgB,OAAQ,aACjDmB,EAAAA,GAAM4C,QAAQ,qBAA2B5C,EAAAA,GAAMX,MAAM,sBA+ItByD,CAAgBzG,GAAIgF,UAAU,0CAAyCC,SAAC,eAGrF,aAAbjF,EAAEwC,SACDuC,EAAAA,EAAAA,MAAAsB,EAAAA,SAAA,CAAApB,SAAA,EACEC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IA3SP/F,KAC1B,MAAM,MAAEd,EAAK,MAAEgB,EAAK,IAAEK,EAAG,QAAEE,EAAO,SAAEE,GAAaZ,EAAcC,GAC/D,IAAKE,IAAUK,EAAO,OACtB,MAAMmG,EAAO7F,GAAM,GAAGA,EAAEK,mBAAmBF,OAAOH,EAAEM,cAAc,GAAGF,SAAS,EAAE,OAAOD,OAAOH,EAAEO,cAAcH,SAAS,EAAE,QAAQD,OAAOH,EAAEQ,eAAeJ,SAAS,EAAE,OAAOD,OAAOH,EAAES,iBAAiBL,SAAS,EAAE,UAK1M0F,EAAM,+DAJCC,mBAAmB1H,YACfwH,EAAIxG,MAAUwG,EAAInG,cAChBqG,mBAAmBnG,eAClBmG,mBAAmBjG,KAEvCpB,OAAOsH,KAAKF,EAAK,WAkSsBG,CAAmB9G,GAAIgF,UAAU,2CAA0CC,SAAC,qBACnGC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IA3Td/F,KACnB,MAAM,MAAEd,EAAK,MAAEgB,EAAK,IAAEK,EAAG,QAAEE,EAAO,SAAEE,GAAaZ,EAAcC,GAC/D,IAAKE,IAAUK,EAAO,OACtB,MAAMwG,EAAM,CACV,kBAAkB,cAAc,wCAAwC,eACxE,OAAO/G,EAAEwB,iBAAiB,WAAWZ,EAAc,IAAId,QACvD,WAAWc,EAAcV,KAAS,SAASU,EAAcL,KACzD,WAAWrB,IAAQ,eAAeuB,IAAU,YAAYE,IAAW,aAAa,iBAChFqG,KAAK,QACDC,EAAO,IAAIC,KAAK,CAACH,GAAM,CAAEI,KAAM,gCAC/BR,EAAMS,IAAIC,gBAAgBJ,GAC1BpE,EAAIyE,SAASC,cAAc,KACjC1E,EAAE2E,KAAOb,EAAK9D,EAAE4E,SAAW,cAAczH,EAAEwB,SAAU8F,SAAS5D,KAAKgE,YAAY7E,GAAIA,EAAE8E,QAASL,SAAS5D,KAAKkE,YAAY/E,GAAIuE,IAAIS,gBAAgBlB,IA+SzGmB,CAAY9H,GAAIgF,UAAU,2BAA0BC,SAAC,qBAGlE,uBAAbjF,EAAEwC,QAAgD,aAAbxC,EAAEwC,SACtCuC,EAAAA,EAAAA,MAAAsB,EAAAA,SAAA,CAAApB,SAAA,EACEC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IAhJX/F,KACtBtB,EAAqBsB,GACrBpB,EAAkBoB,EAAEK,eAAiB,IACrCvB,EAAkBkB,EAAEM,eAAiB,IACrCtB,EAAkB,IAClBR,GAAuB,IA2IgBuJ,CAAe/H,GAAIgF,UAAU,2CAA0CC,SAAC,gBAC/FC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IAxJP3C,WAE1B,IADgB7D,OAAOyI,QAAQ,6DACjB,aACG1B,EAAAA,EAAAA,IAAwBtG,EAAEwB,GAAI,CAAEgB,OAAQ,qBAAsByF,aAAa,IAAInI,MAAO6C,gBAC/FgB,EAAAA,GAAM4C,QAAQ,wBAA8B5C,EAAAA,GAAMX,MAAM,qBAoJzBkF,CAAoBlI,GAAIgF,UAAU,kEAAiEC,SAAC,mBA/CzHjF,EAAEwB,YAwDjBjD,GAAuBE,IACtByG,EAAAA,EAAAA,KAAA,OAAKF,UAAU,iFAAgFC,UAC7FF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,0CAAyCC,SAAA,EACtDF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,wCAAuCC,SAAA,EACpDF,EAAAA,EAAAA,MAAA,OAAAE,SAAA,EACEC,EAAAA,EAAAA,KAAA,MAAIF,UAAU,kCAAiCC,SAAC,2BAChDC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,wBAAuBC,SAAExG,EAAkBwB,kBAE1DiF,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IAAMvH,GAAuB,GAAQwG,UAAU,oCAAmCC,SAAC,aAEtGF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,YAAWC,SAAA,EACxBF,EAAAA,EAAAA,MAAA,OAAAE,SAAA,EACEC,EAAAA,EAAAA,KAAA,SAAOF,UAAU,+CAA8CC,SAAC,cAChEC,EAAAA,EAAAA,KAAA,SACEiC,KAAK,OACLgB,MAAOxJ,EACPyJ,SAAW1I,GAAMd,EAAkBc,EAAE2I,OAAOF,OAC5CnD,UAAU,+GAGdD,EAAAA,EAAAA,MAAA,OAAAE,SAAA,EACEC,EAAAA,EAAAA,KAAA,SAAOF,UAAU,+CAA8CC,SAAC,cAChEC,EAAAA,EAAAA,KAAA,SACEiC,KAAK,OACLgB,MAAOtJ,EACPuJ,SAAW1I,GAAMZ,EAAkBY,EAAE2I,OAAOF,OAC5CnD,UAAU,+GAGdD,EAAAA,EAAAA,MAAA,OAAAE,SAAA,EACEC,EAAAA,EAAAA,KAAA,SAAOF,UAAU,+CAA8CC,SAAC,kCAChEC,EAAAA,EAAAA,KAAA,YACEiD,MAAOpJ,EACPqJ,SAAW1I,GAAMV,EAAkBU,EAAE2I,OAAOF,OAC5CG,KAAM,EACNtD,UAAU,yGACVuD,YAAY,0CAIlBxD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,4BAA2BC,SAAA,EACxCC,EAAAA,EAAAA,KAAA,UAAQa,QAASA,IAAMvH,GAAuB,GAAQwG,UAAU,8BAA6BC,SAAC,WAC9FC,EAAAA,EAAAA,KAAA,UAAQa,QA5LK3C,UACvB,IAAK3E,IAAsBE,IAAmBE,EAE5C,YADA8E,EAAAA,GAAMX,MAAM,uCAGGsD,EAAAA,EAAAA,IAAwB7H,EAAkB+C,GAAI,CAC7DgB,OAAQ,oBACRnC,cAAe1B,EACf2B,cAAezB,EACf2J,aAAczJ,GAAkB,GAChCuD,aAAc,KACdC,aAAc,QAGdoB,EAAAA,GAAM4C,QAAQ,qCACd/H,GAAuB,GACvBE,EAAqB,MACrBE,EAAkB,IAClBE,EAAkB,IAClBE,EAAkB,KAElB2E,EAAAA,GAAMX,MAAM,yBAuK+BgC,UAAU,gEAA+DC,SAAC,2B,4ECva3H,MACMwD,EAAuB,kBACvBC,EAA0B,wBAI1BC,EAAmB,CACvBnD,cAAe,EACfL,iBAAkB,EAClBC,UAAW,EACXC,gBAAiB,EACjBuD,iBAAkB,EAClBC,iBAAkB,EAClBvD,kBAAmB,EACnBC,SAAU,IAGNuD,EAAqBA,CAACC,EAAWtE,KACrC,GAAsB,qBAAXlF,OACX,GAAkB,YAAdwJ,EAQgC,oBAAzBxJ,OAAOyJ,eAChBzJ,OAAOyJ,cAAc,IAAIC,YAAYF,EAAW,CAAEtE,iBARlD,IACElF,OAAOyJ,cAAc,IAAIE,aAAa,UAAWzE,GACnD,CAAE,MACAlF,OAAOyJ,cAAc,IAAIC,YAAY,UAAW,CAAExE,WACpD,GAQE0E,EAAoBA,KACxB,IACE,OAAOzH,KAAKC,MAAMC,aAAaC,QAAQ4G,IAAyB,KAClE,CAAE,MACA,MAAO,EACT,GAGIW,EAAsBpL,IAC1B4D,aAAayH,QAAQZ,EAAsB/G,KAAK4H,UAAUtL,KAGtDuL,EAAiBA,KACrB,IACE,OAAO7H,KAAKC,MAAMC,aAAaC,QAAQ6G,IAA4B,KACrE,CAAE,MACA,MAAO,EACT,GAkBIc,EAAsBA,CAAC9D,EAAM+D,IAC5B/D,GAAS+D,EACTA,EACA/D,EACE,GAAGA,KAAQ+D,IADAA,EADA/D,EADS,GAwGvBgE,EAAwBA,CAACC,EAAQ3D,KACrC,IAAK2D,IAAW3D,EAAS,OACzB,MAAM4D,EAtHqBC,EAACF,EAAQ3D,KAAO,CAC3C2D,SACAG,UAAW9D,EAAQxE,GACnBY,cAAe4D,EAAQ5D,eAAiB4D,EAAQ+D,cAAgB/D,EAAQ/F,aAAe+F,EAAQ9G,OAAS,WACxGgD,QAAS8D,EAAQ9D,SAAW8D,EAAQ/D,OACpC+H,SAAUhE,EAAQgE,SAClBC,YAAajE,EAAQiE,YACrBzH,OAAQwD,EAAQxD,OAChB0H,WAAW,IAAIpK,MAAO6C,gBA8GNkH,CAAqBF,EAAQ3D,GACvCmE,EAAMZ,IACZY,EAAIC,QAAQR,GACRO,EAAI9K,OAAS,KACf8K,EAAIE,MA9HiBF,KACvBvI,aAAayH,QAAQX,EAAyBhH,KAAK4H,UAAUa,KA+H7DG,CAAgBH,GAChBrB,EAjLqB,qBAiLcc,GACnCd,EAnLsB,6BAmLcc,GACpC,MAAMW,EA7GmCC,EAACb,EAAQ3D,EAAS4D,KAC3D,MAAMa,EAAU,GACVrI,EAAgBwH,EAAQxH,cACxBsI,EAAY1E,EAAQ0E,WAAa1E,EAAQ2E,UAAY,QACrDC,EAAa5E,EAAQ4E,YAAc5E,EAAQ6E,QAAU7E,EAAQ8E,OAAS,SACtEC,EAAiBvB,EAAoBxD,EAAQ3F,cAAe2F,EAAQ1F,eACpE0K,EAAiBxB,EAAoBxD,EAAQ7F,cAAe6F,EAAQ5F,eACpE6K,EAAgBzB,EAAoBxD,EAAQ1D,aAAc0D,EAAQzD,cAElE2I,EAAgBA,CAAChM,EAAOiM,MACxBnF,EAAQgE,UAAYhE,EAAQiE,cAC9BQ,EAAQW,KAAK,CACXC,YAAarF,EAAQgE,SACrBsB,eAAgBtF,EAAQiE,YACxBsB,MAAO,CAAC,UACRpE,KAAMwC,EACNzK,QACAiM,UACAK,SAAU,SACVC,SAAU,CAAE3B,UAAW9D,EAAQxE,GAAIY,gBAAesI,YAAWE,iBAK7Dc,EAAeA,CAACxM,EAAOiM,MACvBnF,EAAQ9D,SAAW8D,EAAQ/D,QAAU+D,EAAQ2F,YAAc3F,EAAQ4F,YACrEnB,EAAQW,KAAK,CACXC,YAAarF,EAAQ9D,SAAW8D,EAAQ/D,OACxCqJ,eAAgBtF,EAAQ2F,YAAc3F,EAAQ4F,UAC9CL,MAAO,CAAC,SACRpE,KAAMwC,EACNzK,QACAiM,UACAK,SAAU,SACVC,SAAU,CAAE3B,UAAW9D,EAAQxE,GAAIY,gBAAesI,YAAWE,iBAKnE,OAAQjB,GACN,IAAK,uBACHuB,EAAc,yBAA0B,GAAGR,uBAA+BtI,KAAiB2I,EAAiB,MAAMA,IAAmB,KAAKc,QAC1I,MACF,IAAK,uBACHH,EAAa,uBAAwB,GAAGd,eAAwBxI,KAAiB4I,EAAiB,OAAOA,IAAmB,KAAKa,QACjI,MACF,IAAK,2BACHH,EAAa,2BAA4B,GAAGd,eAAwBK,GAAiB,sBAAsB7I,KAC3G,MACF,IAAK,oBACH8I,EAAc,2BAA4B,GAAGR,iBAAyBtI,KAAiB2I,EAAiB,MAAMA,IAAmB,KAAKc,QACtI,MACF,IAAK,gCACHX,EAAc,gCAAiC,GAAGR,eAAuBtI,KACzE,MACF,IAAK,iCACHsJ,EAAa,iCAAkC,GAAGd,eAAwBxI,KAC1E,MACF,IAAK,sBACHsJ,EAAa,sBAAuB,GAAGd,8BAAuCxI,KAMlF,OAAOqI,GA4CeD,CAAmCb,EAAQ3D,EAAS4D,GACtEW,EAAclL,SAChByJ,EAAmB,yBAA0B,CAAEa,SAAQC,UAASW,gBAAevE,YA3C5C,WAAmB,IAAlByE,EAAOrL,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GAChD,IAAKqL,EAAQpL,QAA4B,qBAAXE,OAAwB,OACtD,MAAMuM,EAAWrB,EACd1I,OAAQgK,GAAUA,EAAMV,aACxBlJ,IAAK4J,IAAK,IAAAC,EAAA,MAAM,CACfX,YAAaU,EAAMV,YACnBlE,KAAM4E,EAAM5E,KACZjI,MAAO6M,EAAM7M,MACbiM,QAASY,EAAMZ,QACfK,SAAUO,EAAMP,UAAY,SAC5BC,SAAU,IACJM,EAAMN,UAAY,CAAC,EACvBQ,QAAsB,QAAdD,EAAAD,EAAMN,gBAAQ,IAAAO,OAAA,EAAdA,EAAgBC,SAAU,0BAEpCvH,KAAMqH,EAAMN,UAAY,CAAC,KAGxBK,EAASzM,QAEd6M,EAAAA,EAAoBC,8BAA8BL,GAC/CM,KAAMC,IACM,OAANA,QAAM,IAANA,GAAAA,EAAQ9F,SACXtD,QAAQqJ,KAAK,6CAA8CD,KAG9DE,MAAOvJ,IACNC,QAAQD,MAAM,6CAA8CA,IAElE,CAgBIwJ,CAA+BjC,KAI7BkC,EAAyB,SAAChJ,EAAUiJ,GAAwB,IAAlBC,EAAOvN,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EACzD,MAAMoD,IAAc,OAAJkK,QAAI,IAAJA,OAAI,EAAJA,EAAMlK,SAAUmK,EAAQnK,QAAU,IAAIoK,cACtD,IAAKpK,IAAWmK,EAAQrK,cAAgBqK,EAAQpK,cAC9C,MAAO,2BAET,OAAQC,GACN,IAAK,WACL,IAAK,YACH,MAAO,uBACT,IAAK,oBACH,MAAO,2BACT,IAAK,oBACH,MAAO,oBACT,IAAK,qBACH,MAAO,gCACT,IAAK,sBACH,MAAO,iCACT,IAAK,WACH,MAAO,sBACT,QACE,OAAIiB,GAAYA,EAASjB,UAAe,OAAJkK,QAAI,IAAJA,OAAI,EAAJA,EAAMlK,QACjC,sBAAyB,OAAJkK,QAAI,IAAJA,OAAI,EAAJA,EAAMlK,SAAU,YAEvC,KAEb,EAYMqK,EAAgBA,CAAC7G,EAASgE,EAAUC,OACnCD,IAAaC,KACVD,IAAmB,OAAPhE,QAAO,IAAPA,OAAO,EAAPA,EAASgE,YAAaA,GAAcC,IAAsB,OAAPjE,QAAO,IAAPA,OAAO,EAAPA,EAASiE,eAAgBA,GAGrFlG,EAAyB,WAA6D,IAA5D,KAAEC,EAAO,QAAO,OAAE/B,EAAM,SAAE+H,EAAQ,YAAEC,GAAa7K,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC1F,GAAsB,qBAAXG,OAAwB,MAAO,IAAKoJ,GAC/C,GAAa,UAAT3E,IAAqB/B,EAAQ,MAAO,IAAK0G,GAC7C,GAAa,WAAT3E,IAAsBgG,IAAaC,EAAa,MAAO,IAAKtB,GAEhE,MACMmE,EADW3D,IACSpH,OAAQC,IAChCgC,MAAS,UAATA,GAjBkBgC,EAiBchE,KAjBLE,EAiBUD,MAfzB,OAAP+D,QAAO,IAAPA,OAAO,EAAPA,EAAS9D,WAAYA,IAAkB,OAAP8D,QAAO,IAAPA,OAAO,EAAPA,EAAS/D,UAAWC,IAeV2K,EAAc7K,EAAKgI,GAAYhI,EAAIgI,SAAUC,GAjB3E8C,IAAC/G,EAAS9D,IAoBvB/D,EAAY,CAChBqH,cAAesH,EAASzN,OACxB8F,iBAAkB,EAClBC,UAAW,EACXC,gBAAiB,EACjBuD,iBAAkB,EAClBC,iBAAkB,EAClBvD,kBAAmB,EACnBC,SAAU,IAGNyH,EAAkB,CAAC,UAAW,iBAAkB,+BAChD7C,EAAMZ,IAIZuD,EAASG,QAASjL,IAChB,MAAMQ,GAAUR,EAAIQ,QAAU,IAAIoK,cAC9BI,EAAgBE,SAAS1K,KAC3BrE,EAAUgH,kBAAoB,GAE5B,CAAC,WAAY,aAAa+H,SAAS1K,KACrCrE,EAAUiH,WAAa,GAEV,sBAAX5C,IACFrE,EAAUkH,iBAAmB,GAEhB,sBAAX7C,IACFrE,EAAUyK,kBAAoB,GAEjB,uBAAXpG,IACFrE,EAAU0K,kBAAoB,GAE5B,CAAC,sBAAuB,YAAYqE,SAAS1K,KAC/CrE,EAAUmH,mBAAqB,KAInC,MAAM6H,EAAgBC,MAAMC,KAAK,CAAEhO,OAAQ,IAAK8C,IAAI,CAACmL,EAAGC,KACtD,MAAM7H,EAAO,IAAI5F,KACjB4F,EAAK8H,QAAQ9H,EAAK+H,WAAa,EAAIF,IACnC,MAAMG,EAAUhI,EAAK/C,cAAcgL,MAAM,EAAG,IACtCC,EAAazD,EAAIpI,OAAQgK,IAAU8B,MA7BnB9B,IACb,UAAT/H,GAAwB,OAAL+H,QAAK,IAALA,OAAK,EAALA,EAAO7J,WAAYD,EAAS4K,EAAcd,EAAO/B,EAAUC,GA4BrC4D,CAAe9B,MAnExC+B,EAmE6D/B,EAAM7B,WAlE9D,IAAIpK,KAAKgO,GAAW,IAAIhO,MACnC6C,cAAcgL,MAAM,EAAG,MAiEiED,EAnElFI,QAmE2FzO,OAC3G,MAAO,CAAEqG,KAAMgI,EAAS9H,MAAOgI,KAIjC,OADAzP,EAAUoH,SAAW4H,EACdhP,CACT,EAEa4P,EAA0B3K,UACrC,IAEEH,QAAQkH,IAAI,yEAGZ,MAAM6D,EAAW7E,IACX8E,EAAa,CACjBzM,GAAI,WAAW1B,KAAKoO,WACjBC,EACH1L,WAAW,IAAI3C,MAAO6C,cACtBH,OAAQ,WAkBV,OAhBAwL,EAAS5C,KAAK6C,GACd7E,EAAmB4E,GAGnBlF,EAAmB,kBAAmB,CACpCsF,eAAgBH,EAChBtE,OAAQ,YAIVb,EAAmB,UAAW,CAC5BlE,IAAK6D,EACL4F,SAAU3M,KAAK4H,UAAU0E,KAE3BtE,EAAsB,uBAAwBuE,GAEvCA,CACT,CAAE,MAAOjL,GACPC,QAAQD,MAAM,qCAAsCA,GAEpD,MAAMgL,EAAW7E,IACX8E,EAAa,CACjBzM,GAAI,WAAW1B,KAAKoO,WACjBC,EACH1L,WAAW,IAAI3C,MAAO6C,cACtBH,OAAQ,WAkBV,OAhBAwL,EAAS5C,KAAK6C,GACd7E,EAAmB4E,GAGnBlF,EAAmB,kBAAmB,CACpCsF,eAAgBH,EAChBtE,OAAQ,YAIVb,EAAmB,UAAW,CAC5BlE,IAAK6D,EACL4F,SAAU3M,KAAK4H,UAAU0E,KAE3BtE,EAAsB,uBAAwBuE,GAEvCA,CACT,GAGWK,EAAiClL,MAAO4G,EAAUC,KAC7D,IAEEhH,QAAQkH,IAAI,gEAGZ,MAGMoE,EAHQpF,IAGSpH,OAAQ/B,GAC5BgK,GAAYhK,EAAEgK,WAAaA,GAC3BC,GAAejK,EAAEiK,cAAgBA,GAMpC,OAFAsE,EAAS3L,KAAK,CAACC,EAAGC,IAAM,IAAIhD,KAAKgD,EAAEL,WAAa,GAAK,IAAI3C,KAAK+C,EAAEJ,WAAa,IAEtE8L,CACT,CAAE,MAAOvL,GACPC,QAAQD,MAAM,qCAAsCA,GAOpD,OALcmG,IACSpH,OAAQ/B,GAC5BgK,GAAYhK,EAAEgK,WAAaA,GAC3BC,GAAejK,EAAEiK,cAAgBA,GAEpBrH,KAAK,CAACC,EAAGC,IAAM,IAAIhD,KAAKgD,EAAEL,WAAa,GAAK,IAAI3C,KAAK+C,EAAEJ,WAAa,GACtF,GAkBW6D,EAA0BlD,MAAO0G,EAAW6C,KACvD,IAEE1J,QAAQkH,IAAI,yEAGZ,MAAMqE,EAAMrF,IACZ,IAAIsF,EAAa,KACjB,MAAMC,EAAUF,EAAIrM,IAAKnC,GACnBA,EAAEwB,KAAOsI,GACX2E,EAAa,IAAKzO,KAAM2M,EAASgC,WAAW,IAAI7O,MAAO6C,eAChD8L,GAEFzO,GAET,IAAKyO,EAEH,OADArF,EAAmBoF,IACZ,EAETpF,EAAmBsF,GAGnB5F,EAAmB,kBAAmB,CACpCgB,YACA6C,UACAhD,OAAQ,YAIVb,EAAmB,UAAW,CAC5BlE,IAAK6D,EACL4F,SAAU3M,KAAK4H,UAAUoF,KAE3B,MAAM/E,EAAS8C,EAAuB+B,EAAII,KAAM5O,GAAMA,EAAEwB,KAAOsI,GAAY2E,EAAY9B,GAKvF,OAJIhD,GACFD,EAAsBC,EAAQ8E,IAGzB,CACT,CAAE,MAAOzL,GACPC,QAAQD,MAAM,qCAAsCA,GAEpD,MAAMwL,EAAMrF,IACZ,IAAIsF,EAAa,KACjB,MAAMC,EAAUF,EAAIrM,IAAKnC,GACnBA,EAAEwB,KAAOsI,GACX2E,EAAa,IAAKzO,KAAM2M,EAASgC,WAAW,IAAI7O,MAAO6C,eAChD8L,GAEFzO,GAET,IAAKyO,EAEH,OADArF,EAAmBoF,IACZ,EAETpF,EAAmBsF,GAGnB5F,EAAmB,kBAAmB,CACpCgB,YACA6C,UACAhD,OAAQ,YAIVb,EAAmB,UAAW,CAC5BlE,IAAK6D,EACL4F,SAAU3M,KAAK4H,UAAUoF,KAE3B,MAAM/E,EAAS8C,EAAuB+B,EAAII,KAAM5O,GAAMA,EAAEwB,KAAOsI,GAAY2E,EAAY9B,GAKvF,OAJIhD,GACFD,EAAsBC,EAAQ8E,IAGzB,CACT,E","sources":["pages/BuyerInspectionRequests.js","services/inspectionService.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { updateInspectionRequest, getInspectionAnalytics, listInspectionRequestsByBuyer } from '../services/inspectionService';\r\nimport { FaEye } from 'react-icons/fa';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst BuyerInspectionRequests = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [requests, setRequests] = useState([]);\r\n  const [analytics, setAnalytics] = useState(null);\r\n  const prevStatusRef = useRef({});\r\n  const [showRescheduleModal, setShowRescheduleModal] = useState(false);\r\n  const [rescheduleRequest, setRescheduleRequest] = useState(null);\r\n  const [rescheduleDate, setRescheduleDate] = useState('');\r\n  const [rescheduleTime, setRescheduleTime] = useState('');\r\n  const [rescheduleNote, setRescheduleNote] = useState('');\r\n\r\n  const ensureNotificationPermission = async () => {\r\n    try {\r\n      if (!('Notification' in window)) return;\r\n      if (Notification.permission === 'default') {\r\n        await Notification.requestPermission();\r\n      }\r\n    } catch (e) {}\r\n  };\r\n\r\n  const showWebNotification = (title, options = {}) => {\r\n    try {\r\n      if (!('Notification' in window)) return;\r\n      if (Notification.permission === 'granted') new Notification(title, options);\r\n    } catch (e) {}\r\n  };\r\n\r\n  const toDateTime = (dateStr, timeStr) => {\r\n    try { return new Date(`${dateStr}T${timeStr}:00`); } catch { return null; }\r\n  };\r\n\r\n  const buildCalendar = (r) => {\r\n    const title = `Property Inspection - ${r.projectName}`;\r\n    const start = r.confirmedDate && r.confirmedTime ? toDateTime(r.confirmedDate, r.confirmedTime) : toDateTime(r.preferredDate, r.preferredTime);\r\n    const end = start ? new Date(start.getTime() + 60 * 60 * 1000) : null; // 1 hour\r\n    const details = `Inspection at ${r.projectLocation || ''}`;\r\n    const location = r.projectLocation || '';\r\n    return { title, start, end, details, location };\r\n  };\r\n\r\n  const formatDateICS = (d) => {\r\n    const pad = (n) => String(n).padStart(2, '0');\r\n    return `${d.getUTCFullYear()}${pad(d.getUTCMonth()+1)}${pad(d.getUTCDate())}T${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}00Z`;\r\n  };\r\n\r\n  const downloadICS = (r) => {\r\n    const { title, start, end, details, location } = buildCalendar(r);\r\n    if (!start || !end) { return; }\r\n    const ics = [\r\n      'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//PropertyArk//Inspection//EN','BEGIN:VEVENT',\r\n      `UID:${r.id}@propertyark`,`DTSTAMP:${formatDateICS(new Date())}`,\r\n      `DTSTART:${formatDateICS(start)}`,`DTEND:${formatDateICS(end)}`,\r\n      `SUMMARY:${title}`,`DESCRIPTION:${details}`,`LOCATION:${location}`,'END:VEVENT','END:VCALENDAR'\r\n    ].join('\\r\\n');\r\n    const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url; a.download = `inspection-${r.id}.ics`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);\r\n  };\r\n\r\n  const openGoogleCalendar = (r) => {\r\n    const { title, start, end, details, location } = buildCalendar(r);\r\n    if (!start || !end) { return; }\r\n    const fmt = (d) => `${d.getUTCFullYear()}${String(d.getUTCMonth()+1).padStart(2,'0')}${String(d.getUTCDate()).padStart(2,'0')}T${String(d.getUTCHours()).padStart(2,'0')}${String(d.getUTCMinutes()).padStart(2,'0')}00Z`;\r\n    const text = encodeURIComponent(title);\r\n    const dates = `${fmt(start)}/${fmt(end)}`;\r\n    const detailsEnc = encodeURIComponent(details);\r\n    const locationEnc = encodeURIComponent(location);\r\n    const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${dates}&details=${detailsEnc}&location=${locationEnc}`;\r\n    window.open(url, '_blank');\r\n  };\r\n\r\n  // Load requests from localStorage (primary source for now)\r\n  const loadRequestsFromLocalStorage = () => {\r\n    if (!user?.id) return [];\r\n    \r\n    try {\r\n      const viewingRequests = JSON.parse(localStorage.getItem('viewingRequests') || '[]');\r\n      \r\n      // Filter by user ID (check both userId and buyerId for compatibility)\r\n      const userRequests = viewingRequests.filter(req => \r\n        req.userId === user.id || req.buyerId === user.id\r\n      );\r\n      \r\n      // Transform localStorage format to match component expectations\r\n      const transformed = userRequests.map(req => ({\r\n        id: req.id,\r\n        // Map property fields to project fields (for display compatibility)\r\n        projectName: req.propertyTitle || req.projectName || req.title || 'Property',\r\n        projectLocation: req.propertyLocation || req.projectLocation || req.location || '',\r\n        // Keep original fields\r\n        preferredDate: req.preferredDate,\r\n        preferredTime: req.preferredTime,\r\n        confirmedDate: req.confirmedDate,\r\n        confirmedTime: req.confirmedTime,\r\n        proposedDate: req.proposedDate,\r\n        proposedTime: req.proposedTime,\r\n        status: req.status || 'pending_vendor',\r\n        createdAt: req.requestedAt || req.createdAt || new Date().toISOString(),\r\n        // Keep other fields\r\n        ...req\r\n      }));\r\n      \r\n      // Sort by date (newest first)\r\n      transformed.sort((a, b) => {\r\n        const dateA = new Date(a.createdAt || 0);\r\n        const dateB = new Date(b.createdAt || 0);\r\n        return dateB - dateA;\r\n      });\r\n      \r\n      return transformed;\r\n    } catch (error) {\r\n      console.error('Error loading requests from localStorage:', error);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  // Update requests state\r\n  const updateRequests = (newRequests) => {\r\n    setRequests(newRequests);\r\n    ensureNotificationPermission();\r\n    const prev = prevStatusRef.current || {};\r\n    for (const r of newRequests) {\r\n      const previous = prev[r.id];\r\n      if (previous && previous !== r.status) {\r\n        if (r.status === 'accepted') {\r\n          showWebNotification('Inspection confirmed', { body: `${r.projectName} on ${r.confirmedDate} ${r.confirmedTime}` });\r\n        } else if (r.status === 'proposed_new_time') {\r\n          showWebNotification('Vendor proposed a new time', { body: `${r.projectName}: ${r.proposedDate} ${r.proposedTime}` });\r\n        } else if (r.status === 'declined') {\r\n          showWebNotification('Inspection declined', { body: `${r.projectName}` });\r\n        } else if (r.status === 'cancelled_by_vendor') {\r\n          showWebNotification('Vendor cancelled inspection', { body: `${r.projectName} was cancelled by vendor` });\r\n          toast.error(`Vendor cancelled inspection for ${r.projectName}`);\r\n        }\r\n      }\r\n    }\r\n    prevStatusRef.current = Object.fromEntries(newRequests.map(x => [x.id, x.status]));\r\n    if (user && user.id) {\r\n      setAnalytics(getInspectionAnalytics({ role: 'buyer', userId: user.id }));\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!user?.id) {\r\n      setRequests([]);\r\n      return;\r\n    }\r\n\r\n    // Load from localStorage (primary source)\r\n    const localRequests = loadRequestsFromLocalStorage();\r\n    updateRequests(localRequests);\r\n\r\n    // Poll for updates every 5 seconds as fallback\r\n    const pollInterval = setInterval(() => {\r\n      const updatedRequests = loadRequestsFromLocalStorage();\r\n      updateRequests(updatedRequests);\r\n    }, 5000);\r\n\r\n    // Listen for viewing updates from other components\r\n    const handleViewingsUpdate = () => {\r\n      const updatedRequests = loadRequestsFromLocalStorage();\r\n      updateRequests(updatedRequests);\r\n    };\r\n\r\n    const handleAnalyticsUpdate = (event) => {\r\n      if (!user?.id) return;\r\n      const detail = event.detail || event;\r\n      if (detail?.buyerId && detail.buyerId !== user.id) return;\r\n      const data = getInspectionAnalytics({ role: 'buyer', userId: user.id });\r\n      setAnalytics(data);\r\n    };\r\n\r\n    window.addEventListener('viewingsUpdated', handleViewingsUpdate);\r\n    window.addEventListener('inspectionAnalyticsUpdated', handleAnalyticsUpdate);\r\n    window.addEventListener('storage', (e) => {\r\n      if (e.key === 'viewingRequests') {\r\n        handleViewingsUpdate();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      clearInterval(pollInterval);\r\n      window.removeEventListener('viewingsUpdated', handleViewingsUpdate);\r\n      window.removeEventListener('inspectionAnalyticsUpdated', handleAnalyticsUpdate);\r\n    };\r\n  }, [user?.id]);\r\n\r\n  useEffect(() => {\r\n    if (!user?.id) {\r\n      setAnalytics(null);\r\n      return;\r\n    }\r\n    setAnalytics(getInspectionAnalytics({ role: 'buyer', userId: user.id }));\r\n  }, [user?.id]);\r\n\r\n  const acceptProposal = async (r) => {\r\n    if (!r.proposedDate || !r.proposedTime) {\r\n      toast.error('No proposed time from vendor');\r\n      return;\r\n    }\r\n    const ok = await updateInspectionRequest(r.id, {\r\n      status: 'accepted',\r\n      confirmedDate: r.proposedDate,\r\n      confirmedTime: r.proposedTime\r\n    });\r\n    if (ok) toast.success('Proposal accepted'); else toast.error('Failed to accept');\r\n  };\r\n\r\n  const declineProposal = async (r) => {\r\n    const ok = await updateInspectionRequest(r.id, { status: 'declined' });\r\n    if (ok) toast.success('Proposal declined'); else toast.error('Failed to decline');\r\n  };\r\n\r\n  const handleCancelRequest = async (r) => {\r\n    const confirm = window.confirm('Cancel this inspection request? Vendors will be notified.');\r\n    if (!confirm) return;\r\n    const ok = await updateInspectionRequest(r.id, { status: 'cancelled_by_buyer', cancelledAt: new Date().toISOString() });\r\n    if (ok) toast.success('Inspection cancelled'); else toast.error('Failed to cancel');\r\n  };\r\n\r\n  const openReschedule = (r) => {\r\n    setRescheduleRequest(r);\r\n    setRescheduleDate(r.preferredDate || '');\r\n    setRescheduleTime(r.preferredTime || '');\r\n    setRescheduleNote('');\r\n    setShowRescheduleModal(true);\r\n  };\r\n\r\n  const submitReschedule = async () => {\r\n    if (!rescheduleRequest || !rescheduleDate || !rescheduleTime) {\r\n      toast.error('Select your new date and time');\r\n      return;\r\n    }\r\n    const ok = await updateInspectionRequest(rescheduleRequest.id, {\r\n      status: 'buyer_rescheduled',\r\n      preferredDate: rescheduleDate,\r\n      preferredTime: rescheduleTime,\r\n      buyerMessage: rescheduleNote || '',\r\n      proposedDate: null,\r\n      proposedTime: null\r\n    });\r\n    if (ok) {\r\n      toast.success('Reschedule request sent to vendor');\r\n      setShowRescheduleModal(false);\r\n      setRescheduleRequest(null);\r\n      setRescheduleDate('');\r\n      setRescheduleTime('');\r\n      setRescheduleNote('');\r\n    } else {\r\n      toast.error('Failed to reschedule');\r\n    }\r\n  };\r\n\r\n  const handleViewProperty = (request) => {\r\n    // Try to get propertyId from the request\r\n    const propertyId = request.propertyId || request.projectId;\r\n    \r\n    if (propertyId) {\r\n      navigate(`/property/${propertyId}`);\r\n    } else {\r\n      toast.error('Property information not available');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">My Inspection Requests</h1>\r\n        <p className=\"text-gray-600\">Track and respond to vendor proposals</p>\r\n      </div>\r\n\r\n      {analytics && (\r\n        <div className=\"space-y-4 mb-6\">\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            <div className=\"bg-blue-50 border border-blue-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-blue-600\">Pending Responses</p>\r\n              <p className=\"text-3xl font-semibold text-blue-900\">{analytics.pendingResponses}</p>\r\n            </div>\r\n            <div className=\"bg-green-50 border border-green-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-green-600\">Confirmed</p>\r\n              <p className=\"text-3xl font-semibold text-green-900\">{analytics.confirmed}</p>\r\n            </div>\r\n            <div className=\"bg-purple-50 border border-purple-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-purple-600\">Vendor Reschedules</p>\r\n              <p className=\"text-3xl font-semibold text-purple-900\">{analytics.vendorProposals}</p>\r\n            </div>\r\n            <div className=\"bg-red-50 border border-red-100 rounded-xl p-4\">\r\n              <p className=\"text-sm text-red-600\">Vendor Cancellations</p>\r\n              <p className=\"text-3xl font-semibold text-red-900\">{analytics.cancelledByVendor}</p>\r\n            </div>\r\n          </div>\r\n\r\n          {analytics.timeline?.length > 0 && (\r\n            <div className=\"bg-white rounded-2xl border border-gray-100 shadow-sm p-4\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h3 className=\"text-sm font-semibold text-gray-900\">Last 7 days activity</h3>\r\n                <span className=\"text-xs text-gray-500\">{analytics.totalRequests} total requests</span>\r\n              </div>\r\n              <div className=\"flex gap-3 overflow-x-auto text-sm\">\r\n                {analytics.timeline.map((item) => (\r\n                  <div key={item.date} className=\"flex-1 min-w-[90px] text-center\">\r\n                    <p className=\"text-gray-500 text-xs\">{new Date(item.date).toLocaleDateString()}</p>\r\n                    <p className=\"text-lg font-semibold text-gray-900\">{item.count}</p>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white rounded-lg shadow\">\r\n        <div className=\"p-4 border-b border-gray-200 text-sm text-gray-600\">{requests.length} request(s)</div>\r\n        <div className=\"divide-y\">\r\n          {requests.length === 0 && (\r\n            <div className=\"p-6 text-sm text-gray-600\">No inspection requests yet.</div>\r\n          )}\r\n          {requests.map((r) => (\r\n            <div key={r.id} className=\"p-4 flex items-center text-sm\">\r\n              <div className=\"w-1/5\">\r\n                <div className=\"font-medium text-gray-900\">{r.projectName}</div>\r\n                <div className=\"text-gray-600\">{r.projectLocation}</div>\r\n              </div>\r\n              <div className=\"w-1/5\">\r\n                <div>Preferred: {r.preferredDate} {r.preferredTime}</div>\r\n                {r.proposedDate && r.proposedTime && (\r\n                  <div className=\"text-xs text-gray-600\">Vendor proposed: {r.proposedDate} {r.proposedTime}</div>\r\n                )}\r\n              </div>\r\n              <div className=\"w-1/5\">\r\n                <span className={`px-2 py-1 rounded-full text-xs ${\r\n                  r.status === 'pending_vendor' ? 'bg-yellow-100 text-yellow-800' :\r\n                  r.status === 'accepted' ? 'bg-green-100 text-green-800' :\r\n                  r.status === 'proposed_new_time' ? 'bg-blue-100 text-blue-800' :\r\n                  r.status === 'pending_vendor_confirmation' ? 'bg-yellow-100 text-yellow-800' :\r\n                  'bg-red-100 text-red-800'\r\n                }`}>\r\n                  {r.status?.replaceAll('_',' ') || 'pending'}\r\n                </span>\r\n              </div>\r\n              <div className=\"w-2/5 flex flex-wrap gap-2 items-center\">\r\n                {/* View Property Icon */}\r\n                <button\r\n                  onClick={() => handleViewProperty(r)}\r\n                  className=\"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors\"\r\n                  title=\"View Property Details\"\r\n                >\r\n                  <FaEye className=\"w-5 h-5\" />\r\n                </button>\r\n                \r\n                {r.status === 'proposed_new_time' && (\r\n                  <>\r\n                    <button onClick={() => acceptProposal(r)} className=\"px-3 py-1 bg-green-600 text-white rounded\">Accept Proposal</button>\r\n                    <button onClick={() => declineProposal(r)} className=\"px-3 py-1 bg-red-600 text-white rounded\">Decline</button>\r\n                  </>\r\n                )}\r\n                {r.status === 'accepted' && (\r\n                  <>\r\n                    <button onClick={() => openGoogleCalendar(r)} className=\"px-3 py-1 bg-gray-800 text-white rounded\">Google Calendar</button>\r\n                    <button onClick={() => downloadICS(r)} className=\"px-3 py-1 border rounded\">Download .ics</button>\r\n                  </>\r\n                )}\r\n                {r.status !== 'cancelled_by_buyer' && r.status !== 'declined' && (\r\n                  <>\r\n                    <button onClick={() => openReschedule(r)} className=\"px-3 py-1 bg-blue-600 text-white rounded\">Reschedule</button>\r\n                    <button onClick={() => handleCancelRequest(r)} className=\"px-3 py-1 bg-red-100 text-red-700 rounded border border-red-300\">Cancel</button>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {showRescheduleModal && rescheduleRequest && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-lg max-w-md w-full p-6\">\r\n            <div className=\"flex items-start justify-between mb-4\">\r\n              <div>\r\n                <h3 className=\"text-lg font-bold text-gray-900\">Reschedule Inspection</h3>\r\n                <p className=\"text-sm text-gray-500\">{rescheduleRequest.projectName}</p>\r\n              </div>\r\n              <button onClick={() => setShowRescheduleModal(false)} className=\"text-gray-500 hover:text-gray-700\">Ã—</button>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">New date</label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={rescheduleDate}\r\n                  onChange={(e) => setRescheduleDate(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">New time</label>\r\n                <input\r\n                  type=\"time\"\r\n                  value={rescheduleTime}\r\n                  onChange={(e) => setRescheduleTime(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Message to vendor (optional)</label>\r\n                <textarea\r\n                  value={rescheduleNote}\r\n                  onChange={(e) => setRescheduleNote(e.target.value)}\r\n                  rows={3}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  placeholder=\"Share context for the new time\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"flex justify-between mt-6\">\r\n              <button onClick={() => setShowRescheduleModal(false)} className=\"px-5 py-2 border rounded-lg\">Close</button>\r\n              <button onClick={submitReschedule} className=\"px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">Send Update</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BuyerInspectionRequests;\r\n\r\n\r\n\r\n\r\n\r\n","import notificationService from './notificationService';\r\n\r\nconst COLLECTION = 'inspectionRequests';\r\nconst VIEWING_REQUESTS_KEY = 'viewingRequests';\r\nconst INSPECTION_ACTIVITY_KEY = 'inspectionActivityLog';\r\nconst ANALYTICS_EVENT = 'inspectionAnalyticsUpdated';\r\nconst ACTIVITY_EVENT = 'inspectionActivity';\r\n\r\nconst defaultAnalytics = {\r\n  totalRequests: 0,\r\n  pendingResponses: 0,\r\n  confirmed: 0,\r\n  vendorProposals: 0,\r\n  buyerReschedules: 0,\r\n  cancelledByBuyer: 0,\r\n  cancelledByVendor: 0,\r\n  timeline: []\r\n};\r\n\r\nconst safeWindowDispatch = (eventName, detail) => {\r\n  if (typeof window === 'undefined') return;\r\n  if (eventName === 'storage') {\r\n    try {\r\n      window.dispatchEvent(new StorageEvent('storage', detail));\r\n    } catch {\r\n      window.dispatchEvent(new CustomEvent('storage', { detail }));\r\n    }\r\n    return;\r\n  }\r\n  if (typeof window.dispatchEvent === 'function') {\r\n    window.dispatchEvent(new CustomEvent(eventName, { detail }));\r\n  }\r\n};\r\n\r\nconst getStoredRequests = () => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(VIEWING_REQUESTS_KEY) || '[]');\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\nconst saveStoredRequests = (requests) => {\r\n  localStorage.setItem(VIEWING_REQUESTS_KEY, JSON.stringify(requests));\r\n};\r\n\r\nconst getActivityLog = () => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(INSPECTION_ACTIVITY_KEY) || '[]');\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\nconst saveActivityLog = (log) => {\r\n  localStorage.setItem(INSPECTION_ACTIVITY_KEY, JSON.stringify(log));\r\n};\r\n\r\nconst buildActivityPayload = (action, request) => ({\r\n  action,\r\n  requestId: request.id,\r\n  propertyTitle: request.propertyTitle || request.projectTitle || request.projectName || request.title || 'Property',\r\n  buyerId: request.buyerId || request.userId,\r\n  vendorId: request.vendorId,\r\n  vendorEmail: request.vendorEmail,\r\n  status: request.status,\r\n  timestamp: new Date().toISOString()\r\n});\r\n\r\nconst formatDateTimeLabel = (date, time) => {\r\n  if (!date && !time) return '';\r\n  if (!time) return date;\r\n  if (!date) return time;\r\n  return `${date} ${time}`;\r\n};\r\n\r\nconst buildInspectionNotificationEntries = (action, request, payload) => {\r\n  const entries = [];\r\n  const propertyTitle = payload.propertyTitle;\r\n  const buyerName = request.buyerName || request.userName || 'Buyer';\r\n  const vendorName = request.vendorName || request.vendor || request.owner || 'Vendor';\r\n  const preferredLabel = formatDateTimeLabel(request.preferredDate, request.preferredTime);\r\n  const confirmedLabel = formatDateTimeLabel(request.confirmedDate, request.confirmedTime);\r\n  const proposedLabel = formatDateTimeLabel(request.proposedDate, request.proposedTime);\r\n\r\n  const pushForVendor = (title, message) => {\r\n    if (request.vendorId || request.vendorEmail) {\r\n      entries.push({\r\n        recipientId: request.vendorId,\r\n        recipientEmail: request.vendorEmail,\r\n        roles: ['vendor'],\r\n        type: action,\r\n        title,\r\n        message,\r\n        priority: 'medium',\r\n        metadata: { requestId: request.id, propertyTitle, buyerName, vendorName }\r\n      });\r\n    }\r\n  };\r\n\r\n  const pushForBuyer = (title, message) => {\r\n    if (request.buyerId || request.userId || request.buyerEmail || request.userEmail) {\r\n      entries.push({\r\n        recipientId: request.buyerId || request.userId,\r\n        recipientEmail: request.buyerEmail || request.userEmail,\r\n        roles: ['buyer'],\r\n        type: action,\r\n        title,\r\n        message,\r\n        priority: 'medium',\r\n        metadata: { requestId: request.id, propertyTitle, buyerName, vendorName }\r\n      });\r\n    }\r\n  };\r\n\r\n  switch (action) {\r\n    case 'inspection_requested':\r\n      pushForVendor('New inspection request', `${buyerName} requested to view ${propertyTitle} ${preferredLabel ? `on ${preferredLabel}` : ''}`.trim());\r\n      break;\r\n    case 'inspection_confirmed':\r\n      pushForBuyer('Inspection confirmed', `${vendorName} confirmed ${propertyTitle} ${confirmedLabel ? `for ${confirmedLabel}` : ''}`.trim());\r\n      break;\r\n    case 'vendor_proposed_new_time':\r\n      pushForBuyer('Vendor proposed new time', `${vendorName} suggested ${proposedLabel || 'another slot'} for ${propertyTitle}`);\r\n      break;\r\n    case 'buyer_rescheduled':\r\n      pushForVendor('Buyer requested new time', `${buyerName} rescheduled ${propertyTitle} ${preferredLabel ? `to ${preferredLabel}` : ''}`.trim());\r\n      break;\r\n    case 'inspection_cancelled_by_buyer':\r\n      pushForVendor('Inspection cancelled by buyer', `${buyerName} cancelled ${propertyTitle}`);\r\n      break;\r\n    case 'inspection_cancelled_by_vendor':\r\n      pushForBuyer('Inspection cancelled by vendor', `${vendorName} cancelled ${propertyTitle}`);\r\n      break;\r\n    case 'inspection_declined':\r\n      pushForBuyer('Inspection declined', `${vendorName} declined the request for ${propertyTitle}`);\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  return entries;\r\n};\r\n\r\nconst persistInspectionNotifications = (entries = []) => {\r\n  if (!entries.length || typeof window === 'undefined') return;\r\n  const payloads = entries\r\n    .filter((entry) => entry.recipientId)\r\n    .map((entry) => ({\r\n      recipientId: entry.recipientId,\r\n      type: entry.type,\r\n      title: entry.title,\r\n      message: entry.message,\r\n      priority: entry.priority || 'medium',\r\n      metadata: {\r\n        ...(entry.metadata || {}),\r\n        source: entry.metadata?.source || 'inspection_client_sync'\r\n      },\r\n      data: entry.metadata || {}\r\n    }));\r\n\r\n  if (!payloads.length) return;\r\n\r\n  notificationService.createInspectionNotifications(payloads)\r\n    .then((result) => {\r\n      if (!result?.success) {\r\n        console.warn('Failed to persist inspection notifications', result);\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error persisting inspection notifications:', error);\r\n    });\r\n};\r\n\r\nconst logInspectionActivity = (action, request) => {\r\n  if (!action || !request) return;\r\n  const payload = buildActivityPayload(action, request);\r\n  const log = getActivityLog();\r\n  log.unshift(payload);\r\n  if (log.length > 200) {\r\n    log.pop();\r\n  }\r\n  saveActivityLog(log);\r\n  safeWindowDispatch(ACTIVITY_EVENT, payload);\r\n  safeWindowDispatch(ANALYTICS_EVENT, payload);\r\n  const notifications = buildInspectionNotificationEntries(action, request, payload);\r\n  if (notifications.length) {\r\n    safeWindowDispatch('inspectionNotification', { action, payload, notifications, request });\r\n    persistInspectionNotifications(notifications);\r\n  }\r\n};\r\n\r\nconst deriveActionFromStatus = (previous, next, updates = {}) => {\r\n  const status = (next?.status || updates.status || '').toLowerCase();\r\n  if (!status && (updates.proposedDate || updates.proposedTime)) {\r\n    return 'vendor_proposed_new_time';\r\n  }\r\n  switch (status) {\r\n    case 'accepted':\r\n    case 'confirmed':\r\n      return 'inspection_confirmed';\r\n    case 'proposed_new_time':\r\n      return 'vendor_proposed_new_time';\r\n    case 'buyer_rescheduled':\r\n      return 'buyer_rescheduled';\r\n    case 'cancelled_by_buyer':\r\n      return 'inspection_cancelled_by_buyer';\r\n    case 'cancelled_by_vendor':\r\n      return 'inspection_cancelled_by_vendor';\r\n    case 'declined':\r\n      return 'inspection_declined';\r\n    default:\r\n      if (previous && previous.status !== next?.status) {\r\n        return `inspection_status_${next?.status || 'updated'}`;\r\n      }\r\n      return null;\r\n  }\r\n};\r\n\r\nconst getDateKey = (isoDate) => {\r\n  const date = isoDate ? new Date(isoDate) : new Date();\r\n  return date.toISOString().slice(0, 10);\r\n};\r\n\r\nconst matchesBuyer = (request, buyerId) => {\r\n  if (!buyerId) return false;\r\n  return request?.buyerId === buyerId || request?.userId === buyerId;\r\n};\r\n\r\nconst matchesVendor = (request, vendorId, vendorEmail) => {\r\n  if (!vendorId && !vendorEmail) return false;\r\n  return (vendorId && request?.vendorId === vendorId) || (vendorEmail && request?.vendorEmail === vendorEmail);\r\n};\r\n\r\nexport const getInspectionAnalytics = ({ role = 'buyer', userId, vendorId, vendorEmail } = {}) => {\r\n  if (typeof window === 'undefined') return { ...defaultAnalytics };\r\n  if (role === 'buyer' && !userId) return { ...defaultAnalytics };\r\n  if (role === 'vendor' && !vendorId && !vendorEmail) return { ...defaultAnalytics };\r\n\r\n  const requests = getStoredRequests();\r\n  const relevant = requests.filter((req) =>\r\n    role === 'buyer' ? matchesBuyer(req, userId) : matchesVendor(req, vendorId || req.vendorId, vendorEmail)\r\n  );\r\n\r\n  const analytics = {\r\n    totalRequests: relevant.length,\r\n    pendingResponses: 0,\r\n    confirmed: 0,\r\n    vendorProposals: 0,\r\n    buyerReschedules: 0,\r\n    cancelledByBuyer: 0,\r\n    cancelledByVendor: 0,\r\n    timeline: []\r\n  };\r\n\r\n  const pendingStatuses = ['pending', 'pending_vendor', 'pending_vendor_confirmation'];\r\n  const log = getActivityLog();\r\n  const activityFilter = (entry) =>\r\n    role === 'buyer' ? entry?.buyerId === userId : matchesVendor(entry, vendorId, vendorEmail);\r\n\r\n  relevant.forEach((req) => {\r\n    const status = (req.status || '').toLowerCase();\r\n    if (pendingStatuses.includes(status)) {\r\n      analytics.pendingResponses += 1;\r\n    }\r\n    if (['accepted', 'confirmed'].includes(status)) {\r\n      analytics.confirmed += 1;\r\n    }\r\n    if (status === 'proposed_new_time') {\r\n      analytics.vendorProposals += 1;\r\n    }\r\n    if (status === 'buyer_rescheduled') {\r\n      analytics.buyerReschedules += 1;\r\n    }\r\n    if (status === 'cancelled_by_buyer') {\r\n      analytics.cancelledByBuyer += 1;\r\n    }\r\n    if (['cancelled_by_vendor', 'declined'].includes(status)) {\r\n      analytics.cancelledByVendor += 1;\r\n    }\r\n  });\r\n\r\n  const lastSevenDays = Array.from({ length: 7 }).map((_, idx) => {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() - (6 - idx));\r\n    const dateKey = date.toISOString().slice(0, 10);\r\n    const dailyCount = log.filter((entry) => activityFilter(entry) && getDateKey(entry.timestamp) === dateKey).length;\r\n    return { date: dateKey, count: dailyCount };\r\n  });\r\n\r\n  analytics.timeline = lastSevenDays;\r\n  return analytics;\r\n};\r\n\r\nexport const createInspectionRequest = async (requestData) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for creating inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const existing = getStoredRequests();\r\n    const newRequest = {\r\n      id: `viewing-${Date.now()}`,\r\n      ...requestData,\r\n      createdAt: new Date().toISOString(),\r\n      status: 'pending'\r\n    };\r\n    existing.push(newRequest);\r\n    saveStoredRequests(existing);\r\n    \r\n    // Dispatch event to notify Dashboard and other components\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      viewingRequest: newRequest,\r\n      action: 'created'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(existing)\r\n    });\r\n    logInspectionActivity('inspection_requested', newRequest);\r\n    \r\n    return newRequest;\r\n  } catch (error) {\r\n    console.error('Error creating inspection request:', error);\r\n    // Final fallback to localStorage\r\n    const existing = getStoredRequests();\r\n    const newRequest = {\r\n      id: `viewing-${Date.now()}`,\r\n      ...requestData,\r\n      createdAt: new Date().toISOString(),\r\n      status: 'pending'\r\n    };\r\n    existing.push(newRequest);\r\n    saveStoredRequests(existing);\r\n    \r\n    // Dispatch event to notify Dashboard and other components\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      viewingRequest: newRequest,\r\n      action: 'created'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(existing)\r\n    });\r\n    logInspectionActivity('inspection_requested', newRequest);\r\n    \r\n    return newRequest;\r\n  }\r\n};\r\n\r\nexport const listInspectionRequestsByVendor = async (vendorId, vendorEmail) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const local = getStoredRequests();\r\n    \r\n    // Filter by vendorId or vendorEmail\r\n    const filtered = local.filter((r) => \r\n      (vendorId && r.vendorId === vendorId) || \r\n      (vendorEmail && r.vendorEmail === vendorEmail)\r\n    );\r\n    \r\n    // Sort newest first\r\n    filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\r\n    \r\n    return filtered;\r\n  } catch (error) {\r\n    console.error('Error listing inspection requests:', error);\r\n    // Final fallback to localStorage\r\n    const local = getStoredRequests();\r\n    const filtered = local.filter((r) => \r\n      (vendorId && r.vendorId === vendorId) || \r\n      (vendorEmail && r.vendorEmail === vendorEmail)\r\n    );\r\n    return filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\r\n  }\r\n};\r\n\r\nexport const listInspectionRequestsByBuyer = async (buyerId) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for buyer inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const local = getStoredRequests();\r\n    const filtered = local.filter((r) => r.buyerId === buyerId);\r\n    return filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\r\n  } catch (error) {\r\n    console.error('Error listing buyer inspection requests:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const updateInspectionRequest = async (requestId, updates) => {\r\n  try {\r\n    // Skip API call for now since it's returning 404, go directly to localStorage\r\n    console.log('Using localStorage for updating inspection requests (API unavailable)');\r\n    \r\n    // Fallback to localStorage\r\n    const all = getStoredRequests();\r\n    let nextRecord = null;\r\n    const updated = all.map((r) => {\r\n      if (r.id === requestId) {\r\n        nextRecord = { ...r, ...updates, updatedAt: new Date().toISOString() };\r\n        return nextRecord;\r\n      }\r\n      return r;\r\n    });\r\n    if (!nextRecord) {\r\n      saveStoredRequests(all);\r\n      return false;\r\n    }\r\n    saveStoredRequests(updated);\r\n    \r\n    // Dispatch event to notify Dashboard and other components when status changes\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      requestId,\r\n      updates,\r\n      action: 'updated'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(updated)\r\n    });\r\n    const action = deriveActionFromStatus(all.find((r) => r.id === requestId), nextRecord, updates);\r\n    if (action) {\r\n      logInspectionActivity(action, nextRecord);\r\n    }\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error updating inspection request:', error);\r\n    // Final fallback to localStorage\r\n    const all = getStoredRequests();\r\n    let nextRecord = null;\r\n    const updated = all.map((r) => {\r\n      if (r.id === requestId) {\r\n        nextRecord = { ...r, ...updates, updatedAt: new Date().toISOString() };\r\n        return nextRecord;\r\n      }\r\n      return r;\r\n    });\r\n    if (!nextRecord) {\r\n      saveStoredRequests(all);\r\n      return false;\r\n    }\r\n    saveStoredRequests(updated);\r\n    \r\n    // Dispatch event to notify Dashboard and other components when status changes\r\n    safeWindowDispatch('viewingsUpdated', {\r\n      requestId,\r\n      updates,\r\n      action: 'updated'\r\n    });\r\n    \r\n    // Also trigger a storage event for cross-tab synchronization\r\n    safeWindowDispatch('storage', {\r\n      key: VIEWING_REQUESTS_KEY,\r\n      newValue: JSON.stringify(updated)\r\n    });\r\n    const action = deriveActionFromStatus(all.find((r) => r.id === requestId), nextRecord, updates);\r\n    if (action) {\r\n      logInspectionActivity(action, nextRecord);\r\n    }\r\n    \r\n    return true;\r\n  }\r\n};\r\n\r\nexport const syncLocalInspectionRequests = async () => {\r\n  try {\r\n    // Try to sync with API if available\r\n    const local = getStoredRequests();\r\n    console.log('Inspection requests stored locally:', local.length);\r\n    return { synced: local.length };\r\n  } catch (error) {\r\n    console.error('syncLocalInspectionRequests failed:', error);\r\n    return { synced: 0 };\r\n  }\r\n};\r\n\r\nexport default {\r\n  createInspectionRequest,\r\n  listInspectionRequestsByVendor,\r\n  listInspectionRequestsByBuyer,\r\n  updateInspectionRequest,\r\n  syncLocalInspectionRequests,\r\n  getInspectionAnalytics\r\n};"],"names":["BuyerInspectionRequests","_analytics$timeline","user","useAuth","navigate","useNavigate","requests","setRequests","useState","analytics","setAnalytics","prevStatusRef","useRef","showRescheduleModal","setShowRescheduleModal","rescheduleRequest","setRescheduleRequest","rescheduleDate","setRescheduleDate","rescheduleTime","setRescheduleTime","rescheduleNote","setRescheduleNote","showWebNotification","title","options","arguments","length","undefined","window","Notification","permission","e","toDateTime","dateStr","timeStr","Date","buildCalendar","r","projectName","start","confirmedDate","confirmedTime","preferredDate","preferredTime","end","getTime","details","projectLocation","location","formatDateICS","d","pad","n","String","padStart","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","loadRequestsFromLocalStorage","id","viewingRequests","JSON","parse","localStorage","getItem","transformed","filter","req","userId","buyerId","map","propertyTitle","propertyLocation","proposedDate","proposedTime","status","createdAt","requestedAt","toISOString","sort","a","b","dateA","error","console","updateRequests","newRequests","async","requestPermission","ensureNotificationPermission","prev","current","previous","body","toast","Object","fromEntries","x","getInspectionAnalytics","role","useEffect","localRequests","pollInterval","setInterval","updatedRequests","handleViewingsUpdate","handleAnalyticsUpdate","event","detail","data","addEventListener","key","clearInterval","removeEventListener","_jsxs","className","children","_jsx","pendingResponses","confirmed","vendorProposals","cancelledByVendor","timeline","totalRequests","item","date","toLocaleDateString","count","_r$status","replaceAll","onClick","request","propertyId","projectId","handleViewProperty","FaEye","_Fragment","updateInspectionRequest","success","acceptProposal","declineProposal","fmt","url","encodeURIComponent","open","openGoogleCalendar","ics","join","blob","Blob","type","URL","createObjectURL","document","createElement","href","download","appendChild","click","removeChild","revokeObjectURL","downloadICS","openReschedule","confirm","cancelledAt","handleCancelRequest","value","onChange","target","rows","placeholder","buyerMessage","VIEWING_REQUESTS_KEY","INSPECTION_ACTIVITY_KEY","defaultAnalytics","buyerReschedules","cancelledByBuyer","safeWindowDispatch","eventName","dispatchEvent","CustomEvent","StorageEvent","getStoredRequests","saveStoredRequests","setItem","stringify","getActivityLog","formatDateTimeLabel","time","logInspectionActivity","action","payload","buildActivityPayload","requestId","projectTitle","vendorId","vendorEmail","timestamp","log","unshift","pop","saveActivityLog","notifications","buildInspectionNotificationEntries","entries","buyerName","userName","vendorName","vendor","owner","preferredLabel","confirmedLabel","proposedLabel","pushForVendor","message","push","recipientId","recipientEmail","roles","priority","metadata","pushForBuyer","buyerEmail","userEmail","trim","payloads","entry","_entry$metadata","source","notificationService","createInspectionNotifications","then","result","warn","catch","persistInspectionNotifications","deriveActionFromStatus","next","updates","toLowerCase","matchesVendor","relevant","matchesBuyer","pendingStatuses","forEach","includes","lastSevenDays","Array","from","_","idx","setDate","getDate","dateKey","slice","dailyCount","activityFilter","isoDate","createInspectionRequest","existing","newRequest","now","requestData","viewingRequest","newValue","listInspectionRequestsByVendor","filtered","all","nextRecord","updated","updatedAt","find"],"sourceRoot":""}