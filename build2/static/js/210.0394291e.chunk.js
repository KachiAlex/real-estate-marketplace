"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[210],{7210:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var o=s(5043),n=s(3216),r=s(5475),l=s(4345),i=s(3823),a=s(5016),d=s(2825),c=s(5369),m=s(3768),u=s(1876),x=s(579);const p="escrowPayments",v=()=>{if("undefined"===typeof window)return[];try{const e=window.localStorage.getItem(p);return e?JSON.parse(e):[]}catch(e){return console.warn("EscrowPaymentFlow: unable to read escrow payments from storage",e),[]}},y=e=>{if("undefined"!==typeof window)try{const t=v().filter(t=>t.paymentId!==e.paymentId&&t.txRef!==e.txRef);t.push(e),window.localStorage.setItem(p,JSON.stringify(t))}catch(t){console.warn("EscrowPaymentFlow: unable to save escrow payment entry",t)}},h=e=>{const t=(null===e||void 0===e?void 0:e.token)||(()=>{if("undefined"===typeof window)return null;try{return window.localStorage.getItem("token")}catch{return null}})(),s=null===e||void 0===e?void 0:e.email;if(!t&&!s)return null;const o={"Content-Type":"application/json"};return t?o.Authorization=`Bearer ${t}`:s&&(o["X-Mock-User-Email"]=s),o},g=e=>{if("undefined"!==typeof window)try{const t=v().filter(t=>t.paymentId!==e);window.localStorage.setItem(p,JSON.stringify(t))}catch(t){console.warn("EscrowPaymentFlow: unable to remove escrow payment entry",t)}},f=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flutterwave";if(e&&"undefined"!==typeof window)try{const o=JSON.parse(localStorage.getItem("escrowTransactions")||"[]").map(o=>{var n;return o.id===e?{...o,status:"payment_received",payment:{...o.payment||{},method:s,reference:t||(null===(n=o.payment)||void 0===n?void 0:n.reference),paidAt:(new Date).toISOString()},fundedAt:(new Date).toISOString()}:o});localStorage.setItem("escrowTransactions",JSON.stringify(o))}catch(o){console.warn("EscrowPaymentFlow: unable to mark escrow transaction funded",o)}},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=Number.isFinite(e)?e:0;return new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",maximumFractionDigits:0}).format(t)},b=(e,t)=>"investment"===t?`Escrow funding for investment opportunity: ${e}`:`Escrow payment for property purchase: ${e}`,j=e=>{var t,s;let{property:p=null,investment:j=null,transactionType:N="purchase",onClose:P}=e;const I=(0,n.Zp)(),[k]=(0,r.ok)(),{user:F,clearAuthRedirect:E}=(0,a.As)(),{fetchProperty:S}=(0,l.NC)(),{createEscrowTransaction:C}=(0,i.N)(),{investments:A,getInvestmentById:T}=(0,d.H)(),R=k.get("propertyId"),M=k.get("investmentId"),[D,O]=(0,o.useState)(p),[z,L]=(0,o.useState)(j),[$,B]=(0,o.useState)(!(p||j)),[U,_]=(0,o.useState)(1),[J,H]=(0,o.useState)({paymentMethod:"flutterwave",cardNumber:"",expiryDate:"",cvv:"",cardholderName:""}),[V,W]=(0,o.useState)(null),[Y,G]=(0,o.useState)("idle"),[Q,X]=(0,o.useState)(""),[Z,q]=(0,o.useState)(null),[K,ee]=(0,o.useState)(""),[te,se]=(0,o.useState)(!1),[oe,ne]=(0,o.useState)(null),[re,le]=(0,o.useState)(!1),[ie,ae]=(0,o.useState)(!1),de=(null===p||void 0===p?void 0:p.id)||(null===p||void 0===p?void 0:p.propertyId)||R,ce=(null===j||void 0===j?void 0:j.id)||M,me=k.get("type")||"purchase",ue=p||j?N:me,xe=Boolean(P),pe=(0,o.useCallback)(()=>{if("undefined"===typeof window)return;const e=v();if(!e||0===e.length)return;const t=e.find(e=>!(!oe||e.escrowId!==oe)||(!(null===D||void 0===D||!D.id||e.propertyId!==D.id)||!(null===z||void 0===z||!z.id||e.investmentId!==z.id)));t&&(W(t),G(t.status||"processing"),ee(t.checkoutUrl||""),t.escrowId&&ne(t.escrowId),_(e=>e<2?2:e))},[null===D||void 0===D?void 0:D.id,null===z||void 0===z?void 0:z.id,oe]);(0,o.useEffect)(()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: Component mounting..."),console.log("\ud83d\udd25 EscrowPaymentFlow: providedProperty:",p),console.log("\ud83d\udd25 EscrowPaymentFlow: providedInvestment:",j),p||j?(console.log("\ud83d\udd25 EscrowPaymentFlow: Data already provided, setting loading to false"),B(!1)):console.log("\ud83d\udd25 EscrowPaymentFlow: No data provided, will fetch from params")},[p,j]),(0,o.useEffect)(()=>{if(p||j)return void B(!1);return(async()=>{if(!de&&!ce)return m.Ay.error("No property or investment specified"),void I("/properties");if(!F){const e=de?`/escrow/create?propertyId=${de}&type=${ue}`:`/escrow/create?investmentId=${ce}&type=${ue}`;return localStorage.setItem("authRedirectUrl",e),m.Ay.error("Please login to continue"),void I("/")}E();try{if(de){const e=await S(de);e?O(e):(m.Ay.error("Property not found"),I("/properties"))}else if(ce){let t=T(ce);if(!t)try{const e=localStorage.getItem("pendingInvestmentProject");if(e){const s=JSON.parse(e);s.id.toString()===ce.toString()&&(t={id:s.id,investmentTitle:s.name,title:s.name,description:s.description,location:s.location,minInvestment:s.minInvestment,expectedROI:s.expectedROI,lockPeriod:s.lockPeriod,image:s.image,status:s.status||"active",type:s.type})}}catch(e){console.error("Error parsing stored project:",e)}t?L(t):(m.Ay.error("Investment not found"),I("/investment"))}}catch(e){console.error("Error loading item:",e),m.Ay.error("Failed to load item details"),I("/properties")}finally{B(!1)}})(),()=>{!j&&M&&localStorage.removeItem("pendingInvestmentProject")}},[de,ce,F,S,T,I,ue,E,p,j,M]),(0,o.useEffect)(()=>{pe()},[pe]),(0,o.useEffect)(()=>{if("undefined"===typeof window)return;const e=e=>{const{type:t,payload:s}=e.data||{};if("ESCROW_PAYMENT_STATUS"===t&&s&&(!s.escrowId||!oe||s.escrowId===oe))if("success"===s.status)G("completed"),X(""),g(s.paymentId),f(s.escrowId||oe,s.reference||s.txRef,"flutterwave"),ne(s.escrowId||oe),W(null),ee(""),m.Ay.success("Payment verified! Funds are now held securely in escrow.");else if("error"===s.status){G("failed");const e=s.message||"Payment verification failed. Please try again.";X(e),m.Ay.error(e)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[oe,m.Ay]),(0,o.useEffect)(()=>{"completed"===Y&&_(3)},[Y]),(0,o.useEffect)(()=>{p&&O(p)},[p]),(0,o.useEffect)(()=>{j&&L(j)},[j]);const ve=D||z,ye=D?D.price:(null===z||void 0===z?void 0:z.minInvestment)||(null===z||void 0===z?void 0:z.minimumInvestment)||0,he=Math.round(.005*(ye||0)),ge=(ye||0)+he,fe=D?D.title:(null===z||void 0===z?void 0:z.investmentTitle)||(null===z||void 0===z?void 0:z.title)||"Investment Purchase",we=e=>{e&&"undefined"!==typeof window?ae(!0):m.Ay.error("Checkout link unavailable. Please re-initialize payment.")},be=()=>{we(K)},je=async()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: handleProcessPayment called"),console.log("\ud83d\udd25 User:",F),console.log("\ud83d\udd25 Payment data:",J),console.log("\ud83d\udd25 Property:",D),console.log("\ud83d\udd25 Investment:",z);try{var e,t,s;if(!F||!F.id&&!F.uid)return void m.Ay.error("Please login to complete this transaction");if(console.log("\ud83d\udd25 EscrowPaymentFlow: Starting validation..."),"card"===J.paymentMethod){if(console.log("\ud83d\udd25 EscrowPaymentFlow: Validating card payment..."),console.log("\ud83d\udd25 EscrowPaymentFlow: Card details:",J),!J.cardNumber||!J.expiryDate||!J.cvv||!J.cardholderName)return console.log("\u274c EscrowPaymentFlow: Card validation failed"),void m.Ay.error("Please fill in all payment details")}else{if("test"===J.paymentMethod)return console.log("\ud83d\udd25 EscrowPaymentFlow: Using test payment method"),void(async()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: handleProcessTestPayment called");try{var e,t,s;if(!F||!F.id&&!F.uid)return void m.Ay.error("Please login to complete this transaction");B(!0),X("");const o=D||z?D?D.price:(null===z||void 0===z?void 0:z.minInvestment)||(null===z||void 0===z?void 0:z.minimumInvestment)||0:0,n=(D?D.title:(null===z||void 0===z?void 0:z.investmentTitle)||null===z||void 0===z||z.title,D?D.id:null===z||void 0===z?void 0:z.id);if(!n||!o||o<=0)return m.Ay.error("Invalid item or price"),void B(!1);const r=(null===D||void 0===D||null===(e=D.owner)||void 0===e?void 0:e.id)||(null===D||void 0===D?void 0:D.ownerId)||(null===z||void 0===z?void 0:z.vendorId)||(null===z||void 0===z?void 0:z.sponsorId)||null;console.log("\ud83d\udd25 EscrowPaymentFlow: Creating escrow transaction for test payment...");const l=await C(n,o,F.uid||F.id,r,{type:"investment"===ue?"investment":"property",investmentData:z?{...z,title:z.title||z.investmentTitle,investmentTitle:z.investmentTitle||z.title,expectedROI:z.expectedROI||z.expectedReturn||0,expectedReturn:z.expectedReturn||z.expectedROI||0,lockPeriod:z.lockPeriod||z.termMonths||z.duration||0,termMonths:z.termMonths||z.duration||z.lockPeriod||0,duration:z.duration||z.termMonths||z.lockPeriod||0,vendorId:z.vendorId||z.sponsorId,sponsorId:z.sponsorId||z.vendorId,sponsor:z.sponsor||z.vendor,vendor:z.vendor||z.sponsor,propertyLocation:z.propertyLocation||(null!==(t=z.location)&&void 0!==t&&t.address?`${z.location.address}, ${z.location.city}`:"N/A")}:null});if(!l.success)return m.Ay.error(l.error||"Failed to create escrow transaction"),void B(!1);const i=l.id||(null===(s=l.data)||void 0===s?void 0:s.id);if(!i)return m.Ay.error("Failed to get escrow transaction ID"),void B(!1);console.log("\u2705 EscrowPaymentFlow: Simulating test payment completion...");const a=`TEST_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;f(i,a,"test");const d={escrowId:i,paymentId:`test_${i}`,reference:a,txRef:a,propertyId:null===D||void 0===D?void 0:D.id,investmentId:null===z||void 0===z?void 0:z.id,status:"completed",checkoutUrl:"",storedAt:Date.now(),isTestPayment:!0};y(d),W(d),G("completed"),_(3),m.Ay.success("Test payment completed successfully!"),ce&&localStorage.setItem("pendingInvestmentProject",JSON.stringify(z)),B(!1)}catch(o){console.error("\u274c EscrowPaymentFlow: Test payment error:",o),m.Ay.error(`Test payment failed: ${o.message||"An error occurred"}`),B(!1)}})();console.log("\ud83d\udd25 EscrowPaymentFlow: Using Flutterwave payment, skipping card validation")}console.log("\ud83d\udd25 EscrowPaymentFlow: Setting loading state..."),B(!0),X("");const c=D||z;console.log("\ud83d\udd25 EscrowPaymentFlow: Current item:",c);const x=c?D?D.price:(null===z||void 0===z?void 0:z.minInvestment)||(null===z||void 0===z?void 0:z.minimumInvestment)||0:0,p=D?D.title:(null===z||void 0===z?void 0:z.investmentTitle)||(null===z||void 0===z?void 0:z.title)||"Investment",v=D?D.id:null===z||void 0===z?void 0:z.id;if(console.log("\ud83d\udd25 EscrowPaymentFlow: Item details:",{itemId:v,itemPriceValue:x,itemTitleValue:p}),!v||!x||x<=0)return console.log("\u274c EscrowPaymentFlow: Invalid item or price"),m.Ay.error("Invalid item or price"),void B(!1);const g=(null===D||void 0===D||null===(e=D.owner)||void 0===e?void 0:e.id)||(null===D||void 0===D?void 0:D.ownerId)||(null===z||void 0===z?void 0:z.vendorId)||(null===z||void 0===z?void 0:z.sponsorId)||null;console.log("\ud83d\udd25 EscrowPaymentFlow: Seller ID:",g),console.log("\ud83d\udd25 EscrowPaymentFlow: Creating escrow transaction...");const j=await C(v,x,F.uid||F.id,g,{type:"investment"===ue?"investment":"property",investmentData:z?{...z,title:z.title||z.investmentTitle,investmentTitle:z.investmentTitle||z.title,expectedROI:z.expectedROI||z.expectedReturn||0,expectedReturn:z.expectedReturn||z.expectedROI||0,lockPeriod:z.lockPeriod||z.termMonths||z.duration||0,termMonths:z.termMonths||z.duration||z.lockPeriod||0,duration:z.duration||z.termMonths||z.lockPeriod||0,vendorId:z.vendorId||z.sponsorId,sponsorId:z.sponsorId||z.vendorId,sponsor:z.sponsor||z.vendor,vendor:z.vendor||z.sponsor,propertyLocation:z.propertyLocation||(null!==(t=z.location)&&void 0!==t&&t.address?`${z.location.address}, ${z.location.city}`:"N/A")}:null});if(console.log("\ud83d\udd25 EscrowPaymentFlow: Escrow result:",j),!j.success)return m.Ay.error(j.error||"Failed to create escrow transaction"),void B(!1);const N=j.id||(null===(s=j.data)||void 0===s?void 0:s.id);if(!N)return m.Ay.error("Failed to get escrow transaction ID"),void B(!1);const P=h(F);if(!P)return m.Ay.error("Unable to determine authentication headers. Please login again."),void B(!1);ne(N);try{var o,n;le(!0),console.log("\ud83d\ude80 EscrowPaymentFlow: Starting payment initialization...");const e={amount:x,paymentMethod:"flutterwave",paymentType:"escrow",relatedEntity:{type:"investment"===ue?"investment":"property",id:N,metadata:{escrowId:N,propertyId:(null===D||void 0===D?void 0:D.id)||null,investmentId:(null===z||void 0===z?void 0:z.id)||null}},description:b(p,ue),currency:"NGN"};console.log("\ud83d\udd25 EscrowPaymentFlow: API Payload:",e),console.log("\ud83d\udd25 EscrowPaymentFlow: API URL:",(0,u.e9)("/payments/initialize")),console.log("\ud83d\udd25 EscrowPaymentFlow: Headers:",P),console.log("\ud83d\udd25 EscrowPaymentFlow: Cache busting with timestamp:",Date.now());const t=await fetch((0,u.e9)("/payments/initialize"),{method:"POST",headers:P,body:JSON.stringify(e),cache:"no-store"});console.log("\ud83d\udd25 EscrowPaymentFlow: Response status:",t.status);const s=await t.json();if(console.log("\ud83d\udd25 EscrowPaymentFlow: Response data:",s),!t.ok||!s.success){var r,l,i,a;const e=(null===(r=s.data)||void 0===r?void 0:r.providerData)||s.providerData||(null===(l=s.error)||void 0===l?void 0:l.providerData)||(null===(i=s.error)||void 0===i?void 0:i.meta)||{},t=s.message||(null===e||void 0===e?void 0:e.message)||(null===(a=s.error)||void 0===a?void 0:a.message)||"",o=[null===e||void 0===e?void 0:e.maximum_amount,null===e||void 0===e?void 0:e.maximumAmount,null===e||void 0===e?void 0:e.max_amount,null===e||void 0===e?void 0:e.maxAmount,null===e||void 0===e?void 0:e.max_charge,null===e||void 0===e?void 0:e.maxCharge].find(e=>Number.isFinite(Number(e)))||null;if(o)return q(Number(o)),X(`Charge amount must not exceed ${w(Number(o))}. Try Bank Transfer or split the payment.`),void le(!1);if(/exceed|maximum|max/i.test(t))return X(t||"Charge amount exceeds provider limit. Try another payment method."),void le(!1);throw new Error(s.message||"Failed to initialize payment")}const d=(null===(o=s.data)||void 0===o?void 0:o.providerData)||{},c=(null===(n=s.data)||void 0===n?void 0:n.payment)||s.data,v=d.authorizationUrl||d.link,h=d.txRef||d.tx_ref||(null===c||void 0===c?void 0:c.reference);if(!v)throw new Error("Payment authorization link missing from response");const g={escrowId:N,paymentId:null===c||void 0===c?void 0:c.id,reference:null===c||void 0===c?void 0:c.reference,txRef:h,propertyId:null===D||void 0===D?void 0:D.id,investmentId:null===z||void 0===z?void 0:z.id,status:"processing",checkoutUrl:v,storedAt:Date.now()};y(g),W(g),ee(v),G("processing"),_(2),we(v),m.Ay.success("Flutterwave checkout launched. Complete payment to proceed."),ce&&localStorage.setItem("pendingInvestmentProject",JSON.stringify(z))}catch(d){console.error("EscrowPaymentFlow: payment initialization error",d),X(d.message||"Unable to initialize payment."),m.Ay.error(d.message||"Failed to initialize payment")}finally{le(!1)}}catch(c){console.error("\u274c EscrowPaymentFlow: Payment error:",c),console.error("\u274c EscrowPaymentFlow: Error details:",c.message),console.error("\u274c EscrowPaymentFlow: Error stack:",c.stack),m.Ay.error(`Payment failed: ${c.message||"An error occurred"}`)}finally{B(!1)}};if($){const e=(0,x.jsx)("div",{className:"flex items-center justify-center w-full py-16",children:(0,x.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600"})});return xe?(0,x.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-6",children:e}):(0,x.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,x.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})}if(!D&&!z){const e=(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:de?"Property Not Found":"Investment Not Found"}),(0,x.jsx)("button",{onClick:()=>{xe&&P?P():I(de?"/properties":"/investment")},className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:de?"Back to Properties":"Back to Investments"})]});return xe?(0,x.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-6",children:e}):(0,x.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:e})}const Ne=(0,x.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,x.jsxs)("div",{className:"mb-8",children:[(0,x.jsxs)("button",{onClick:()=>{1!==U?_(e=>Math.max(1,e-1)):xe&&P?P():I(-1)},className:"flex items-center text-gray-600 hover:text-gray-800 mb-4",children:[(0,x.jsx)(c.QVr,{className:"mr-2"}),1===U?D?"Back to Property":"Back to Investment":"Previous Step"]}),(0,x.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:1===U?D?"Review Purchase":"Review Investment":2===U?"Payment Details":"Payment Confirmation"}),(0,x.jsx)("div",{className:"flex items-center space-x-4 mt-4",children:[1,2,3].map(e=>(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(U>=e?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:U>e?(0,x.jsx)(c.CMH,{}):e}),e<3&&(0,x.jsx)("div",{className:"w-16 h-1 mx-2 "+(U>e?"bg-blue-600":"bg-gray-200")})]},e))})]}),1===U&&(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:D?"Property Details":"Investment Details"}),(0,x.jsxs)("div",{className:"flex items-start space-x-4 mb-6",children:[(0,x.jsx)("img",{src:(null===ve||void 0===ve?void 0:ve.image)||(null===ve||void 0===ve||null===(t=ve.images)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.url)||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=200&h=150&fit=crop",alt:(null===ve||void 0===ve?void 0:ve.title)||(null===ve||void 0===ve?void 0:ve.investmentTitle)||(null===ve||void 0===ve?void 0:ve.name),className:"w-32 h-24 object-cover rounded-lg"}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-semibold text-gray-900",children:(null===ve||void 0===ve?void 0:ve.title)||(null===ve||void 0===ve?void 0:ve.investmentTitle)||(null===ve||void 0===ve?void 0:ve.name)}),(0,x.jsx)("p",{className:"text-gray-600",children:(null===ve||void 0===ve?void 0:ve.location)||"Location pending"}),(0,x.jsx)("p",{className:"text-sm text-gray-500 mt-1 line-clamp-3",children:(null===ve||void 0===ve?void 0:ve.description)||"Property description will be shared by the vendor."})]})]}),(0,x.jsxs)("div",{className:"space-y-3",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("span",{className:"text-gray-600",children:"Property Price"}),(0,x.jsx)("span",{className:"font-semibold text-gray-900",children:w(ye)})]}),(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("span",{className:"text-gray-600",children:"Escrow Protection Fee (0.5%)"}),(0,x.jsx)("span",{className:"font-semibold text-gray-900",children:w(he)})]}),(0,x.jsxs)("div",{className:"border-t border-gray-200 pt-3 flex items-center justify-between",children:[(0,x.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Total Due Today"}),(0,x.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:w(ge)})]})]})]}),(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Escrow Protection Benefits"}),(0,x.jsx)("div",{className:"space-y-4",children:[{title:"Secure Payment Holding",description:"Your funds stay in escrow until every milestone you approve is met."},{title:"Document Verification",description:"The team verifies title, inspection reports, and contract documents."},{title:"Dispute Resolution",description:"Dedicated mediation support with guaranteed refund safeguards."}].map(e=>(0,x.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,x.jsx)(c.JhU,{className:"text-blue-600 mt-1"}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-semibold text-gray-900",children:e.title}),(0,x.jsx)("p",{className:"text-gray-600 text-sm",children:e.description})]})]},e.title))}),(0,x.jsxs)("button",{onClick:()=>{_(2)},className:"w-full mt-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2",children:[(0,x.jsx)(c.AsH,{}),(0,x.jsx)("span",{children:"Continue to Payment"})]})]})]}),2===U&&(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-6",children:[(0,x.jsxs)("div",{className:"space-y-3",children:[(0,x.jsx)("label",{className:"block text-sm font-semibold text-gray-900",children:"Payment Method"}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,x.jsx)("button",{type:"button",onClick:()=>H(e=>({...e,paymentMethod:"flutterwave"})),className:"p-4 border-2 rounded-lg transition "+("flutterwave"===J.paymentMethod?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)(c.x1c,{className:"mx-auto text-xl mb-2 text-blue-600"}),(0,x.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:"Flutterwave"})]})}),(0,x.jsx)("button",{type:"button",onClick:()=>H(e=>({...e,paymentMethod:"test"})),className:"p-4 border-2 rounded-lg transition "+("test"===J.paymentMethod?"border-green-600 bg-green-50":"border-gray-200 hover:border-gray-300"),children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)(c.CMH,{className:"mx-auto text-xl mb-2 text-green-600"}),(0,x.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:"Test Payment"})]})})]})]}),"flutterwave"===J.paymentMethod&&(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Flutterwave Checkout"}),(0,x.jsx)("span",{className:"text-sm text-gray-500",children:"Secure \u2022 Encrypted \u2022 Instant"})]}),(0,x.jsx)("button",{type:"button",onClick:()=>{console.log("\ud83d\udd25 EscrowPaymentFlow: Button clicked!"),console.log("\ud83d\udd25 EscrowPaymentFlow: loading:",$),console.log("\ud83d\udd25 EscrowPaymentFlow: isInitializingPayment:",re),console.log("\ud83d\udd25 EscrowPaymentFlow: step:",U),je()},disabled:$||re,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70",children:re?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.x1c,{className:"animate-spin"}),(0,x.jsx)("span",{children:"Initializing Flutterwave..."})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.x1c,{}),(0,x.jsx)("span",{children:"Re-launch Flutterwave Checkout"})]})})]}),"test"===J.paymentMethod&&(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,x.jsx)("p",{className:"text-sm text-green-900 font-semibold",children:"Test Payment Mode"}),(0,x.jsx)("p",{className:"text-xs text-green-800 mt-1",children:"This will simulate a successful payment for testing purposes."})]}),(0,x.jsx)("button",{type:"button",onClick:()=>{H(e=>({...e,paymentMethod:"test"})),je()},disabled:$,className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70 hover:bg-green-700 transition",children:$?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.hW,{className:"animate-spin"}),(0,x.jsx)("span",{children:"Processing Test Payment..."})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.CMH,{}),(0,x.jsx)("span",{children:"Complete Test Payment"})]})})]}),K&&(0,x.jsx)("button",{type:"button",onClick:be,className:"w-full border border-blue-600 text-blue-600 py-3 rounded-lg font-semibold",children:"Open Checkout Window"}),V&&(0,x.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,x.jsx)("p",{className:"font-semibold text-blue-900",children:"Payment in progress"}),(0,x.jsxs)("p",{className:"text-sm text-blue-800 mt-1",children:["Reference: ",V.txRef||V.reference]}),(0,x.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"Please complete the Flutterwave checkout or click verify once done."}),(0,x.jsxs)("div",{className:"mt-4 flex flex-col gap-3",children:[(0,x.jsx)("button",{type:"button",onClick:async()=>{if(null===V||void 0===V||!V.id)return void m.Ay.error("No payment to verify. Please initialize checkout first.");const e=h(F);if(e){se(!0),X("");try{var t,s,o;const n=await fetch((0,u.e9)(`/payments/${V.id}/verify`),{method:"POST",headers:e,body:JSON.stringify({providerReference:V.txRef||(null===(t=V.metadata)||void 0===t||null===(s=t.flutterwave)||void 0===s?void 0:s.txRef)||V.reference,txRef:V.txRef||V.reference,status:Y})}),r=await n.json();if(!n.ok||!r.success)throw new Error(r.message||"Payment verification failed");const l=((null===(o=r.data)||void 0===o?void 0:o.status)||"").toLowerCase();if("completed"===l||"success"===l||"successful"===l)G("completed"),f(oe,V.reference||V.txRef,"flutterwave"),g(V.id),W(null),ee(""),m.Ay.success("Payment verified successfully!");else{if("processing"!==l&&"pending"!==l)throw G("failed"),new Error("Payment could not be verified. Please try another attempt.");G("processing"),(0,m.Ay)("Flutterwave is still processing this payment. Please try again shortly.")}}catch(n){console.error("EscrowPaymentFlow: manual verification error",n),X(n.message||"Unable to verify payment right now."),m.Ay.error(n.message||"Failed to verify payment")}finally{se(!1)}}else m.Ay.error("Please login again to verify payment.")},disabled:te,className:"w-full bg-green-600 text-white py-2 rounded-lg font-semibold flex items-center justify-center space-x-2 disabled:opacity-70",children:te?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.hW,{className:"animate-spin"}),(0,x.jsx)("span",{children:"Verifying..."})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.CMH,{}),(0,x.jsx)("span",{children:"Verify Payment"})]})}),(0,x.jsx)("button",{type:"button",onClick:be,className:"w-full border border-blue-600 text-blue-600 py-2 rounded-lg font-semibold",children:"Resume Payment"})]})]}),Q&&(0,x.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-3 text-sm",children:Q}),Z&&(0,x.jsx)("div",{className:"mt-3 text-sm text-gray-700",children:"Suggested actions: split the payment into smaller amounts, or use Bank Transfer which supports larger transfers."})]}),(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Payment Summary"}),(0,x.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,x.jsx)("span",{children:"Escrow for"}),(0,x.jsx)("span",{className:"font-medium text-gray-900",children:fe})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-gray-600",children:"Amount"}),(0,x.jsx)("span",{className:"font-semibold text-gray-900",children:w(ye)})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-gray-600",children:"Escrow Fee"}),(0,x.jsx)("span",{className:"font-semibold text-gray-900",children:w(he)})]}),(0,x.jsxs)("div",{className:"border-t border-gray-200 pt-4 flex justify-between items-center",children:[(0,x.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Total"}),(0,x.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:w(ge)})]})]})]}),3===U&&(0,x.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[(0,x.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,x.jsx)(c.CMH,{className:"text-green-600 text-2xl"})}),(0,x.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),(0,x.jsxs)("p",{className:"text-gray-600 mb-6",children:["Your payment of ",(0,x.jsx)("strong",{children:w(ge)})," is now held securely in escrow."]}),(0,x.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg mb-6 text-left",children:[(0,x.jsxs)("h3",{className:"font-semibold text-green-900 mb-3 flex items-center",children:[(0,x.jsx)(c.JhU,{className:"mr-2"}),"Escrow Protection Active"]}),(0,x.jsxs)("div",{className:"text-sm text-green-800 space-y-2",children:[(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(c.A7C,{className:"mr-2 text-green-600"}),(0,x.jsxs)("span",{children:[(0,x.jsx)("strong",{children:"Funds Secured:"})," Held until you approve release."]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(c.BAG,{className:"mr-2 text-green-600"}),(0,x.jsxs)("span",{children:[(0,x.jsx)("strong",{children:"Your Control:"})," Nothing moves without your authorization."]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(c.DDN,{className:"mr-2 text-green-600"}),(0,x.jsxs)("span",{children:[(0,x.jsx)("strong",{children:"Dispute Resolution:"})," Mediation + refund guarantees."]})]})]})]}),(0,x.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6 text-left",children:[(0,x.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"What happens next?"}),(0,x.jsxs)("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[(0,x.jsx)("li",{children:"Property documents verification begins immediately."}),(0,x.jsx)("li",{children:"Our escrow officer reaches out to schedule inspection."}),(0,x.jsx)("li",{children:"You approve the property condition and paperwork."}),(0,x.jsx)("li",{children:"Funds release only after your final approval."})]})]}),(0,x.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:space-x-4",children:[(0,x.jsx)("button",{onClick:()=>I("/escrow"),className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"View Escrow Status"}),(0,x.jsx)("button",{onClick:()=>{I("/dashboard")},className:"flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})]})]})})]});return xe?(0,x.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:[(0,x.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col overflow-hidden",children:[(0,x.jsx)("button",{onClick:P,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 z-10 bg-white rounded-full p-1 shadow-md hover:bg-gray-100","aria-label":"Close payment flow",children:(0,x.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,x.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:Ne})]}),ie&&K&&(0,x.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:(0,x.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full md:max-w-5xl lg:max-w-6xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Flutterwave Payment"}),(0,x.jsx)("button",{onClick:()=>ae(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-100 rounded-full p-2 hover:bg-gray-200 transition-colors","aria-label":"Close checkout",children:(0,x.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,x.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,x.jsx)("iframe",{src:K,title:"Flutterwave Checkout",className:"w-full h-[75vh] min-h-[640px] border-none",allow:"payment",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"})})]})})]}):(0,x.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[Ne,ie&&K&&(0,x.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:(0,x.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full md:max-w-5xl lg:max-w-6xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Flutterwave Payment"}),(0,x.jsx)("button",{onClick:()=>ae(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-100 rounded-full p-2 hover:bg-gray-200 transition-colors","aria-label":"Close checkout",children:(0,x.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,x.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,x.jsx)("iframe",{src:K,title:"Flutterwave Checkout",className:"w-full h-[75vh] min-h-[640px] border-none",allow:"payment",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"})})]})})]})}}}]);
//# sourceMappingURL=210.0394291e.chunk.js.map