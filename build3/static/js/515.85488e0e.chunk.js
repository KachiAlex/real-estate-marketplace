"use strict";(self.webpackChunkreal_estate_marketplace=self.webpackChunkreal_estate_marketplace||[]).push([[515],{2407:(e,t,s)=>{s.d(t,{A:()=>n});s(5043);var r=s(3216),a=s(5475),i=s(5369),l=s(579);const n=e=>{let{items:t}=e;const s=(0,r.zy)().pathname.split("/").filter(e=>e),n=t||[{label:"Home",path:"/"},...s.map((e,t)=>{const r=`/${s.slice(0,t+1).join("/")}`;return{label:e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),path:r}})];return(0,l.jsx)("nav",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-4","aria-label":"Breadcrumb",children:(0,l.jsx)("ol",{className:"flex items-center space-x-2",children:n.map((e,t)=>{const s=t===n.length-1;return(0,l.jsxs)("li",{className:"flex items-center",children:[0===t&&(0,l.jsx)(i.rQ8,{className:"h-4 w-4 text-gray-400 mr-2","aria-hidden":"true"}),s?(0,l.jsx)("span",{className:"text-gray-900 font-medium","aria-current":"page",children:e.label}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.N_,{to:e.path,className:"hover:text-blue-600 transition-colors","aria-label":`Navigate to ${e.label}`,children:e.label}),(0,l.jsx)(i.X6T,{className:"h-3 w-3 text-gray-400 mx-2","aria-hidden":"true"})]})]},e.path||t)})})})}},5032:(e,t,s)=>{s.d(t,{FH:()=>g,HK:()=>b,Ix:()=>h,o2:()=>y});var r=s(1692);const a="viewingRequests",i="inspectionActivityLog",l={totalRequests:0,pendingResponses:0,confirmed:0,vendorProposals:0,buyerReschedules:0,cancelledByBuyer:0,cancelledByVendor:0,timeline:[]},n=(e,t)=>{if("undefined"!==typeof window)if("storage"!==e)"function"===typeof window.dispatchEvent&&window.dispatchEvent(new CustomEvent(e,{detail:t}));else try{window.dispatchEvent(new StorageEvent("storage",t))}catch{window.dispatchEvent(new CustomEvent("storage",{detail:t}))}},o=()=>{try{return JSON.parse(localStorage.getItem(a)||"[]")}catch{return[]}},d=e=>{localStorage.setItem(a,JSON.stringify(e))},c=()=>{try{return JSON.parse(localStorage.getItem(i)||"[]")}catch{return[]}},m=(e,t)=>e||t?t?e?`${e} ${t}`:t:e:"",u=(e,t)=>{if(!e||!t)return;const s=((e,t)=>({action:e,requestId:t.id,propertyTitle:t.propertyTitle||t.projectTitle||t.projectName||t.title||"Property",buyerId:t.buyerId||t.userId,vendorId:t.vendorId,vendorEmail:t.vendorEmail,status:t.status,timestamp:(new Date).toISOString()}))(e,t),a=c();a.unshift(s),a.length>200&&a.pop(),(e=>{localStorage.setItem(i,JSON.stringify(e))})(a),n("inspectionActivity",s),n("inspectionAnalyticsUpdated",s);const l=((e,t,s)=>{const r=[],a=s.propertyTitle,i=t.buyerName||t.userName||"Buyer",l=t.vendorName||t.vendor||t.owner||"Vendor",n=m(t.preferredDate,t.preferredTime),o=m(t.confirmedDate,t.confirmedTime),d=m(t.proposedDate,t.proposedTime),c=(s,n)=>{(t.vendorId||t.vendorEmail)&&r.push({recipientId:t.vendorId,recipientEmail:t.vendorEmail,roles:["vendor"],type:e,title:s,message:n,priority:"medium",metadata:{requestId:t.id,propertyTitle:a,buyerName:i,vendorName:l}})},u=(s,n)=>{(t.buyerId||t.userId||t.buyerEmail||t.userEmail)&&r.push({recipientId:t.buyerId||t.userId,recipientEmail:t.buyerEmail||t.userEmail,roles:["buyer"],type:e,title:s,message:n,priority:"medium",metadata:{requestId:t.id,propertyTitle:a,buyerName:i,vendorName:l}})};switch(e){case"inspection_requested":c("New inspection request",`${i} requested to view ${a} ${n?`on ${n}`:""}`.trim());break;case"inspection_confirmed":u("Inspection confirmed",`${l} confirmed ${a} ${o?`for ${o}`:""}`.trim());break;case"vendor_proposed_new_time":u("Vendor proposed new time",`${l} suggested ${d||"another slot"} for ${a}`);break;case"buyer_rescheduled":c("Buyer requested new time",`${i} rescheduled ${a} ${n?`to ${n}`:""}`.trim());break;case"inspection_cancelled_by_buyer":c("Inspection cancelled by buyer",`${i} cancelled ${a}`);break;case"inspection_cancelled_by_vendor":u("Inspection cancelled by vendor",`${l} cancelled ${a}`);break;case"inspection_declined":u("Inspection declined",`${l} declined the request for ${a}`)}return r})(e,t,s);l.length&&(n("inspectionNotification",{action:e,payload:s,notifications:l,request:t}),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length||"undefined"===typeof window)return;const t=e.filter(e=>e.recipientId).map(e=>{var t;return{recipientId:e.recipientId,type:e.type,title:e.title,message:e.message,priority:e.priority||"medium",metadata:{...e.metadata||{},source:(null===(t=e.metadata)||void 0===t?void 0:t.source)||"inspection_client_sync"},data:e.metadata||{}}});t.length&&r.A.createInspectionNotifications(t).then(e=>{null!==e&&void 0!==e&&e.success||console.warn("Failed to persist inspection notifications",e)}).catch(e=>{console.error("Error persisting inspection notifications:",e)})}(l))},x=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=((null===t||void 0===t?void 0:t.status)||s.status||"").toLowerCase();if(!r&&(s.proposedDate||s.proposedTime))return"vendor_proposed_new_time";switch(r){case"accepted":case"confirmed":return"inspection_confirmed";case"proposed_new_time":return"vendor_proposed_new_time";case"buyer_rescheduled":return"buyer_rescheduled";case"cancelled_by_buyer":return"inspection_cancelled_by_buyer";case"cancelled_by_vendor":return"inspection_cancelled_by_vendor";case"declined":return"inspection_declined";default:return e&&e.status!==(null===t||void 0===t?void 0:t.status)?`inspection_status_${(null===t||void 0===t?void 0:t.status)||"updated"}`:null}},p=(e,t,s)=>!(!t&&!s)&&(t&&(null===e||void 0===e?void 0:e.vendorId)===t||s&&(null===e||void 0===e?void 0:e.vendorEmail)===s),g=function(){let{role:e="buyer",userId:t,vendorId:s,vendorEmail:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("undefined"===typeof window)return{...l};if("buyer"===e&&!t)return{...l};if("vendor"===e&&!s&&!r)return{...l};const a=o().filter(a=>{return"buyer"===e?(i=a,!!(l=t)&&((null===i||void 0===i?void 0:i.buyerId)===l||(null===i||void 0===i?void 0:i.userId)===l)):p(a,s||a.vendorId,r);var i,l}),i={totalRequests:a.length,pendingResponses:0,confirmed:0,vendorProposals:0,buyerReschedules:0,cancelledByBuyer:0,cancelledByVendor:0,timeline:[]},n=["pending","pending_vendor","pending_vendor_confirmation"],d=c();a.forEach(e=>{const t=(e.status||"").toLowerCase();n.includes(t)&&(i.pendingResponses+=1),["accepted","confirmed"].includes(t)&&(i.confirmed+=1),"proposed_new_time"===t&&(i.vendorProposals+=1),"buyer_rescheduled"===t&&(i.buyerReschedules+=1),"cancelled_by_buyer"===t&&(i.cancelledByBuyer+=1),["cancelled_by_vendor","declined"].includes(t)&&(i.cancelledByVendor+=1)});const m=Array.from({length:7}).map((a,i)=>{const l=new Date;l.setDate(l.getDate()-(6-i));const n=l.toISOString().slice(0,10),o=d.filter(a=>{return(a=>"buyer"===e?(null===a||void 0===a?void 0:a.buyerId)===t:p(a,s,r))(a)&&((i=a.timestamp)?new Date(i):new Date).toISOString().slice(0,10)===n;var i}).length;return{date:n,count:o}});return i.timeline=m,i},h=async e=>{try{console.log("Using localStorage for creating inspection requests (API unavailable)");const t=o(),s={id:`viewing-${Date.now()}`,...e,createdAt:(new Date).toISOString(),status:"pending"};return t.push(s),d(t),n("viewingsUpdated",{viewingRequest:s,action:"created"}),n("storage",{key:a,newValue:JSON.stringify(t)}),u("inspection_requested",s),s}catch(t){console.error("Error creating inspection request:",t);const s=o(),r={id:`viewing-${Date.now()}`,...e,createdAt:(new Date).toISOString(),status:"pending"};return s.push(r),d(s),n("viewingsUpdated",{viewingRequest:r,action:"created"}),n("storage",{key:a,newValue:JSON.stringify(s)}),u("inspection_requested",r),r}},y=async(e,t)=>{try{console.log("Using localStorage for inspection requests (API unavailable)");const s=o().filter(s=>e&&s.vendorId===e||t&&s.vendorEmail===t);return s.sort((e,t)=>new Date(t.createdAt||0)-new Date(e.createdAt||0)),s}catch(s){console.error("Error listing inspection requests:",s);return o().filter(s=>e&&s.vendorId===e||t&&s.vendorEmail===t).sort((e,t)=>new Date(t.createdAt||0)-new Date(e.createdAt||0))}},b=async(e,t)=>{try{console.log("Using localStorage for updating inspection requests (API unavailable)");const s=o();let r=null;const i=s.map(s=>s.id===e?(r={...s,...t,updatedAt:(new Date).toISOString()},r):s);if(!r)return d(s),!1;d(i),n("viewingsUpdated",{requestId:e,updates:t,action:"updated"}),n("storage",{key:a,newValue:JSON.stringify(i)});const l=x(s.find(t=>t.id===e),r,t);return l&&u(l,r),!0}catch(s){console.error("Error updating inspection request:",s);const r=o();let i=null;const l=r.map(s=>s.id===e?(i={...s,...t,updatedAt:(new Date).toISOString()},i):s);if(!i)return d(r),!1;d(l),n("viewingsUpdated",{requestId:e,updates:t,action:"updated"}),n("storage",{key:a,newValue:JSON.stringify(l)});const c=x(r.find(t=>t.id===e),i,t);return c&&u(c,i),!0}}},5515:(e,t,s)=>{s.r(t),s.d(t,{default:()=>S});var r=s(5043),a=s(3216),i=s(5016),l=s(4345),n=s(6471),o=s(5369),d=s(1876),c=s(6809),m=s(579);const u=e=>{let{isOpen:t,onClose:s,amount:a=5e4,propertyTitle:i,onPaymentSuccess:l,onPaymentError:n}=e;const[d,c]=(0,r.useState)("details"),[u,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[h,y]=(0,r.useState)("card"),[b,v]=(0,r.useState)({email:"",cardNumber:"",expiry:"",cvv:"",cardName:"",accountName:"",bankName:"",transferReference:""});(0,r.useEffect)(()=>{t&&(c("details"),x(!1),g(!1),v({email:"",cardNumber:"",expiry:"",cvv:"",cardName:"",accountName:"",bankName:"",transferReference:""}),y("card"))},[t]);const f=e=>(e.replace(/\s/g,"").match(/.{1,4}/g)||[]).join(" "),j=e=>{const t=e.replace(/\D/g,"");return t.length>=2?t.slice(0,2)+"/"+t.slice(2,4):t},N=e=>{const{name:t,value:s}=e.target;v("cardNumber"===t?e=>({...e,[t]:f(s)}):"expiry"===t?e=>({...e,[t]:j(s)}):e=>({...e,[t]:s}))},w=()=>{(p||window.confirm("Are you sure you want to cancel this payment?"))&&s()};return t?(0,m.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,m.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:w}),(0,m.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,m.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-lg",children:(0,m.jsxs)("div",{className:"flex justify-between items-start",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-xl font-bold",children:"Property Verification Payment"}),(0,m.jsx)("p",{className:"text-blue-100 text-sm mt-1",children:i||"Property Verification"})]}),(0,m.jsx)("button",{onClick:w,className:"text-white hover:text-blue-200 transition-colors",children:(0,m.jsx)(o.QCr,{size:20})})]})}),(0,m.jsxs)("div",{className:"p-6",children:["details"===d&&(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),b.email){if("card"===h){if(!b.cardNumber||!b.expiry||!b.cvv)return void alert("Please fill in all card details")}else if("transfer"===h&&(!b.accountName||!b.bankName||!b.transferReference))return void alert("Please fill in all transfer details");x(!0),c("processing"),setTimeout(()=>{x(!1),c("success"),g(!0);const e="card"===h?"CARD_"+Date.now():"TRANSFER_"+Date.now();l&&l({reference:e,amount:a,method:h,status:"successful",timestamp:(new Date).toISOString()})},"card"===h?2e3:1500)}else alert("Please fill in your email address")},className:"space-y-4",children:[(0,m.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[(0,m.jsx)("p",{className:"text-sm text-gray-600",children:"Payment Amount"}),(0,m.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20a6",a.toLocaleString()]}),(0,m.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Property Verification Fee"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,m.jsxs)("button",{type:"button",onClick:()=>y("card"),className:"p-3 border rounded-lg text-sm font-medium transition-colors "+("card"===h?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-gray-400"),children:[(0,m.jsx)(o.x1c,{className:"inline mr-2"}),"Card Payment"]}),(0,m.jsxs)("button",{type:"button",onClick:()=>y("transfer"),className:"p-3 border rounded-lg text-sm font-medium transition-colors "+("transfer"===h?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-gray-400"),children:[(0,m.jsx)("span",{className:"inline mr-2",children:"\ud83c\udfe6"}),"Bank Transfer"]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,m.jsx)("input",{type:"email",name:"email",value:b.email,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"your@email.com",required:!0})]}),"card"===h&&(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number"}),(0,m.jsx)("input",{type:"text",name:"cardNumber",value:b.cardNumber,onChange:N,maxLength:19,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1234 5678 9012 3456",required:!0})]}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),(0,m.jsx)("input",{type:"text",name:"expiry",value:b.expiry,onChange:N,maxLength:5,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"MM/YY",required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CVV"}),(0,m.jsx)("input",{type:"text",name:"cvv",value:b.cvv,onChange:N,maxLength:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"123",required:!0})]})]})]}),"transfer"===h&&(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,m.jsx)("h4",{className:"font-semibold text-blue-900 mb-2",children:"Bank Transfer Details"}),(0,m.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Bank:"})," Test Bank PLC"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Account Name:"})," PropertyArk Verification"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Account Number:"})," 1234567890"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Amount:"})," \u20a6",a.toLocaleString()]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Your Account Name"}),(0,m.jsx)("input",{type:"text",name:"accountName",value:b.accountName,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John Doe",required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),(0,m.jsx)("input",{type:"text",name:"bankName",value:b.bankName,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your Bank Name",required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transfer Reference/Transaction ID"}),(0,m.jsx)("input",{type:"text",name:"transferReference",value:b.transferReference,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Transaction ID from your bank",required:!0})]})]}),(0,m.jsxs)("div",{className:"flex items-center text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:[(0,m.jsx)(o.JhU,{className:"text-blue-600 mr-2"}),(0,m.jsx)("span",{children:"Your payment information is secure and encrypted"})]}),(0,m.jsxs)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center",children:[(0,m.jsx)(o.x1c,{className:"mr-2"}),"Pay \u20a6",a.toLocaleString()]})]}),"processing"===d&&(0,m.jsxs)("div",{className:"text-center py-8",children:[(0,m.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4",children:(0,m.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Processing Payment"}),(0,m.jsx)("p",{className:"text-gray-600",children:"Please wait while we process your payment..."})]}),"success"===d&&(0,m.jsxs)("div",{className:"text-center py-8",children:[(0,m.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:(0,m.jsx)(o.A7C,{className:"text-green-600 text-2xl"})}),(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Payment Successful!"}),(0,m.jsx)("p",{className:"text-gray-600 mb-4",children:"Your property verification payment has been processed successfully."}),(0,m.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg text-sm",children:[(0,m.jsxs)("p",{className:"text-gray-600",children:["Payment Reference: ",(0,m.jsxs)("span",{className:"font-mono font-semibold",children:["PAY_",Date.now()]})]}),(0,m.jsxs)("p",{className:"text-gray-600",children:["Amount: ",(0,m.jsxs)("span",{className:"font-semibold",children:["\u20a6",a.toLocaleString()]})]})]}),(0,m.jsx)("button",{onClick:w,className:"mt-6 w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Continue"})]})]})]})]})}):null},x=e=>{var t;let{property:s,onClose:a,onSuccess:l}=e;const{user:n}=(0,i.As)(),[x,p]=(0,r.useState)(!1),[g,h]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[v,f]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null),[C,S]=(0,r.useState)(!1),[A,I]=(0,r.useState)(null),[P,_]=(0,r.useState)(!0),[q,D]=(0,r.useState)({propertyName:"",propertyUrl:"",propertyLocation:"",message:"",preferredBadgeColor:"#10B981"});(0,r.useEffect)(()=>{if(!s)return;const e=(()=>{const e=s.location;if(!e)return"";if("string"===typeof e)return e;return[e.address,e.city,e.state].filter(Boolean).join(", ")})(),t=()=>{if(null!==s&&void 0!==s&&s.shareUrl||null!==s&&void 0!==s&&s.listingUrl)return s.shareUrl||s.listingUrl;const e="https://real-estate-marketplace-37544.web.app",t=(null===s||void 0===s?void 0:s.id)||(null===s||void 0===s?void 0:s._id),r=(null===s||void 0===s?void 0:s.title)||(null===s||void 0===s?void 0:s.name)||"property";if(t){return`${e}/property/${t}/${r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}`}return`${e}/properties`};D(r=>({...r,propertyName:s.title||s.name||r.propertyName,propertyUrl:t(),propertyLocation:e||r.propertyLocation}))},[s]),(0,r.useEffect)(()=>{(async()=>{try{_(!0);const e=await fetch((0,d.e9)("/verification/config")),t=await e.json();if(!e.ok||!t.success)throw new Error(t.message||"Unable to load verification configuration");I(t.data),D(e=>{var s;return{...e,preferredBadgeColor:(null===(s=t.data)||void 0===s?void 0:s.verificationBadgeColor)||e.preferredBadgeColor}})}catch(e){console.warn("PropertyVerification: failed to load config",e),I({verificationFee:5e4,currency:"NGN",supportedDocuments:["title_deed","survey_plan","building_approval","tax_clearance"],processingTime:"3-5 business days"})}finally{_(!1)}})()},[]);const V=(0,r.useMemo)(()=>(null===A||void 0===A?void 0:A.verificationFee)||5e4,[null===A||void 0===A?void 0:A.verificationFee]),E=e=>{const{name:t,value:s}=e.target;D(e=>({...e,[t]:s}))},R=q.preferredBadgeColor||"#10B981";return P?(0,m.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,m.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 text-center",children:[(0,m.jsx)(o.hW,{className:"animate-spin text-blue-600 text-4xl mx-auto mb-4"}),(0,m.jsx)("h3",{className:"text-lg font-semibold",children:"Loading Verification"}),(0,m.jsx)("p",{className:"text-gray-600",children:"Please wait..."})]})})}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,m.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:a}),(0,m.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,m.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-lg",children:(0,m.jsxs)("div",{className:"flex justify-between items-start",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("h3",{className:"text-xl font-bold flex items-center",children:[(0,m.jsx)(o.SMR,{className:"mr-2"}),"Property Verification"]}),(0,m.jsx)("p",{className:"text-blue-100 text-sm mt-1",children:"Get your property verified with the PropertyArk trust badge"})]}),(0,m.jsx)("button",{onClick:a,className:"text-white hover:text-blue-200 transition-colors",children:(0,m.jsx)(o.QCr,{size:20})})]})}),(0,m.jsx)("div",{className:"p-6",children:y?(0,m.jsxs)("div",{className:"text-center py-8",children:[(0,m.jsx)(o.A7C,{className:"text-green-600 text-5xl mx-auto mb-4"}),(0,m.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Success!"}),(0,m.jsx)("p",{className:"text-gray-600 mb-6",children:y}),j&&!C&&(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,m.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Review Your Details"}),(0,m.jsxs)("div",{className:"text-left space-y-2 text-sm text-blue-800",children:[(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Property:"})," ",q.propertyName]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Location:"})," ",q.propertyLocation]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Payment Reference:"})," ",null===w||void 0===w?void 0:w.reference]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Amount:"})," \u20a6",null===w||void 0===w||null===(t=w.amount)||void 0===t?void 0:t.toLocaleString()]})]})]}),(0,m.jsxs)("div",{className:"flex space-x-3 justify-center",children:[(0,m.jsxs)("button",{onClick:async()=>{if(w)if(n&&(n.id||n.uid)){S(!0),h("");try{const t=localStorage.getItem("token")||localStorage.getItem("firebaseToken");console.log("DEBUG: Verification submission",{hasToken:!!t,tokenLength:null===t||void 0===t?void 0:t.length,userEmail:null===n||void 0===n?void 0:n.email,userId:null===n||void 0===n?void 0:n.uid});const r={propertyId:null===s||void 0===s?void 0:s.id,propertyName:q.propertyName||(null===s||void 0===s?void 0:s.title),propertyUrl:q.propertyUrl||(null===s||void 0===s?void 0:s.propertyUrl),propertyLocation:q.propertyLocation||(null===s||void 0===s?void 0:s.location),message:q.message,preferredBadgeColor:q.preferredBadgeColor,paymentReference:w.reference,paymentAmount:w.amount,paymentStatus:"completed"},i=await(0,c.Ud)((0,d.e9)("/verification/applications"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.message||"Failed to submit verification application")}{const t=await i.json();if(console.log("PropertyVerification: Application submitted successfully",t),null!==s&&void 0!==s&&s.id){var e;const r=JSON.parse(localStorage.getItem("propertyVerificationStatus")||"{}");r[s.id]={status:"requested",requestedAt:(new Date).toISOString(),applicationId:null===(e=t.data)||void 0===e?void 0:e.applicationId},localStorage.setItem("propertyVerificationStatus",JSON.stringify(r))}l&&l({...t,propertyId:null===s||void 0===s?void 0:s.id,status:"requested"}),b("\u2705 Verification request submitted successfully! Your property is now under review."),setTimeout(()=>{a()},2e3)}}catch(g){console.error("PropertyVerification: Error submitting application",g),h(g.message||"Failed to submit verification application. Please try again.")}finally{S(!1)}}else h("Please login to submit verification request");else h("No payment data found. Please complete payment first.")},className:"px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center",children:[(0,m.jsx)(o.A7C,{className:"mr-2"}),"Submit Verification Request"]}),(0,m.jsx)("button",{onClick:()=>f(!1),className:"px-6 py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition-colors",children:"Cancel"})]})]}),C&&(0,m.jsxs)("div",{className:"flex items-center justify-center",children:[(0,m.jsx)(o.hW,{className:"animate-spin text-blue-600 text-2xl mr-3"}),(0,m.jsx)("span",{className:"text-gray-600",children:"Submitting verification request..."})]})]}):(0,m.jsxs)("form",{onSubmit:e=>{e.preventDefault(),q.propertyName&&q.propertyUrl&&q.propertyLocation?(f(!0),h("")):h("Please fill in all required fields")},className:"space-y-6",children:[g&&(0,m.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center",children:[(0,m.jsx)(o.BS8,{className:"text-red-600 mr-3"}),(0,m.jsx)("span",{className:"text-red-800",children:g})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Name *"}),(0,m.jsx)("input",{type:"text",name:"propertyName",value:q.propertyName,onChange:E,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property URL *"}),(0,m.jsx)("input",{type:"url",name:"propertyUrl",value:q.propertyUrl,onChange:E,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"https://...",readOnly:!0}),(0,m.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u2705 Auto-generated from property details"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Location *"}),(0,m.jsx)("input",{type:"text",name:"propertyLocation",value:q.propertyLocation,onChange:E,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City, State",required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Message"}),(0,m.jsx)("textarea",{name:"message",value:q.message,onChange:E,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional information about the property..."})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Badge Color"}),(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-gray-300",style:{backgroundColor:R}}),(0,m.jsx)("span",{className:"text-sm text-gray-600",children:"Preview of your verification badge"})]})]}),(0,m.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-900",children:"Verification Fee"}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:"One-time payment for property verification"})]}),(0,m.jsxs)("div",{className:"text-right",children:[(0,m.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20a6",V.toLocaleString()]}),(0,m.jsxs)("p",{className:"text-xs text-gray-500",children:["Processing time: ",(null===A||void 0===A?void 0:A.processingTime)||"3-5 business days"]})]})]})}),(0,m.jsx)("button",{type:"submit",disabled:x,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:x?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(o.hW,{className:"animate-spin mr-2"}),"Processing..."]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(o.x1c,{className:"mr-2"}),"Pay \u20a6",V.toLocaleString()," for Verification"]})})]})})]})]})}),(0,m.jsx)(u,{isOpen:v,onClose:()=>f(!1),amount:V,propertyTitle:q.propertyName,onPaymentSuccess:async e=>{console.log("PropertyVerification: Payment successful",e),N(!0),b("\u2705 Payment completed successfully! Please review your details and submit the verification request."),k(e)},onPaymentError:e=>{console.error("PropertyVerification: Payment failed",e),h("Payment failed. Please try again.")}})]})},p=e=>{if(!e)return null;try{return JSON.parse(localStorage.getItem("propertyVerificationStatus")||"{}")[e]||null}catch(t){return console.error("Error getting verification status:",t),null}},g=e=>{const t=p(e);return"requested"===(null===t||void 0===t?void 0:t.status)},h=e=>{const t=p(e);return"approved"===(null===t||void 0===t?void 0:t.status)};var y=s(5032),b=s(3768);const v=()=>{const{user:e}=(0,i.As)(),[t,s]=(0,r.useState)([]),[a,l]=(0,r.useState)(null),[n,d]=(0,r.useState)(!0),[c,u]=(0,r.useState)(!1),[x,p]=(0,r.useState)(null),[g,h]=(0,r.useState)("accept"),[v,f]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[w,k]=(0,r.useState)("");(0,r.useEffect)(()=>{C()},[e]),(0,r.useEffect)(()=>{if((null===e||void 0===e||!e.id)&&(null===e||void 0===e||!e.email))return void l(null);l((0,y.FH)({role:"vendor",vendorId:null===e||void 0===e?void 0:e.id,vendorEmail:null===e||void 0===e?void 0:e.email}));const t=t=>{const s=t.detail||t;null!==s&&void 0!==s&&s.vendorId&&s.vendorId!==(null===e||void 0===e?void 0:e.id)||l((0,y.FH)({role:"vendor",vendorId:null===e||void 0===e?void 0:e.id,vendorEmail:null===e||void 0===e?void 0:e.email}))};return window.addEventListener("inspectionAnalyticsUpdated",t),()=>window.removeEventListener("inspectionAnalyticsUpdated",t)},[null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.email]);const C=async()=>{try{d(!0);const t=await(0,y.o2)(null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.email);s(t),(null!==e&&void 0!==e&&e.id||null!==e&&void 0!==e&&e.email)&&l((0,y.FH)({role:"vendor",vendorId:null===e||void 0===e?void 0:e.id,vendorEmail:null===e||void 0===e?void 0:e.email}))}catch(t){console.error("Error loading inspection requests:",t),b.Ay.error("Failed to load inspection requests")}finally{d(!1)}},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"accept";p(e),u(!0),f(e.preferredDate),N(e.preferredTime),k(""),h(t)},A=e=>{const t={pending_vendor:{color:"bg-yellow-100 text-yellow-800",text:"Pending Response"},accepted:{color:"bg-green-100 text-green-800",text:"Accepted"},proposed_new_time:{color:"bg-blue-100 text-blue-800",text:"New Time Proposed"},declined:{color:"bg-red-100 text-red-800",text:"Declined"},buyer_rescheduled:{color:"bg-purple-100 text-purple-800",text:"Buyer Rescheduled"},cancelled_by_buyer:{color:"bg-gray-200 text-gray-700",text:"Cancelled by Buyer"},cancelled_by_vendor:{color:"bg-gray-200 text-gray-700",text:"Cancelled by You"}},s=t[e]||t.pending_vendor;return(0,m.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:s.text})},I=(e,t)=>{if(!e||!t)return"Not specified";try{const s=new Date(`${e}T${t}`);return s.toLocaleDateString()+" at "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return`${e} at ${t}`}};return n?(0,m.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,m.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,m.jsx)("span",{className:"ml-2",children:"Loading inspection requests..."})]}):(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Property Viewing Requests"}),(0,m.jsx)("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh"})]}),a&&(0,m.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,m.jsxs)("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4",children:[(0,m.jsx)("p",{className:"text-sm text-blue-600",children:"Pending Responses"}),(0,m.jsx)("p",{className:"text-3xl font-semibold text-blue-900",children:a.pendingResponses})]}),(0,m.jsxs)("div",{className:"bg-green-50 border border-green-100 rounded-xl p-4",children:[(0,m.jsx)("p",{className:"text-sm text-green-600",children:"Confirmed"}),(0,m.jsx)("p",{className:"text-3xl font-semibold text-green-900",children:a.confirmed})]}),(0,m.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-xl p-4",children:[(0,m.jsx)("p",{className:"text-sm text-purple-600",children:"Buyer Reschedules"}),(0,m.jsx)("p",{className:"text-3xl font-semibold text-purple-900",children:a.buyerReschedules})]}),(0,m.jsxs)("div",{className:"bg-red-50 border border-red-100 rounded-xl p-4",children:[(0,m.jsx)("p",{className:"text-sm text-red-600",children:"Buyer Cancellations"}),(0,m.jsx)("p",{className:"text-3xl font-semibold text-red-900",children:a.cancelledByBuyer})]})]}),0===t.length?(0,m.jsxs)("div",{className:"text-center py-12",children:[(0,m.jsx)(o.itz,{className:"mx-auto text-4xl text-gray-400 mb-4"}),(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No viewing requests yet"}),(0,m.jsx)("p",{className:"text-gray-500",children:"When buyers request to view your properties, they will appear here."})]}):(0,m.jsx)("div",{className:"grid gap-6",children:t.map(e=>(0,m.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[(0,m.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.propertyTitle||e.projectName}),(0,m.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[(0,m.jsx)(o.vq8,{className:"mr-2"}),e.propertyLocation||e.projectLocation]}),(0,m.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,m.jsx)(o.x$1,{className:"mr-2"}),e.buyerName||e.userName]})]}),(0,m.jsx)("div",{className:"ml-4",children:A(e.status)})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,m.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,m.jsx)(o.itz,{className:"mr-2"}),(0,m.jsxs)("span",{children:["Requested: ",I(e.preferredDate,e.preferredTime)]})]}),e.confirmedDate&&e.confirmedTime&&(0,m.jsxs)("div",{className:"flex items-center text-sm text-green-600",children:[(0,m.jsx)(o.A7C,{className:"mr-2"}),(0,m.jsxs)("span",{children:["Confirmed: ",I(e.confirmedDate,e.confirmedTime)]})]}),e.proposedDate&&e.proposedTime&&"proposed_new_time"===e.status&&(0,m.jsxs)("div",{className:"flex items-center text-sm text-blue-600",children:[(0,m.jsx)(o.bfZ,{className:"mr-2"}),(0,m.jsxs)("span",{children:["Proposed: ",I(e.proposedDate,e.proposedTime)]})]})]}),e.message&&(0,m.jsx)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:(0,m.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,m.jsx)("strong",{children:"Buyer's message:"})," ",e.message]})}),e.vendorMessage&&(0,m.jsx)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:(0,m.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,m.jsx)("strong",{children:"Your response:"})," ",e.vendorMessage]})}),e.buyerMessage&&(0,m.jsx)("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg",children:(0,m.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,m.jsx)("strong",{children:"Buyer update:"})," ",e.buyerMessage]})}),(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,m.jsxs)("span",{className:"flex items-center",children:[(0,m.jsx)(o.Cab,{className:"mr-1"}),e.buyerPhone||"Not provided"]}),(0,m.jsxs)("span",{className:"flex items-center",children:[(0,m.jsx)(o.maD,{className:"mr-1"}),e.buyerEmail||e.userEmail]})]}),"pending_vendor"===e.status&&(0,m.jsx)("button",{onClick:()=>S(e),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Respond"}),"buyer_rescheduled"===e.status&&(0,m.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,m.jsx)("button",{onClick:()=>(async e=>{await(0,y.HK)(e.id,{status:"accepted",confirmedDate:e.preferredDate,confirmedTime:e.preferredTime,vendorMessage:"Buyer reschedule accepted"})?(b.Ay.success("Rescheduled inspection confirmed"),C()):b.Ay.error("Failed to confirm reschedule")})(e),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Accept New Time"}),(0,m.jsx)("button",{onClick:()=>S(e,"propose"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Propose Another Time"})]}),"accepted"===e.status&&(0,m.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,m.jsx)("button",{onClick:()=>S(e,"propose"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reschedule"}),(0,m.jsx)("button",{onClick:()=>(async e=>{if(!window.confirm("Cancel this inspection? The buyer will be notified."))return;await(0,y.HK)(e.id,{status:"cancelled_by_vendor",vendorMessage:"Vendor cancelled the appointment",cancelledAt:(new Date).toISOString()})?(b.Ay.success("Inspection cancelled"),C()):b.Ay.error("Failed to cancel inspection")})(e),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Cancel"})]}),"cancelled_by_buyer"===e.status&&(0,m.jsx)("span",{className:"text-sm text-gray-500",children:"Buyer cancelled this appointment"}),"cancelled_by_vendor"===e.status&&(0,m.jsx)("span",{className:"text-sm text-gray-500",children:"You cancelled this appointment"})]})]},e.id))}),c&&x&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Respond to Viewing Request"}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Response Type"}),(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsxs)("label",{className:"flex items-center",children:[(0,m.jsx)("input",{type:"radio",value:"accept",checked:"accept"===g,onChange:e=>h(e.target.value),className:"mr-2"}),"Accept as requested"]}),(0,m.jsxs)("label",{className:"flex items-center",children:[(0,m.jsx)("input",{type:"radio",value:"propose",checked:"propose"===g,onChange:e=>h(e.target.value),className:"mr-2"}),"Propose different time"]}),(0,m.jsxs)("label",{className:"flex items-center",children:[(0,m.jsx)("input",{type:"radio",value:"decline",checked:"decline"===g,onChange:e=>h(e.target.value),className:"mr-2"}),"Decline request"]})]})]}),"propose"===g&&(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proposed Date"}),(0,m.jsx)("input",{type:"date",value:v,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proposed Time"}),(0,m.jsx)("input",{type:"time",value:j,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message (Optional)"}),(0,m.jsx)("textarea",{value:w,onChange:e=>k(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add a personal message..."})]})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,m.jsx)("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,m.jsx)("button",{onClick:async()=>{if(x)try{let e={};if("accept"===g)e={status:"accepted",confirmedDate:x.preferredDate,confirmedTime:x.preferredTime,vendorMessage:w||"Viewing confirmed. Looking forward to showing you the property!"};else if("propose"===g){if(!v||!j)return void b.Ay.error("Please select a proposed date and time");e={status:"proposed_new_time",proposedDate:v,proposedTime:j,vendorMessage:w||"I would like to propose a different time. Please let me know if this works for you."}}else"decline"===g&&(e={status:"declined",vendorMessage:w||"Unfortunately, I am not available at the requested time."});await(0,y.HK)(x.id,e)?(b.Ay.success("Request "+("accept"===g?"accepted":"propose"===g?"updated with new time":"declined")),u(!1),p(null),C()):b.Ay.error("Failed to update request")}catch(e){console.error("Error updating request:",e),b.Ay.error("Failed to update request")}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Submit Response"})]})]})})]})},f=()=>{const{notifications:e,unreadCount:t,loading:s,markAsRead:l,markAllAsRead:c,archiveNotification:u,deleteNotification:x,refreshNotifications:p}=(0,n.E$)(),{user:g}=(0,i.As)(),h=(0,a.Zp)(),[y,v]=(0,r.useState)(!1),[f,j]=(0,r.useState)(null),N=(0,r.useRef)(null),[w,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)(null),[A,I]=(0,r.useState)(0),[P,_]=(0,r.useState)("");(0,r.useEffect)(()=>{const e=e=>{N.current&&!N.current.contains(e.target)&&v(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const q=e=>{var t,s;const r=(e=>{var t,s,r,a;const i=(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(s=t.recipientRoles)||void 0===s?void 0:s[0])||(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.role);return"vendor"===i?"/vendor/inspections":"buyer"===i?"/buyer/inspections":"vendor"===(null===g||void 0===g?void 0:g.role)||null!==g&&void 0!==g&&null!==(a=g.roles)&&void 0!==a&&a.includes("vendor")?"/vendor/inspections":"/buyer/inspections"})(e),a=new URLSearchParams;null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.requestId&&a.set("inspectionId",e.data.requestId),null!==e&&void 0!==e&&null!==(s=e.data)&&void 0!==s&&s.propertyTitle&&a.set("property",e.data.propertyTitle);const i=a.toString()?`${r}?${a.toString()}`:r;v(!1),h(i)},D=(e,t)=>{const s="text-lg "+("urgent"===t?"text-red-500":"high"===t?"text-orange-500":"medium"===t?"text-blue-500":"text-gray-500");switch(e){case"property_verified":case"property_approval":case"escrow_created":case"escrow_payment_received":case"payment_received":case"escrow_completed":case"user_activated":return(0,m.jsx)(o.A7C,{className:s});case"property_rejected":case"user_suspended":return(0,m.jsx)(o._Hm,{className:s});case"property_inquiry":default:return(0,m.jsx)(o.__w,{className:s});case"escrow_disputed":case"escrow_timeout":return(0,m.jsx)(o.BS8,{className:s})}},V=e=>{switch(e){case"urgent":return"border-l-red-500 bg-red-50";case"high":return"border-l-orange-500 bg-orange-50";case"medium":return"border-l-blue-500 bg-blue-50";default:return"border-l-gray-500 bg-gray-50"}},E=e=>{const t=new Date(e),s=new Date,r=Math.floor((s-t)/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<2592e3?`${Math.floor(r/86400)}d ago`:t.toLocaleDateString()};return(0,m.jsxs)("div",{className:"relative",ref:N,children:[(0,m.jsxs)("button",{onClick:()=>{h("/alerts")},className:"relative p-2 text-gray-700 hover:text-brand-orange transition-colors",children:[(0,m.jsx)(o.jNV,{className:"text-xl"}),t>0&&(0,m.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t>99?"99+":t})]}),y&&(0,m.jsxs)("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:[(0,m.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Notifications",t>0&&(0,m.jsxs)("span",{className:"ml-2 bg-red-100 text-red-800 text-sm px-2 py-1 rounded-full",children:[t," unread"]})]}),(0,m.jsx)("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-600",children:(0,m.jsx)(o.QCr,{})})]}),t>0&&(0,m.jsxs)("button",{onClick:async()=>{j("all");try{const e=await c();e.success?b.Ay.success("All notifications marked as read"):b.Ay.error(e.message||"Failed to mark all as read")}catch(e){b.Ay.error("Error marking all notifications as read")}finally{j(null)}},disabled:"all"===f,className:"mt-2 text-sm text-blue-600 hover:text-blue-800 disabled:opacity-50",children:["all"===f?(0,m.jsx)(o.hW,{className:"animate-spin inline mr-1"}):(0,m.jsx)(o.CMH,{className:"inline mr-1"}),"Mark all as read"]})]}),(0,m.jsx)("div",{className:"max-h-96 overflow-y-auto",children:s?(0,m.jsxs)("div",{className:"p-8 text-center",children:[(0,m.jsx)(o.hW,{className:"animate-spin text-2xl text-gray-400 mx-auto mb-2"}),(0,m.jsx)("p",{className:"text-gray-500",children:"Loading notifications..."})]}):0===e.length?(0,m.jsxs)("div",{className:"p-8 text-center",children:[(0,m.jsx)(o.jNV,{className:"text-4xl text-gray-300 mx-auto mb-2"}),(0,m.jsx)("p",{className:"text-gray-500",children:"No notifications yet"})]}):(0,m.jsx)("div",{className:"divide-y divide-gray-100",children:e.slice(0,10).map(e=>{var t,s;return(0,m.jsx)("div",{className:`p-4 border-l-4 ${V(e.priority)} ${"unread"===e.status?"bg-blue-50":"bg-white"}`,children:(0,m.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,m.jsx)("div",{className:"flex-shrink-0 mt-1",children:D(e.type,e.priority)}),(0,m.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,m.jsxs)("div",{className:"flex items-start justify-between",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("p",{className:"text-sm font-medium "+("unread"===e.status?"text-gray-900":"text-gray-700"),children:e.title}),(0,m.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),(0,m.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:E(e.createdAt)})]}),"unread"===e.status&&(0,m.jsx)("div",{className:"flex-shrink-0 ml-2",children:(0,m.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})})]}),(0,m.jsxs)("div",{className:"flex items-center flex-wrap gap-2 mt-3",children:[(null===(t=e.type)||void 0===t?void 0:t.startsWith("inspection_"))&&(0,m.jsxs)("button",{onClick:()=>q(e),className:"text-xs text-indigo-600 hover:text-indigo-800 flex items-center",children:[(0,m.jsx)(o.__w,{className:"mr-1"}),"View inspection"]}),("property_inquiry"===e.type||"payment_received"===e.type)&&(0,m.jsxs)("button",{onClick:()=>(async e=>{try{if(!g||!g.id)return void b.Ay.error("Please login to start a chat");const{data:t}=e,s=(null===t||void 0===t?void 0:t.buyerId)||g.id,r=null===t||void 0===t?void 0:t.vendorId,a=null===t||void 0===t?void 0:t.propertyId;if(!r||!a)return void b.Ay.error("Unable to start chat: missing vendor or property");const i={buyerId:s,vendorId:r,propertyId:a,starterId:g.id,initialMessage:"Hi, I'm interested in this property."},l=await fetch((0,d.e9)("/chats/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),n=await l.json();l.ok?(v(!1),h("/messages",{state:{chatId:n.chatId}}),b.Ay.success("Chat started!")):b.Ay.error(n.error||"Failed to start chat")}catch(t){console.error("Error starting chat:",t),b.Ay.error("Error starting chat")}})(e),className:"text-xs text-green-600 hover:text-green-800 flex items-center",children:[(0,m.jsx)(o.uN,{className:"mr-1"}),"Send Message"]}),"payment_received"===e.type&&(0,m.jsxs)("button",{onClick:()=>(e=>{const{data:t}=e,s=(null===t||void 0===t?void 0:t.vendorId)||(null===t||void 0===t?void 0:t.buyerId),r=null!==t&&void 0!==t&&t.vendorId?"vendor":"buyer";S({rateeId:s,roleOfRatee:r,transactionId:null===t||void 0===t?void 0:t.transactionId,propertyId:null===t||void 0===t?void 0:t.propertyId}),k(!0),v(!1)})(e),className:"text-xs text-yellow-600 hover:text-yellow-800 flex items-center",children:[(0,m.jsx)(o.gt3,{className:"mr-1"}),"Rate ",null!==(s=e.data)&&void 0!==s&&s.vendorId?"Vendor":"Buyer"]}),"unread"===e.status&&(0,m.jsxs)("button",{onClick:()=>(async e=>{j(e);try{const t=await l(e);t.success?b.Ay.success("Notification marked as read"):b.Ay.error(t.message||"Failed to mark as read")}catch(t){b.Ay.error("Error marking notification as read")}finally{j(null)}})(e._id),disabled:f===e._id,className:"text-xs text-blue-600 hover:text-blue-800 disabled:opacity-50 flex items-center",children:[f===e._id?(0,m.jsx)(o.hW,{className:"animate-spin mr-1"}):(0,m.jsx)(o.CMH,{className:"mr-1"}),"Mark read"]}),(0,m.jsxs)("button",{onClick:()=>(async e=>{j(e);try{const t=await u(e);t.success?b.Ay.success("Notification archived"):b.Ay.error(t.message||"Failed to archive")}catch(t){b.Ay.error("Error archiving notification")}finally{j(null)}})(e._id),disabled:f===e._id,className:"text-xs text-gray-600 hover:text-gray-800 disabled:opacity-50 flex items-center",children:[f===e._id?(0,m.jsx)(o.hW,{className:"animate-spin mr-1"}):(0,m.jsx)(o.Wlj,{className:"mr-1"}),"Archive"]}),(0,m.jsxs)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this notification?")){j(e);try{const t=await x(e);t.success?b.Ay.success("Notification deleted"):b.Ay.error(t.message||"Failed to delete")}catch(t){b.Ay.error("Error deleting notification")}finally{j(null)}}})(e._id),disabled:f===e._id,className:"text-xs text-red-600 hover:text-red-800 disabled:opacity-50 flex items-center",children:[f===e._id?(0,m.jsx)(o.hW,{className:"animate-spin mr-1"}):(0,m.jsx)(o.qbC,{className:"mr-1"}),"Delete"]})]})]})]})},e._id)})})}),e.length>10&&(0,m.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,m.jsx)("button",{onClick:p,className:"w-full text-sm text-blue-600 hover:text-blue-800",children:"View all notifications"})})]}),w&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 shadow-xl",children:[(0,m.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Rate ","vendor"===(null===C||void 0===C?void 0:C.roleOfRatee)?"Vendor":"Buyer"]}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating"}),(0,m.jsx)("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(e=>(0,m.jsx)("button",{onClick:()=>I(e),className:"text-3xl transition-colors "+(e<=A?"text-yellow-400":"text-gray-300"),children:(0,m.jsx)(o.gt3,{})},e))})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment (Optional)"}),(0,m.jsx)("textarea",{value:P,onChange:e=>_(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Share your experience..."})]}),(0,m.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,m.jsx)("button",{onClick:()=>{k(!1),I(0),_(""),S(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,m.jsx)("button",{onClick:async()=>{if(C&&0!==A)if(g&&g.id)try{const e=await fetch((0,d.e9)("/ratings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raterId:g.id,rateeId:C.rateeId,transactionId:C.transactionId,propertyId:C.propertyId,roleOfRatee:C.roleOfRatee,stars:A,comment:P})}),t=await e.json();e.ok?(b.Ay.success("Rating submitted successfully!"),k(!1),I(0),_(""),S(null)):b.Ay.error(t.error||"Failed to submit rating")}catch(e){console.error("Error submitting rating:",e),b.Ay.error("Error submitting rating")}else b.Ay.error("Please login to submit a rating");else b.Ay.error("Please select a rating")},disabled:0===A,className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Submit Rating"})]})]})]})})]})};var j=s(8329),N=(s(2407),s(6058)),w=s(7304);w.t1.register(w.PP,w.kc,w.FN,w.No,w.hE,w.m_,w.s$);const k=e=>{let{properties:t=[]}=e;const s={labels:t.map((e,t)=>e.title||`Property ${t+1}`),datasets:[{label:"Views",data:t.map(e=>e.views||0),borderColor:"#2563EB",backgroundColor:"#2563EB20",borderWidth:2,tension:.3,pointRadius:4,pointBackgroundColor:"#2563EB"}]};return t.length?(0,m.jsx)("div",{className:"h-64",children:(0,m.jsx)(N.N1,{data:s,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`Views: ${e.parsed.y}`}}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})}):(0,m.jsx)("div",{className:"h-64 flex items-center justify-center text-sm text-gray-500",children:"No property data available yet."})};w.t1.register(w.PP,w.kc,w.E8,w.hE,w.m_,w.s$);const C=e=>{let{properties:t=[]}=e;const s={labels:t.map((e,t)=>e.title||`Property ${t+1}`),datasets:[{label:"Conversion Rate (%)",data:t.map(e=>{const t=e.views||0,s=e.inquiries||0;return t?(s/t*100).toFixed(1):0}),backgroundColor:"#10B98180",borderColor:"#10B981",borderWidth:1}]};return t.length?(0,m.jsx)("div",{className:"h-64",children:(0,m.jsx)(N.yP,{data:s,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`Conversion: ${e.parsed.y}%`}}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:e=>`${e}%`}}}}})}):(0,m.jsx)("div",{className:"h-64 flex items-center justify-center text-sm text-gray-500",children:"No property data available yet."})},S=()=>{var e,t,s,u,y,N,w,S;const{user:A}=(0,i.As)(),{deleteProperty:I}=(0,l.NC)();(0,n.E$)();const P=(0,a.zy)(),_=(0,a.Zp)(),[q,D]=(0,r.useState)(()=>"/vendor/properties"===P.pathname?"properties":"overview");(0,r.useEffect)(()=>{"/vendor/properties"===P.pathname?D("properties"):"/vendor/dashboard"===P.pathname&&D("overview")},[P.pathname]);const V="agent"===(null===A||void 0===A||null===(e=A.vendorData)||void 0===e?void 0:e.vendorCategory),[E,R]=(null===A||void 0===A||null===(t=A.vendorData)||void 0===t||t.vendorCategory,(0,r.useState)([])),[T,L]=(0,r.useState)(!0),[$,B]=(0,r.useState)({totalProperties:0,activeListings:0,pendingListings:0,soldProperties:0,totalViews:0,totalInquiries:0,totalRevenue:0,averagePrice:0,conversionRate:0,monthlyViews:0,monthlyInquiries:0}),[O,U]=(0,r.useState)([]),[F,M]=(0,r.useState)([]),[J,Y]=(0,r.useState)(!1),[W,z]=(0,r.useState)(""),[H,G]=(0,r.useState)(""),[Q,K]=(0,r.useState)(null),[Z,X]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(null),[se,re]=(0,r.useState)([]),[ae,ie]=(0,r.useState)(!1);(0,r.useEffect)(()=>{P.pathname.startsWith("/vendor/add-property")?D("add"):P.pathname.startsWith("/vendor/properties")?D("properties"):P.pathname.startsWith("/vendor/dashboard")},[P.pathname]);const le=(0,r.useCallback)(async()=>{if(!A)return R([]),void L(!1);L(!0);try{const t=(null===A||void 0===A?void 0:A.id)||(null===A||void 0===A?void 0:A.uid),s=null===A||void 0===A?void 0:A.email;if(console.log("VendorDashboard: Fetching properties for user:",{userId:t,userEmail:s}),!t&&!s)return console.log("VendorDashboard: No user ID or email found"),R([]),void L(!1);let r=[];try{const e=JSON.parse(localStorage.getItem("mockProperties")||"[]").filter(e=>{const r=e.ownerId===t||e.ownerId===(null===A||void 0===A?void 0:A.id),a=e.ownerEmail===s;return r||a});e.length>0&&(console.log("VendorDashboard: Found",e.length,"properties in localStorage"),r=e.map(e=>({...e,source:"localStorage",createdAt:e.createdAt?new Date(e.createdAt):new Date})))}catch(e){console.warn("VendorDashboard: Error reading localStorage:",e)}try{const e=await(0,c.Ud)((0,d.e9)("/properties"),{headers:{"Content-Type":"application/json"}});if(e.ok){const t=await e.json(),s=Array.isArray(t.data)?t.data:Array.isArray(t)?t:[];console.log("VendorDashboard: Found",s.length,"properties from backend"),s.forEach(e=>{const t=r.findIndex(t=>t.id===e.id);t>=0?r[t]={...r[t],...e,source:"api",createdAt:e.createdAt?new Date(e.createdAt):new Date}:r.push({...e,source:"api",createdAt:e.createdAt?new Date(e.createdAt):new Date})})}}catch(e){console.warn("VendorDashboard: Error fetching from backend API:",e)}r.sort((e,t)=>{const s=e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt||0);return(t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt||0))-s}),console.log("VendorDashboard: Total properties found:",r.length);const a=r.map(e=>{var t,s,r,a,i,l,n;const o=e.details||{},d=e.images||[],c=(null===(t=d.find(e=>e.isPrimary))||void 0===t?void 0:t.url)||("string"===typeof d[0]?d[0]:null===(s=d[0])||void 0===s?void 0:s.url)||"https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=400&h=300&fit=crop";let m="pending";return"approved"===e.approvalStatus||"approved"===e.verificationStatus?m="active":"rejected"===e.approvalStatus||"rejected"===e.verificationStatus?m="rejected":"pending"!==e.approvalStatus&&"pending"!==e.verificationStatus||(m="pending"),{...e,image:c,bedrooms:e.bedrooms||o.bedrooms||0,bathrooms:e.bathrooms||o.bathrooms||0,area:e.area||o.sqft||0,location:"object"===typeof e.location?`${e.location.address||""}, ${e.location.city||""}, ${e.location.state||""}`.replace(/^, |, $/g,""):e.location||"Location not specified",status:m,views:e.views||0,inquiries:e.inquiriesCount||0,favorites:e.favoritesCount||0,dateListed:e.createdAt instanceof Date?e.createdAt.toISOString().split("T")[0]:"string"===typeof e.createdAt?e.createdAt.split("T")[0]:"Unknown",lastUpdated:(null===(r=e.updatedAt)||void 0===r||null===(a=r.toDate)||void 0===a||null===(i=a.call(r))||void 0===i||null===(l=i.toISOString)||void 0===l||null===(n=l.call(i))||void 0===n?void 0:n.split("T")[0])||("string"===typeof e.updatedAt?e.updatedAt.split("T")[0]:null)}});console.log("VendorDashboard: Total properties loaded:",a.length),R(a)}catch(t){console.error("VendorDashboard: Error fetching properties:",t),b.Ay.error("Failed to load properties")}finally{L(!1)}},[A]),ne=(0,r.useCallback)(async()=>{if(A)try{ie(!0);const e=await(0,c.Ud)((0,d.e9)("/verification/applications/mine"),{headers:{"Content-Type":"application/json"}}),t=await e.json();e.ok&&t.success?re(Array.isArray(t.data)?t.data:[]):console.warn("VendorDashboard: Failed to load verification requests",null===t||void 0===t?void 0:t.message)}catch(e){console.error("VendorDashboard: Error fetching verification requests",e)}finally{ie(!1)}else re([])},[A]);(0,r.useEffect)(()=>{le()},[A,le]),(0,r.useEffect)(()=>{A?ne():re([])},[A,ne]),(0,r.useEffect)(()=>{(async()=>{if(A)try{const e=await(0,c.Ud)((0,d.e9)("/dashboard/vendor"),{headers:{"Content-Type":"application/json"}}),t=await e.json();if(!e.ok||!t.success)return void console.warn("VendorDashboard: Failed to load backend analytics summary");const s=t.data||{};B(e=>{var t,r,a,i,l,n,o,d;return{...e,totalProperties:null!==(t=s.totalProperties)&&void 0!==t?t:e.totalProperties,activeListings:null!==(r=s.activeListings)&&void 0!==r?r:e.activeListings,pendingListings:null!==(a=s.pendingListings)&&void 0!==a?a:e.pendingListings,soldProperties:null!==(i=s.soldProperties)&&void 0!==i?i:e.soldProperties,totalViews:null!==(l=s.totalViews)&&void 0!==l?l:e.totalViews,totalInquiries:null!==(n=s.totalInquiries)&&void 0!==n?n:e.totalInquiries,totalRevenue:null!==(o=s.totalRevenue)&&void 0!==o?o:e.totalRevenue,conversionRate:null!==(d=s.conversionRate)&&void 0!==d?d:e.conversionRate}})}catch(e){console.warn("VendorDashboard: Error fetching backend analytics summary",e)}})()},[A]),(0,r.useEffect)(()=>{U([{id:1,propertyId:1,propertyTitle:"Luxury Apartment in Victoria Island",buyerName:"John Adebayo",buyerEmail:"john@email.com",buyerPhone:"+234 801 234 5678",message:"I'm interested in viewing this property. When would be a good time?",status:"new",date:"2024-01-20",priority:"high"},{id:2,propertyId:2,propertyTitle:"Modern Family House in Lekki",buyerName:"Sarah Johnson",buyerEmail:"sarah@email.com",buyerPhone:"+234 802 345 6789",message:"Could you provide more details about the neighborhood and amenities?",status:"contacted",date:"2024-01-19",priority:"medium"}]);try{const e=JSON.parse(localStorage.getItem("viewingRequests")||"[]");M(e)}catch(e){M([])}},[]);const oe=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"sold":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},de=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},ce=(0,r.useMemo)(()=>{const e={};return se.forEach(t=>{var s,r,a,i,l,n;const o=null!==(s=null!==(r=null!==(a=t.propertyId)&&void 0!==a?a:null===(i=t.property)||void 0===i?void 0:i.id)&&void 0!==r?r:null===(l=t.property)||void 0===l?void 0:l.propertyId)&&void 0!==s?s:null===(n=t.property)||void 0===n?void 0:n.propertyRef;void 0!==o&&null!==o&&(e[o.toString()]=t.status||"pending")}),e},[se]);(0,r.useCallback)(e=>{if(!e)return"not_requested";if(e.isVerified)return"approved";const t=[e.id,e.propertyId,e.numericId,e.referenceCode].filter(e=>void 0!==e&&null!==e).map(e=>e.toString());for(const s of t)if(ce[s])return ce[s];return e.verificationStatus||"not_requested"},[ce]),(0,r.useCallback)(e=>{switch(e){case"approved":return{label:"\u2713 Verified",badgeClass:"bg-green-100 text-green-800"};case"pending":return{label:"Verification requested",badgeClass:"bg-yellow-100 text-yellow-800"};case"rejected":return{label:"Verification rejected",badgeClass:"bg-red-100 text-red-800"};default:return{label:"Not verified",badgeClass:"bg-gray-100 text-gray-800"}}},[]),(0,r.useCallback)(e=>"approved"===e?{show:!1}:"pending"===e?{show:!0,label:"Verification requested",disabled:!0}:"rejected"===e?{show:!0,label:"Resubmit verification",disabled:!1}:{show:!0,label:"Get Verified",disabled:!1},[]);return(0,m.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,m.jsxs)("div",{className:"w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,m.jsxs)("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[(0,m.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-brand-blue to-blue-600 rounded-full flex items-center justify-center",children:null!==A&&void 0!==A&&A.photoURL||null!==A&&void 0!==A&&A.avatar?(0,m.jsx)("img",{src:A.photoURL||A.avatar,alt:"User avatar",className:"w-12 h-12 rounded-full object-cover"}):(0,m.jsx)("span",{className:"text-lg font-medium text-white",children:(()=>{return A?null!==A&&void 0!==A&&A.displayName?A.displayName.split(" ").map(e=>e[0]).join("").toUpperCase():null!==A&&void 0!==A&&A.firstName&&null!==A&&void 0!==A&&A.lastName?`${(null===A||void 0===A||null===(e=A.firstName)||void 0===e?void 0:e[0])||""}${(null===A||void 0===A||null===(t=A.lastName)||void 0===t?void 0:t[0])||""}`.toUpperCase():null!==A&&void 0!==A&&A.email&&(null===A||void 0===A||null===(s=A.email)||void 0===s||null===(r=s[0])||void 0===r?void 0:r.toUpperCase())||"V":"V";var e,t,s,r})()})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:(null===A||void 0===A?void 0:A.displayName)||`${(null===A||void 0===A?void 0:A.firstName)||""} ${(null===A||void 0===A?void 0:A.lastName)||""}`.trim()||"Vendor Account"}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:V?"Real Estate Agent":"Property Owner"})]})]}),(0,m.jsx)("div",{className:"relative md:self-auto self-start",children:(0,m.jsx)(f,{})})]}),(0,m.jsx)("div",{className:"mb-8",style:{marginTop:"0px"},children:(0,m.jsxs)("div",{className:"welcome-section",children:[(0,m.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["Welcome back, ",(null===A||void 0===A?void 0:A.firstName)||"Vendor","!"]}),(0,m.jsx)("p",{className:"text-blue-100 mb-4",children:V?`Help clients find their dream properties in ${(null===A||void 0===A||null===(s=A.vendorData)||void 0===s?void 0:s.agentLocation)||"your area"}. Manage your listings, track inquiries, and grow your real estate business.`:"Manage your properties, track inquiries, schedule viewings, and grow your real estate portfolio. List, edit, and monitor all your property listings in one place."}),(null===A||void 0===A?void 0:A.vendorCode)&&(0,m.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4 mb-4 border border-white/20",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-blue-200 text-sm",children:"Your Vendor ID (share with prospects)"}),(0,m.jsx)("p",{className:"text-2xl font-mono font-bold text-white tracking-wider",children:A.vendorCode})]}),(0,m.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText(A.vendorCode),b.Ay.success("Vendor ID copied to clipboard!")},className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[(0,m.jsx)(o.CMH,{className:"text-sm"}),"Copy"]})]}),(0,m.jsx)("p",{className:"text-blue-200 text-xs mt-2",children:"Buyers can search for your properties using this ID in the Properties tab."})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,m.jsx)("div",{className:"stats-card cursor-pointer hover:bg-blue-700 transition-colors",onClick:()=>_("/vendor/properties"),title:"View your properties",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-white",children:$.activeListings||0}),(0,m.jsx)("div",{className:"text-blue-200 text-sm",children:V?"Managed Properties":"Active Listings"})]}),(0,m.jsx)(o.rQ8,{className:"text-blue-300 text-xl"})]})}),(0,m.jsx)("div",{className:"stats-card cursor-pointer hover:bg-blue-700 transition-colors",onClick:()=>{D("analytics"),window.scrollTo({top:0,behavior:"smooth"})},title:"View analytics",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-white",children:(null===(u=$.totalViews)||void 0===u?void 0:u.toLocaleString())||0}),(0,m.jsx)("div",{className:"text-blue-200 text-sm",children:"Total Views"})]}),(0,m.jsx)(o.Ny1,{className:"text-blue-300 text-xl"})]})}),(0,m.jsx)("div",{className:"stats-card cursor-pointer hover:bg-blue-700 transition-colors",onClick:()=>{D("inquiries"),window.scrollTo({top:0,behavior:"smooth"})},title:"View inquiries",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-white",children:$.totalInquiries||0}),(0,m.jsx)("div",{className:"text-blue-200 text-sm",children:"Inquiries"})]}),(0,m.jsx)(o.maD,{className:"text-blue-300 text-xl"})]})}),(0,m.jsx)("div",{className:"stats-card cursor-pointer hover:bg-blue-700 transition-colors",onClick:()=>{D("analytics"),window.scrollTo({top:0,behavior:"smooth"})},title:"View analytics",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-white",children:[$.conversionRate||0,"%"]}),(0,m.jsx)("div",{className:"text-blue-200 text-sm",children:"Conversion Rate"})]}),(0,m.jsx)(o.YYR,{className:"text-blue-300 text-xl"})]})})]})]})}),(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[(0,m.jsx)("div",{className:"border-b border-gray-200",children:(0,m.jsx)("nav",{className:"flex overflow-x-auto no-scrollbar px-4 sm:px-6","aria-label":"Vendor dashboard sections",children:(0,m.jsx)("div",{className:"flex min-w-max divide-x divide-transparent",children:[{id:"overview",label:"Overview",icon:o.YYR},{id:"properties",label:"My Properties",icon:o.rQ8},{id:"inquiries",label:"Inquiries",icon:o.maD},{id:"viewings",label:"Viewing Requests",icon:o.itz},{id:"analytics",label:"Analytics",icon:o.YYR}].map(e=>(0,m.jsxs)("button",{onClick:()=>{D(e.id)},className:"flex items-center space-x-2 py-4 px-3 border-b-2 font-medium text-sm transition-colors "+(q===e.id?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,m.jsx)(e.icon,{className:"h-4 w-4"}),(0,m.jsx)("span",{children:e.label})]},e.id))})})}),(0,m.jsxs)("div",{className:"p-6",children:["overview"===q&&(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),(0,m.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("div",{className:"p-2 bg-green-100 rounded-full",children:(0,m.jsx)(o.Ny1,{className:"h-4 w-4 text-green-600"})}),(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("p",{className:"text-sm text-gray-900",children:'New view on "Luxury Apartment in Victoria Island"'}),(0,m.jsx)("p",{className:"text-xs text-gray-500",children:"2 minutes ago"})]})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("div",{className:"p-2 bg-blue-100 rounded-full",children:(0,m.jsx)(o.maD,{className:"h-4 w-4 text-blue-600"})}),(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("p",{className:"text-sm text-gray-900",children:"New inquiry from John Adebayo"}),(0,m.jsx)("p",{className:"text-xs text-gray-500",children:"15 minutes ago"})]})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("div",{className:"p-2 bg-orange-100 rounded-full",children:(0,m.jsx)(o.Mbv,{className:"h-4 w-4 text-orange-600"})}),(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("p",{className:"text-sm text-gray-900",children:"Property added to favorites"}),(0,m.jsx)("p",{className:"text-xs text-gray-500",children:"1 hour ago"})]})]})]})})]}),V&&(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Agent Profile"}),(0,m.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Business Information"}),(0,m.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Company:"})," ",null===A||void 0===A||null===(y=A.vendorData)||void 0===y?void 0:y.businessName]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Location:"})," ",null===A||void 0===A||null===(N=A.vendorData)||void 0===N?void 0:N.agentLocation]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Experience:"})," ",null===A||void 0===A||null===(w=A.vendorData)||void 0===w?void 0:w.experience]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Contact Information"}),(0,m.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Phone:"})," ",null===A||void 0===A?void 0:A.phone]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Email:"})," ",null===A||void 0===A?void 0:A.email]})]})]})]}),(0,m.jsx)("div",{className:"mt-4 pt-4 border-t border-blue-200",children:(0,m.jsxs)("p",{className:"text-sm text-blue-700",children:["\ud83d\udca1 ",(0,m.jsx)("strong",{children:"Tip:"})," Keep your profile updated to attract more clients in ",null===A||void 0===A||null===(S=A.vendorData)||void 0===S?void 0:S.agentLocation,"."]})})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,m.jsx)("button",{onClick:()=>{D("add"),_("/vendor/add-property")},className:"flex items-center space-x-3 p-4 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",title:"Add new property",children:(0,m.jsxs)("div",{className:"p-2 bg-blue-100 rounded-full",children:[(0,m.jsx)("p",{className:"font-medium text-gray-900",children:"Update Listings"}),(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"Edit property details"})]})}),(0,m.jsxs)("button",{className:"flex items-center space-x-3 p-4 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",title:"View performance analytics",children:[(0,m.jsx)("div",{className:"p-2 bg-purple-100 rounded-full",children:(0,m.jsx)(o.YYR,{className:"h-5 w-5 text-purple-600"})}),(0,m.jsxs)("div",{className:"text-left",children:[(0,m.jsx)("p",{className:"font-medium text-gray-900",children:"View Analytics"}),(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"Check performance"})]})]})]})]})]}),"properties"===q&&(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"My Properties"}),(0,m.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,m.jsx)("button",{onClick:le,className:"btn-secondary flex items-center space-x-2",disabled:T,children:T?(0,m.jsx)(o.hW,{className:"h-4 w-4 animate-spin"}):(0,m.jsx)("span",{children:"Refresh"})}),(0,m.jsxs)("button",{onClick:()=>_("/vendor/add-property"),className:"btn-primary flex items-center space-x-2",children:[(0,m.jsx)(o.OiG,{className:"h-4 w-4"}),(0,m.jsx)("span",{children:"Add Property"})]})]})]}),T&&(0,m.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(0,m.jsx)(j.A,{count:6})}),!T&&0===E.length&&(0,m.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,m.jsx)(o.rQ8,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,m.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No properties yet"}),(0,m.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Get started by adding your first property listing."}),(0,m.jsxs)("button",{onClick:()=>_("/vendor/add-property"),className:"mt-4 btn-primary inline-flex items-center space-x-2",children:[(0,m.jsx)(o.OiG,{className:"h-4 w-4"}),(0,m.jsx)("span",{children:"Add Your First Property"})]})]}),!T&&E.length>0&&(0,m.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:E.map(e=>{var t,s,r;const a=p(e.id),i=(l=e.id,h(l)?"Verified":g(l)?"Verification Requested":"Get Verified");var l;const n=(e=>h(e)?"bg-green-600 text-white cursor-not-allowed":g(e)?"bg-yellow-600 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700")(e.id),d=h(e.id)||g(e.id);return(0,m.jsxs)("div",{className:"property-card",children:[(0,m.jsxs)("div",{className:"relative",children:[(0,m.jsx)("img",{src:e.image,alt:e.title,className:"w-full h-48 object-cover rounded-t-lg"}),(0,m.jsxs)("div",{className:"absolute top-3 left-3 flex flex-col space-y-1",children:[(0,m.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${oe(e.status)}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),"localStorage"===e.source&&!e.savedToFirestore&&(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",title:"This property is stored locally and may be lost if you clear browser data",children:"\u26a0\ufe0f Local Only"})]}),(0,m.jsxs)("div",{className:"absolute top-3 right-3 flex space-x-2",children:[(0,m.jsx)("button",{className:"p-2 bg-white bg-opacity-90 rounded-full hover:bg-opacity-100 transition-all",title:"Edit property","aria-label":"Edit property",onClick:()=>_("/vendor/add-property",{state:{propertyToEdit:e}}),children:(0,m.jsx)(o.uO9,{className:"h-4 w-4 text-gray-600"})}),(0,m.jsx)("button",{className:"p-2 bg-white bg-opacity-90 rounded-full hover:bg-opacity-100 transition-all",title:"Delete property","aria-label":"Delete property",onClick:()=>(async e=>{if(!A)return b.Ay.error("Please login to manage your properties"),void _("/");window.confirm("Are you sure you want to delete this property? This action cannot be undone.")&&(R(t=>t.filter(t=>t.id!==e)),await I(e),await le())})(e.id),children:(0,m.jsx)(o.qbC,{className:"h-4 w-4 text-red-600"})})]})]}),(0,m.jsxs)("div",{className:"p-4",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:["\u20a6",(e.price||0).toLocaleString()]}),(0,m.jsx)("h3",{className:"font-semibold text-gray-900 mb-1",children:e.title}),(0,m.jsxs)("p",{className:"text-gray-600 text-sm mb-3 flex items-center",children:[(0,m.jsx)(o.vq8,{className:"h-3 w-3 mr-1"}),(()=>{if("string"===typeof e.location)return e.location;if(e.location&&"object"===typeof e.location){if(e.location.address)return e.location.address;const t=e.location.city||"",s=e.location.state||"";return`${t}${t&&s?", ":""}${s}`.trim()}return"Location not specified"})()]}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-4",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,m.jsx)(o.TiC,{className:"h-3 w-3"}),(0,m.jsx)("span",{children:e.bedrooms||(null===(t=e.details)||void 0===t?void 0:t.bedrooms)||0})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,m.jsx)(o.F6e,{className:"h-3 w-3"}),(0,m.jsx)("span",{children:e.bathrooms||(null===(s=e.details)||void 0===s?void 0:s.bathrooms)||0})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,m.jsx)(o.VlX,{className:"h-3 w-3"}),(0,m.jsxs)("span",{children:[e.area||(null===(r=e.details)||void 0===r?void 0:r.sqft)||0,"m\xb2"]})]})]}),(0,m.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center text-sm",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"font-semibold text-gray-900",children:e.views}),(0,m.jsx)("div",{className:"text-gray-500",children:"Views"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"font-semibold text-gray-900",children:e.inquiries}),(0,m.jsx)("div",{className:"text-gray-500",children:"Inquiries"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"font-semibold text-gray-900",children:e.favorites}),(0,m.jsx)("div",{className:"text-gray-500",children:"Favorites"})]})]}),(0,m.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[(0,m.jsxs)("span",{children:["Listed: ",new Date(e.dateListed).toLocaleDateString()]}),(0,m.jsxs)("span",{children:["Updated: ",new Date(e.lastUpdated).toLocaleDateString()]})]}),(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("div",{className:"flex items-center space-x-2",children:a&&(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("approved"===a.status?"bg-green-100 text-green-800":"requested"===a.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"approved"===a.status?"\u2713 Verified":"requested"===a.status?"\u23f3 Verification Requested":"Not Verified"})}),(0,m.jsx)("button",{onClick:()=>(e=>{h(e.id)?(0,b.Ay)("This property is already verified!",{icon:"\u2705"}):g(e.id)?(0,b.Ay)("Verification already requested for this property.",{icon:"\u2139\ufe0f"}):(te(e),X(!0))})(e),disabled:d,className:`px-3 py-1 text-xs rounded-md transition-colors ${n}`,children:i})]})]})]})]},e.id)})})]}),"inquiries"===q&&(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Property Inquiries & Viewings"}),(0,m.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,m.jsxs)("select",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-auto",children:[(0,m.jsx)("option",{children:"All Inquiries"}),(0,m.jsx)("option",{children:"New"}),(0,m.jsx)("option",{children:"Contacted"}),(0,m.jsx)("option",{children:"Follow-up"})]})})]}),(0,m.jsx)("div",{className:"space-y-4",children:O.map(e=>(0,m.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:(0,m.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-900",children:e.buyerName}),(0,m.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${de(e.priority)}`,children:e.priority}),(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("new"===e.status?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:e.status})]}),(0,m.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Property: ",e.propertyTitle]}),(0,m.jsx)("p",{className:"text-gray-700 mb-3",children:e.message}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,m.jsxs)("span",{className:"flex items-center",children:[(0,m.jsx)(o.maD,{className:"h-3 w-3 mr-1"}),e.buyerEmail]}),(0,m.jsxs)("span",{className:"flex items-center",children:[(0,m.jsx)(o.Cab,{className:"h-3 w-3 mr-1"}),e.buyerPhone]}),(0,m.jsxs)("span",{className:"flex items-center",children:[(0,m.jsx)(o.itz,{className:"h-3 w-3 mr-1"}),new Date(e.date).toLocaleDateString()]})]})]}),(0,m.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:ml-4",children:[(0,m.jsx)("button",{className:"px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors text-center",children:"Reply"}),(0,m.jsx)("button",{className:"px-3 py-2 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 transition-colors text-center",children:"Mark as Contacted"})]})]})},e.id))}),(0,m.jsxs)("div",{className:"pt-4",children:[(0,m.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Viewing Requests"}),0===F.length?(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"No viewing requests yet."}):(0,m.jsx)("div",{className:"space-y-3",children:F.map(e=>(0,m.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,m.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,m.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:e.userName||"Buyer"}),(0,m.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs "+("confirmed"===e.status?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:e.status||"pending"})]}),(0,m.jsxs)("p",{className:"text-sm text-gray-700",children:["Property: ",e.propertyTitle]}),(0,m.jsxs)("p",{className:"text-xs text-gray-500",children:["Requested: ",new Date(e.requestedAt).toLocaleString()]}),(0,m.jsxs)("div",{className:"mt-2 text-sm text-gray-700",children:[(0,m.jsxs)("p",{children:["Preferred: ",e.preferredDate||"\u2014"," ",e.preferredTime||""]}),e.vendorProposalDate&&(0,m.jsxs)("p",{className:"text-blue-700",children:["Your proposal: ",e.vendorProposalDate," ",e.vendorProposalTime||""]})]})]}),(0,m.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:ml-4",children:[(0,m.jsx)("button",{onClick:()=>{K(e.id),z(""),G(""),Y(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:"Propose Alternative"}),(0,m.jsx)("button",{onClick:()=>{const t=F.map(t=>t.id===e.id?{...t,status:"confirmed"}:t);M(t),localStorage.setItem("viewingRequests",JSON.stringify(t))},className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors",children:"Confirm"})]})]})},e.id))})]})]}),"viewings"===q&&(0,m.jsx)(v,{}),"analytics"===q&&(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Property Performance Analytics"}),(0,m.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-900 mb-4",children:"Views by Property"}),(0,m.jsx)(k,{properties:E})]}),(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-900 mb-4",children:"Inquiry Conversion by Property"}),(0,m.jsx)(C,{properties:E})]})]}),(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-900 mb-4",children:"Property Performance Summary"}),(0,m.jsx)("div",{className:"overflow-x-auto",children:(0,m.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,m.jsx)("thead",{className:"bg-gray-50",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Property"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Views"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Inquiries"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Favorites"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Conversion"})]})}),(0,m.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map(e=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("img",{className:"h-10 w-10 rounded-lg object-cover",src:e.image,alt:e.title}),(0,m.jsxs)("div",{className:"ml-4",children:[(0,m.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,m.jsx)("div",{className:"text-sm text-gray-500",children:e.location})]})]})}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.views}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.inquiries}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.favorites}),(0,m.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[(e.inquiries/e.views*100).toFixed(1),"%"]})]},e.id))})]})})]})]})]})]}),J&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Propose Alternative Date"}),(0,m.jsx)("button",{onClick:()=>Y(!1),className:"text-gray-400 hover:text-gray-600",children:(0,m.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,m.jsx)("input",{type:"date",value:W,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time"}),(0,m.jsx)("input",{type:"time",value:H,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,m.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,m.jsx)("button",{onClick:()=>Y(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,m.jsx)("button",{onClick:()=>{if(!W||!H||!Q)return;const e=F.map(e=>e.id===Q?{...e,vendorProposalDate:W,vendorProposalTime:H,status:"proposed"}:e);M(e),localStorage.setItem("viewingRequests",JSON.stringify(e)),Y(!1)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Send Proposal"})]})]})]})}),Z&&ee&&(0,m.jsx)(x,{property:ee,onClose:()=>{X(!1),setTimeout(()=>{window.location.reload()},1e3)},onSuccess:()=>{X(!1),b.Ay.success("Verification request submitted successfully!",{icon:"\u2705"}),setTimeout(()=>{window.location.reload()},1e3)}})]})})}},6809:(e,t,s)=>{s.d(t,{Ud:()=>l,hasAuthToken:()=>i});const r=async()=>(()=>{try{return localStorage.getItem("accessToken")||localStorage.getItem("token")}catch(e){return console.warn("getAuthToken: Could not read token from storage:",e),null}})(),a=async()=>{const e=await r(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t},i=async()=>{const e=await r();return Boolean(e)},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=await a(),r={...t,headers:{...s,...t.headers||{}}};return fetch(e,r)}},8329:(e,t,s)=>{s.d(t,{A:()=>a});s(5043);var r=s(579);const a=e=>{let{count:t=1}=e;const s=Array.from({length:t},(e,t)=>(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden animate-pulse",children:[(0,r.jsx)("div",{className:"w-full h-48 bg-gray-300"}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"h-8 w-32 bg-gray-300 rounded mb-3"}),(0,r.jsx)("div",{className:"h-6 w-full bg-gray-300 rounded mb-2"}),(0,r.jsx)("div",{className:"h-6 w-3/4 bg-gray-300 rounded mb-4"}),(0,r.jsx)("div",{className:"h-4 w-2/3 bg-gray-300 rounded mb-4"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,r.jsx)("div",{className:"h-4 w-16 bg-gray-300 rounded"}),(0,r.jsx)("div",{className:"h-4 w-16 bg-gray-300 rounded"}),(0,r.jsx)("div",{className:"h-4 w-16 bg-gray-300 rounded"})]}),(0,r.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,r.jsx)("div",{className:"h-4 w-full bg-gray-300 rounded"}),(0,r.jsx)("div",{className:"h-4 w-5/6 bg-gray-300 rounded"})]}),(0,r.jsx)("div",{className:"h-10 w-full bg-gray-300 rounded"})]})]},t));return(0,r.jsx)(r.Fragment,{children:s})}}}]);
//# sourceMappingURL=515.85488e0e.chunk.js.map